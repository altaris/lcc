<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>lcc.classifiers API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../lcc.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;lcc</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#BaseClassifier">BaseClassifier</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#BaseClassifier.__init__">BaseClassifier</a>
                        </li>
                        <li>
                                <a class="variable" href="#BaseClassifier.lcc_data">lcc_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#BaseClassifier.standard_loss">standard_loss</a>
                        </li>
                        <li>
                                <a class="variable" href="#BaseClassifier.accuracy_top1">accuracy_top1</a>
                        </li>
                        <li>
                                <a class="variable" href="#BaseClassifier.accuracy_top5">accuracy_top5</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseClassifier.configure_optimizers">configure_optimizers</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseClassifier.forward_intermediate">forward_intermediate</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseClassifier.get_image_processor">get_image_processor</a>
                        </li>
                        <li>
                                <a class="variable" href="#BaseClassifier.lcc_submodules">lcc_submodules</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseClassifier.on_train_batch_end">on_train_batch_end</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseClassifier.on_train_epoch_end">on_train_epoch_end</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseClassifier.on_train_epoch_start">on_train_epoch_start</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseClassifier.on_train_start">on_train_start</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseClassifier.test_step">test_step</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseClassifier.training_step">training_step</a>
                        </li>
                        <li>
                                <a class="function" href="#BaseClassifier.validation_step">validation_step</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#get_classifier_cls">get_classifier_cls</a>
            </li>
            <li>
                    <a class="class" href="#HuggingFaceClassifier">HuggingFaceClassifier</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HuggingFaceClassifier.__init__">HuggingFaceClassifier</a>
                        </li>
                        <li>
                                <a class="function" href="#HuggingFaceClassifier.get_image_processor">get_image_processor</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LatentClusteringData">LatentClusteringData</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#LatentClusteringData.__init__">LatentClusteringData</a>
                        </li>
                        <li>
                                <a class="variable" href="#LatentClusteringData.loss">loss</a>
                        </li>
                        <li>
                                <a class="variable" href="#LatentClusteringData.y_clst">y_clst</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TimmClassifier">TimmClassifier</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TimmClassifier.__init__">TimmClassifier</a>
                        </li>
                        <li>
                                <a class="variable" href="#TimmClassifier.image_transform">image_transform</a>
                        </li>
                        <li>
                                <a class="function" href="#TimmClassifier.get_image_processor">get_image_processor</a>
                        </li>
                        <li>
                                <a class="function" href="#TimmClassifier.forward">forward</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TorchvisionClassifier">TorchvisionClassifier</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TorchvisionClassifier.__init__">TorchvisionClassifier</a>
                        </li>
                        <li>
                                <a class="function" href="#TorchvisionClassifier.get_image_processor">get_image_processor</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#validate_lcc_kwargs">validate_lcc_kwargs</a>
            </li>
            <li>
                    <a class="class" href="#WrappedClassifier">WrappedClassifier</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#WrappedClassifier.__init__">WrappedClassifier</a>
                        </li>
                        <li>
                                <a class="variable" href="#WrappedClassifier.model">model</a>
                        </li>
                        <li>
                                <a class="function" href="#WrappedClassifier.forward">forward</a>
                        </li>
                        <li>
                                <a class="variable" href="#WrappedClassifier.lcc_submodules">lcc_submodules</a>
                        </li>
                        <li>
                                <a class="function" href="#WrappedClassifier.on_train_start">on_train_start</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../lcc.html">lcc</a><wbr>.classifiers    </h1>

                        <div class="docstring"><p>Classifier models and related stuff</p>
</div>

                        <input id="mod-classifiers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-classifiers-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;Classifier models and related stuff&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>    <span class="n">BaseClassifier</span><span class="p">,</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a>    <span class="n">LatentClusteringData</span><span class="p">,</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>    <span class="n">validate_lcc_kwargs</span><span class="p">,</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="p">)</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.huggingface</span><span class="w"> </span><span class="kn">import</span> <span class="n">HuggingFaceClassifier</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.timm</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimmClassifier</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.torchvision</span><span class="w"> </span><span class="kn">import</span> <span class="n">TorchvisionClassifier</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.wrapped</span><span class="w"> </span><span class="kn">import</span> <span class="n">WrappedClassifier</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>    <span class="s2">&quot;BaseClassifier&quot;</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="s2">&quot;get_classifier_cls&quot;</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="s2">&quot;HuggingFaceClassifier&quot;</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="s2">&quot;LatentClusteringData&quot;</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="s2">&quot;TimmClassifier&quot;</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="s2">&quot;TorchvisionClassifier&quot;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="s2">&quot;validate_lcc_kwargs&quot;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="s2">&quot;WrappedClassifier&quot;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a><span class="p">]</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_classifier_cls</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseClassifier</span><span class="p">]:</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a><span class="sd">    Returns the classifier class to use for a given model name.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a><span class="sd">    Args:</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a><span class="sd">        model_name (str):</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>    <span class="k">if</span> <span class="n">model_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;timm/&quot;</span><span class="p">):</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>        <span class="k">return</span> <span class="n">TimmClassifier</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a>    <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">model_name</span><span class="p">:</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>        <span class="k">return</span> <span class="n">HuggingFaceClassifier</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a>    <span class="k">return</span> <span class="n">TorchvisionClassifier</span>
</span></pre></div>


            </section>
                <section id="BaseClassifier">
                            <input id="BaseClassifier-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BaseClassifier</span><wbr>(<span class="base">pytorch_lightning.core.module.LightningModule</span>):

                <label class="view-source-button" for="BaseClassifier-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier-49"><a href="#BaseClassifier-49"><span class="linenos"> 49</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BaseClassifier</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">LightningModule</span><span class="p">):</span>
</span><span id="BaseClassifier-50"><a href="#BaseClassifier-50"><span class="linenos"> 50</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-51"><a href="#BaseClassifier-51"><span class="linenos"> 51</span></a><span class="sd">    Base image classifier class that supports LCC.</span>
</span><span id="BaseClassifier-52"><a href="#BaseClassifier-52"><span class="linenos"> 52</span></a>
</span><span id="BaseClassifier-53"><a href="#BaseClassifier-53"><span class="linenos"> 53</span></a><span class="sd">    Warning:</span>
</span><span id="BaseClassifier-54"><a href="#BaseClassifier-54"><span class="linenos"> 54</span></a><span class="sd">        When subclassing this, remember that the forward method must be able to</span>
</span><span id="BaseClassifier-55"><a href="#BaseClassifier-55"><span class="linenos"> 55</span></a><span class="sd">        deal with either `Tensor` or `Batch` inputs, and must return a logit</span>
</span><span id="BaseClassifier-56"><a href="#BaseClassifier-56"><span class="linenos"> 56</span></a><span class="sd">        `Tensor`.</span>
</span><span id="BaseClassifier-57"><a href="#BaseClassifier-57"><span class="linenos"> 57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="BaseClassifier-58"><a href="#BaseClassifier-58"><span class="linenos"> 58</span></a>
</span><span id="BaseClassifier-59"><a href="#BaseClassifier-59"><span class="linenos"> 59</span></a>    <span class="n">lcc_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">LatentClusteringData</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="BaseClassifier-60"><a href="#BaseClassifier-60"><span class="linenos"> 60</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-61"><a href="#BaseClassifier-61"><span class="linenos"> 61</span></a><span class="sd">    If LCC is applied, then this is non `None` and updated at the begining of</span>
</span><span id="BaseClassifier-62"><a href="#BaseClassifier-62"><span class="linenos"> 62</span></a><span class="sd">    each epoch. See also `full_dataset_latent_clustering`.</span>
</span><span id="BaseClassifier-63"><a href="#BaseClassifier-63"><span class="linenos"> 63</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="BaseClassifier-64"><a href="#BaseClassifier-64"><span class="linenos"> 64</span></a>
</span><span id="BaseClassifier-65"><a href="#BaseClassifier-65"><span class="linenos"> 65</span></a>    <span class="n">standard_loss</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span>
</span><span id="BaseClassifier-66"><a href="#BaseClassifier-66"><span class="linenos"> 66</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;&#39;Standard&#39; loss to use together with LCC.&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-67"><a href="#BaseClassifier-67"><span class="linenos"> 67</span></a>
</span><span id="BaseClassifier-68"><a href="#BaseClassifier-68"><span class="linenos"> 68</span></a>    <span class="n">accuracy_top1</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span>
</span><span id="BaseClassifier-69"><a href="#BaseClassifier-69"><span class="linenos"> 69</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Top-1 accuracy metric.&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-70"><a href="#BaseClassifier-70"><span class="linenos"> 70</span></a>
</span><span id="BaseClassifier-71"><a href="#BaseClassifier-71"><span class="linenos"> 71</span></a>    <span class="n">accuracy_top5</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="BaseClassifier-72"><a href="#BaseClassifier-72"><span class="linenos"> 72</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Top-5 accuracy metric.&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-73"><a href="#BaseClassifier-73"><span class="linenos"> 73</span></a>
</span><span id="BaseClassifier-74"><a href="#BaseClassifier-74"><span class="linenos"> 74</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="BaseClassifier-75"><a href="#BaseClassifier-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="BaseClassifier-76"><a href="#BaseClassifier-76"><span class="linenos"> 76</span></a>        <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="BaseClassifier-77"><a href="#BaseClassifier-77"><span class="linenos"> 77</span></a>        <span class="n">lcc_submodules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BaseClassifier-78"><a href="#BaseClassifier-78"><span class="linenos"> 78</span></a>        <span class="n">lcc_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BaseClassifier-79"><a href="#BaseClassifier-79"><span class="linenos"> 79</span></a>        <span class="n">ce_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="BaseClassifier-80"><a href="#BaseClassifier-80"><span class="linenos"> 80</span></a>        <span class="n">image_key</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="BaseClassifier-81"><a href="#BaseClassifier-81"><span class="linenos"> 81</span></a>        <span class="n">label_key</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="BaseClassifier-82"><a href="#BaseClassifier-82"><span class="linenos"> 82</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="BaseClassifier-83"><a href="#BaseClassifier-83"><span class="linenos"> 83</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier-84"><a href="#BaseClassifier-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-85"><a href="#BaseClassifier-85"><span class="linenos"> 85</span></a><span class="sd">        Args:</span>
</span><span id="BaseClassifier-86"><a href="#BaseClassifier-86"><span class="linenos"> 86</span></a><span class="sd">            n_classes (int):</span>
</span><span id="BaseClassifier-87"><a href="#BaseClassifier-87"><span class="linenos"> 87</span></a><span class="sd">            lcc_submodules (list[str] | None, optional): Submodules to consider</span>
</span><span id="BaseClassifier-88"><a href="#BaseClassifier-88"><span class="linenos"> 88</span></a><span class="sd">                for the latent correction loss. If `None` or `[]`, LCC is not</span>
</span><span id="BaseClassifier-89"><a href="#BaseClassifier-89"><span class="linenos"> 89</span></a><span class="sd">                performed</span>
</span><span id="BaseClassifier-90"><a href="#BaseClassifier-90"><span class="linenos"> 90</span></a><span class="sd">            lcc_kwargs (dict | None, optional): Optional parameters for LCC.</span>
</span><span id="BaseClassifier-91"><a href="#BaseClassifier-91"><span class="linenos"> 91</span></a><span class="sd">                Expected entries (all optional) are:</span>
</span><span id="BaseClassifier-92"><a href="#BaseClassifier-92"><span class="linenos"> 92</span></a><span class="sd">                * **weight (float):** Defaults to $10^{-4}$</span>
</span><span id="BaseClassifier-93"><a href="#BaseClassifier-93"><span class="linenos"> 93</span></a><span class="sd">                * **class_selection</span>
</span><span id="BaseClassifier-94"><a href="#BaseClassifier-94"><span class="linenos"> 94</span></a><span class="sd">                    (`lcc.correction.LCCClassSelection` | None):** Defaults to</span>
</span><span id="BaseClassifier-95"><a href="#BaseClassifier-95"><span class="linenos"> 95</span></a><span class="sd">                    `None`, which means all classes are considered for</span>
</span><span id="BaseClassifier-96"><a href="#BaseClassifier-96"><span class="linenos"> 96</span></a><span class="sd">                    correction</span>
</span><span id="BaseClassifier-97"><a href="#BaseClassifier-97"><span class="linenos"> 97</span></a><span class="sd">                * **interval (int):** Apply LCC every `interval` epochs.</span>
</span><span id="BaseClassifier-98"><a href="#BaseClassifier-98"><span class="linenos"> 98</span></a><span class="sd">                    Defaults to $1$, meaning LCC will be applied every epoch</span>
</span><span id="BaseClassifier-99"><a href="#BaseClassifier-99"><span class="linenos"> 99</span></a><span class="sd">                    (after warmup).</span>
</span><span id="BaseClassifier-100"><a href="#BaseClassifier-100"><span class="linenos">100</span></a><span class="sd">                * **warmup (int):** Number of epochs to wait before</span>
</span><span id="BaseClassifier-101"><a href="#BaseClassifier-101"><span class="linenos">101</span></a><span class="sd">                    starting LCC. Defaults to $0$, meaning LCC will start</span>
</span><span id="BaseClassifier-102"><a href="#BaseClassifier-102"><span class="linenos">102</span></a><span class="sd">                    immediately.</span>
</span><span id="BaseClassifier-103"><a href="#BaseClassifier-103"><span class="linenos">103</span></a><span class="sd">                * **k (int):** Number of nearest neighbors to consider for LCC,</span>
</span><span id="BaseClassifier-104"><a href="#BaseClassifier-104"><span class="linenos">104</span></a><span class="sd">                  and Louvain clustering.</span>
</span><span id="BaseClassifier-105"><a href="#BaseClassifier-105"><span class="linenos">105</span></a><span class="sd">                * **pca_dim (int):** Samples are reduced to this dimension</span>
</span><span id="BaseClassifier-106"><a href="#BaseClassifier-106"><span class="linenos">106</span></a><span class="sd">                  before constructing the KNN graph. This must be at most the</span>
</span><span id="BaseClassifier-107"><a href="#BaseClassifier-107"><span class="linenos">107</span></a><span class="sd">                  batch size.</span>
</span><span id="BaseClassifier-108"><a href="#BaseClassifier-108"><span class="linenos">108</span></a><span class="sd">                * **loss (`&quot;exact&quot;` or `&quot;randomized&quot;`)**: Way the LCC loss is</span>
</span><span id="BaseClassifier-109"><a href="#BaseClassifier-109"><span class="linenos">109</span></a><span class="sd">                  computed from the clustering data. See `lcc.correction.loss`.</span>
</span><span id="BaseClassifier-110"><a href="#BaseClassifier-110"><span class="linenos">110</span></a><span class="sd">                * **ccspc (int)**: If the loss type is `&quot;randomized&quot;`, then this</span>
</span><span id="BaseClassifier-111"><a href="#BaseClassifier-111"><span class="linenos">111</span></a><span class="sd">                  parameter specified the number of CC samples per cluster to</span>
</span><span id="BaseClassifier-112"><a href="#BaseClassifier-112"><span class="linenos">112</span></a><span class="sd">                  keep as potential correction targets. See also</span>
</span><span id="BaseClassifier-113"><a href="#BaseClassifier-113"><span class="linenos">113</span></a><span class="sd">                  `lcc.correction.loss.RandomizedLCCLoss`.</span>
</span><span id="BaseClassifier-114"><a href="#BaseClassifier-114"><span class="linenos">114</span></a><span class="sd">                * **clustering_method (`&quot;louvain&quot;` or `&quot;peer_pressure&quot;`)**:</span>
</span><span id="BaseClassifier-115"><a href="#BaseClassifier-115"><span class="linenos">115</span></a><span class="sd">                  Clustering algorithm for the dataset of latent</span>
</span><span id="BaseClassifier-116"><a href="#BaseClassifier-116"><span class="linenos">116</span></a><span class="sd">                  representations.</span>
</span><span id="BaseClassifier-117"><a href="#BaseClassifier-117"><span class="linenos">117</span></a><span class="sd">            ce_weight (float, optional): Weight of the cross-entropy loss in the</span>
</span><span id="BaseClassifier-118"><a href="#BaseClassifier-118"><span class="linenos">118</span></a><span class="sd">                clustering-CE loss. Ignored if LCC is not applied. Defaults to</span>
</span><span id="BaseClassifier-119"><a href="#BaseClassifier-119"><span class="linenos">119</span></a><span class="sd">                $1$.</span>
</span><span id="BaseClassifier-120"><a href="#BaseClassifier-120"><span class="linenos">120</span></a><span class="sd">            image_key (Any, optional): A batch passed to the model can be a</span>
</span><span id="BaseClassifier-121"><a href="#BaseClassifier-121"><span class="linenos">121</span></a><span class="sd">                tuple (most common) or a dict. This parameter specifies the key</span>
</span><span id="BaseClassifier-122"><a href="#BaseClassifier-122"><span class="linenos">122</span></a><span class="sd">                to use to retrieve the input tensor.</span>
</span><span id="BaseClassifier-123"><a href="#BaseClassifier-123"><span class="linenos">123</span></a><span class="sd">            label_key (Any, optional): Analogous to `image_key`.</span>
</span><span id="BaseClassifier-124"><a href="#BaseClassifier-124"><span class="linenos">124</span></a><span class="sd">            kwargs: Forwarded to</span>
</span><span id="BaseClassifier-125"><a href="#BaseClassifier-125"><span class="linenos">125</span></a><span class="sd">                [`pl.LightningModule`](https://lightning.ai/docs/pytorch/stable/common/lightning_module.html#)</span>
</span><span id="BaseClassifier-126"><a href="#BaseClassifier-126"><span class="linenos">126</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier-127"><a href="#BaseClassifier-127"><span class="linenos">127</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="BaseClassifier-128"><a href="#BaseClassifier-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">(</span>
</span><span id="BaseClassifier-129"><a href="#BaseClassifier-129"><span class="linenos">129</span></a>            <span class="s2">&quot;ce_weight&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier-130"><a href="#BaseClassifier-130"><span class="linenos">130</span></a>            <span class="s2">&quot;image_key&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier-131"><a href="#BaseClassifier-131"><span class="linenos">131</span></a>            <span class="s2">&quot;label_key&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier-132"><a href="#BaseClassifier-132"><span class="linenos">132</span></a>            <span class="s2">&quot;lcc_kwargs&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier-133"><a href="#BaseClassifier-133"><span class="linenos">133</span></a>            <span class="s2">&quot;lcc_submodules&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier-134"><a href="#BaseClassifier-134"><span class="linenos">134</span></a>            <span class="s2">&quot;n_classes&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier-135"><a href="#BaseClassifier-135"><span class="linenos">135</span></a>        <span class="p">)</span>
</span><span id="BaseClassifier-136"><a href="#BaseClassifier-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">lcc_submodules</span><span class="p">:</span>
</span><span id="BaseClassifier-137"><a href="#BaseClassifier-137"><span class="linenos">137</span></a>            <span class="n">validate_lcc_kwargs</span><span class="p">(</span><span class="n">lcc_kwargs</span><span class="p">)</span>
</span><span id="BaseClassifier-138"><a href="#BaseClassifier-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">standard_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
</span><span id="BaseClassifier-139"><a href="#BaseClassifier-139"><span class="linenos">139</span></a>        <span class="n">acc_kw</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="BaseClassifier-140"><a href="#BaseClassifier-140"><span class="linenos">140</span></a>            <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="s2">&quot;multiclass&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier-141"><a href="#BaseClassifier-141"><span class="linenos">141</span></a>            <span class="s2">&quot;num_classes&quot;</span><span class="p">:</span> <span class="n">n_classes</span><span class="p">,</span>
</span><span id="BaseClassifier-142"><a href="#BaseClassifier-142"><span class="linenos">142</span></a>            <span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="s2">&quot;micro&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier-143"><a href="#BaseClassifier-143"><span class="linenos">143</span></a>        <span class="p">}</span>
</span><span id="BaseClassifier-144"><a href="#BaseClassifier-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_top1</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">acc_kw</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="BaseClassifier-145"><a href="#BaseClassifier-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">n_classes</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="BaseClassifier-146"><a href="#BaseClassifier-146"><span class="linenos">146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_top5</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">acc_kw</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="BaseClassifier-147"><a href="#BaseClassifier-147"><span class="linenos">147</span></a>
</span><span id="BaseClassifier-148"><a href="#BaseClassifier-148"><span class="linenos">148</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">,</span> <span class="n">stage</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="BaseClassifier-149"><a href="#BaseClassifier-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Self-explanatory&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-150"><a href="#BaseClassifier-150"><span class="linenos">150</span></a>        <span class="n">image_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;image_key&quot;</span><span class="p">]</span>
</span><span id="BaseClassifier-151"><a href="#BaseClassifier-151"><span class="linenos">151</span></a>        <span class="n">label_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;label_key&quot;</span><span class="p">]</span>
</span><span id="BaseClassifier-152"><a href="#BaseClassifier-152"><span class="linenos">152</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="n">image_key</span><span class="p">],</span> <span class="n">batch</span><span class="p">[</span><span class="n">label_key</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="BaseClassifier-153"><a href="#BaseClassifier-153"><span class="linenos">153</span></a>        <span class="n">latent</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="BaseClassifier-154"><a href="#BaseClassifier-154"><span class="linenos">154</span></a>        <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_intermediate</span><span class="p">(</span>
</span><span id="BaseClassifier-155"><a href="#BaseClassifier-155"><span class="linenos">155</span></a>            <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lcc_submodules</span><span class="p">,</span> <span class="n">latent</span><span class="p">,</span> <span class="n">keep_gradients</span><span class="o">=</span><span class="kc">True</span>
</span><span id="BaseClassifier-156"><a href="#BaseClassifier-156"><span class="linenos">156</span></a>        <span class="p">)</span>
</span><span id="BaseClassifier-157"><a href="#BaseClassifier-157"><span class="linenos">157</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">)</span>
</span><span id="BaseClassifier-158"><a href="#BaseClassifier-158"><span class="linenos">158</span></a>        <span class="n">loss_ce</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_loss</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="BaseClassifier-159"><a href="#BaseClassifier-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lcc_data</span> <span class="ow">and</span> <span class="n">stage</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span><span class="p">:</span>
</span><span id="BaseClassifier-160"><a href="#BaseClassifier-160"><span class="linenos">160</span></a>            <span class="n">idx</span> <span class="o">=</span> <span class="n">to_array</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s2">&quot;_idx&quot;</span><span class="p">])</span>
</span><span id="BaseClassifier-161"><a href="#BaseClassifier-161"><span class="linenos">161</span></a>            <span class="n">_losses</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="BaseClassifier-162"><a href="#BaseClassifier-162"><span class="linenos">162</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lcc_data</span><span class="p">[</span><span class="n">sm</span><span class="p">]</span><span class="o">.</span><span class="n">loss</span><span class="p">(</span>
</span><span id="BaseClassifier-163"><a href="#BaseClassifier-163"><span class="linenos">163</span></a>                    <span class="n">z</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">y_clst</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lcc_data</span><span class="p">[</span><span class="n">sm</span><span class="p">]</span><span class="o">.</span><span class="n">y_clst</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="BaseClassifier-164"><a href="#BaseClassifier-164"><span class="linenos">164</span></a>                <span class="p">)</span>
</span><span id="BaseClassifier-165"><a href="#BaseClassifier-165"><span class="linenos">165</span></a>                <span class="k">for</span> <span class="n">sm</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">latent</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="BaseClassifier-166"><a href="#BaseClassifier-166"><span class="linenos">166</span></a>            <span class="p">]</span>
</span><span id="BaseClassifier-167"><a href="#BaseClassifier-167"><span class="linenos">167</span></a>            <span class="n">loss_lcc</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="BaseClassifier-168"><a href="#BaseClassifier-168"><span class="linenos">168</span></a>                <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">_losses</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="BaseClassifier-169"><a href="#BaseClassifier-169"><span class="linenos">169</span></a>                <span class="k">if</span> <span class="n">_losses</span>
</span><span id="BaseClassifier-170"><a href="#BaseClassifier-170"><span class="linenos">170</span></a>                <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="BaseClassifier-171"><a href="#BaseClassifier-171"><span class="linenos">171</span></a>                <span class="c1">#  actually need grad?</span>
</span><span id="BaseClassifier-172"><a href="#BaseClassifier-172"><span class="linenos">172</span></a>            <span class="p">)</span>
</span><span id="BaseClassifier-173"><a href="#BaseClassifier-173"><span class="linenos">173</span></a>            <span class="n">lcc_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lcc_kwargs&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">)</span>
</span><span id="BaseClassifier-174"><a href="#BaseClassifier-174"><span class="linenos">174</span></a>            <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;ce_weight&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">loss_ce</span> <span class="o">+</span> <span class="n">lcc_weight</span> <span class="o">*</span> <span class="n">loss_lcc</span>
</span><span id="BaseClassifier-175"><a href="#BaseClassifier-175"><span class="linenos">175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s2">/lcc&quot;</span><span class="p">,</span> <span class="n">loss_lcc</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="BaseClassifier-176"><a href="#BaseClassifier-176"><span class="linenos">176</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BaseClassifier-177"><a href="#BaseClassifier-177"><span class="linenos">177</span></a>            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_ce</span>
</span><span id="BaseClassifier-178"><a href="#BaseClassifier-178"><span class="linenos">178</span></a>        <span class="k">if</span> <span class="n">stage</span><span class="p">:</span>
</span><span id="BaseClassifier-179"><a href="#BaseClassifier-179"><span class="linenos">179</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="BaseClassifier-180"><a href="#BaseClassifier-180"><span class="linenos">180</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s2">/loss&quot;</span><span class="p">:</span> <span class="n">loss</span><span class="p">,</span>
</span><span id="BaseClassifier-181"><a href="#BaseClassifier-181"><span class="linenos">181</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s2">/ce&quot;</span><span class="p">:</span> <span class="n">loss_ce</span><span class="p">,</span>
</span><span id="BaseClassifier-182"><a href="#BaseClassifier-182"><span class="linenos">182</span></a>            <span class="p">}</span>
</span><span id="BaseClassifier-183"><a href="#BaseClassifier-183"><span class="linenos">183</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_top5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier-184"><a href="#BaseClassifier-184"><span class="linenos">184</span></a>                <span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s2">/acc5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_top5</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="BaseClassifier-185"><a href="#BaseClassifier-185"><span class="linenos">185</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="BaseClassifier-186"><a href="#BaseClassifier-186"><span class="linenos">186</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
</span><span id="BaseClassifier-187"><a href="#BaseClassifier-187"><span class="linenos">187</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s2">/acc&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier-188"><a href="#BaseClassifier-188"><span class="linenos">188</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_top1</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
</span><span id="BaseClassifier-189"><a href="#BaseClassifier-189"><span class="linenos">189</span></a>                <span class="n">prog_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="BaseClassifier-190"><a href="#BaseClassifier-190"><span class="linenos">190</span></a>                <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="BaseClassifier-191"><a href="#BaseClassifier-191"><span class="linenos">191</span></a>            <span class="p">)</span>
</span><span id="BaseClassifier-192"><a href="#BaseClassifier-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="n">loss</span>  <span class="c1"># type: ignore</span>
</span><span id="BaseClassifier-193"><a href="#BaseClassifier-193"><span class="linenos">193</span></a>
</span><span id="BaseClassifier-194"><a href="#BaseClassifier-194"><span class="linenos">194</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">configure_optimizers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="BaseClassifier-195"><a href="#BaseClassifier-195"><span class="linenos">195</span></a>        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span id="BaseClassifier-196"><a href="#BaseClassifier-196"><span class="linenos">196</span></a>        <span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">CosineAnnealingLR</span><span class="p">(</span>
</span><span id="BaseClassifier-197"><a href="#BaseClassifier-197"><span class="linenos">197</span></a>            <span class="n">optimizer</span><span class="p">,</span> <span class="n">T_max</span><span class="o">=</span><span class="mi">50</span>
</span><span id="BaseClassifier-198"><a href="#BaseClassifier-198"><span class="linenos">198</span></a>        <span class="p">)</span>
</span><span id="BaseClassifier-199"><a href="#BaseClassifier-199"><span class="linenos">199</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="BaseClassifier-200"><a href="#BaseClassifier-200"><span class="linenos">200</span></a>            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
</span><span id="BaseClassifier-201"><a href="#BaseClassifier-201"><span class="linenos">201</span></a>            <span class="s2">&quot;lr_scheduler&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scheduler&quot;</span><span class="p">:</span> <span class="n">scheduler</span><span class="p">},</span>
</span><span id="BaseClassifier-202"><a href="#BaseClassifier-202"><span class="linenos">202</span></a>        <span class="p">}</span>
</span><span id="BaseClassifier-203"><a href="#BaseClassifier-203"><span class="linenos">203</span></a>
</span><span id="BaseClassifier-204"><a href="#BaseClassifier-204"><span class="linenos">204</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward_intermediate</span><span class="p">(</span>
</span><span id="BaseClassifier-205"><a href="#BaseClassifier-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="BaseClassifier-206"><a href="#BaseClassifier-206"><span class="linenos">206</span></a>        <span class="n">inputs</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">|</span> <span class="n">Batch</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Batch</span><span class="p">],</span>
</span><span id="BaseClassifier-207"><a href="#BaseClassifier-207"><span class="linenos">207</span></a>        <span class="n">submodules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="BaseClassifier-208"><a href="#BaseClassifier-208"><span class="linenos">208</span></a>        <span class="n">output_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="BaseClassifier-209"><a href="#BaseClassifier-209"><span class="linenos">209</span></a>        <span class="n">keep_gradients</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BaseClassifier-210"><a href="#BaseClassifier-210"><span class="linenos">210</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="BaseClassifier-211"><a href="#BaseClassifier-211"><span class="linenos">211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-212"><a href="#BaseClassifier-212"><span class="linenos">212</span></a><span class="sd">        Runs the model and collects the output of specified submodules. The</span>
</span><span id="BaseClassifier-213"><a href="#BaseClassifier-213"><span class="linenos">213</span></a><span class="sd">        intermediate outputs are stored in `output_dict` under the</span>
</span><span id="BaseClassifier-214"><a href="#BaseClassifier-214"><span class="linenos">214</span></a><span class="sd">        corresponding submodule name. In particular, this method has side</span>
</span><span id="BaseClassifier-215"><a href="#BaseClassifier-215"><span class="linenos">215</span></a><span class="sd">        effects.</span>
</span><span id="BaseClassifier-216"><a href="#BaseClassifier-216"><span class="linenos">216</span></a>
</span><span id="BaseClassifier-217"><a href="#BaseClassifier-217"><span class="linenos">217</span></a><span class="sd">        Args:</span>
</span><span id="BaseClassifier-218"><a href="#BaseClassifier-218"><span class="linenos">218</span></a><span class="sd">            x (Tensor | Batch | list[Tensor] | list[Batch]): If batched (i.e.</span>
</span><span id="BaseClassifier-219"><a href="#BaseClassifier-219"><span class="linenos">219</span></a><span class="sd">                `x` is a list), then so is the output of this function and the</span>
</span><span id="BaseClassifier-220"><a href="#BaseClassifier-220"><span class="linenos">220</span></a><span class="sd">                entries in the `output_dict`</span>
</span><span id="BaseClassifier-221"><a href="#BaseClassifier-221"><span class="linenos">221</span></a><span class="sd">            submodules (list[str]):</span>
</span><span id="BaseClassifier-222"><a href="#BaseClassifier-222"><span class="linenos">222</span></a><span class="sd">            output_dict (dict):</span>
</span><span id="BaseClassifier-223"><a href="#BaseClassifier-223"><span class="linenos">223</span></a><span class="sd">            keep_gradients (bool, optional): If `True`, the tensors in</span>
</span><span id="BaseClassifier-224"><a href="#BaseClassifier-224"><span class="linenos">224</span></a><span class="sd">                `output_dict` keep their gradients (if they had some on the</span>
</span><span id="BaseClassifier-225"><a href="#BaseClassifier-225"><span class="linenos">225</span></a><span class="sd">                first place). If `False`, they are detached and moved to the</span>
</span><span id="BaseClassifier-226"><a href="#BaseClassifier-226"><span class="linenos">226</span></a><span class="sd">                CPU.</span>
</span><span id="BaseClassifier-227"><a href="#BaseClassifier-227"><span class="linenos">227</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier-228"><a href="#BaseClassifier-228"><span class="linenos">228</span></a>
</span><span id="BaseClassifier-229"><a href="#BaseClassifier-229"><span class="linenos">229</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">maybe_detach</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="BaseClassifier-230"><a href="#BaseClassifier-230"><span class="linenos">230</span></a>            <span class="k">return</span> <span class="n">x</span> <span class="k">if</span> <span class="n">keep_gradients</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
</span><span id="BaseClassifier-231"><a href="#BaseClassifier-231"><span class="linenos">231</span></a>
</span><span id="BaseClassifier-232"><a href="#BaseClassifier-232"><span class="linenos">232</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_hook</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="BaseClassifier-233"><a href="#BaseClassifier-233"><span class="linenos">233</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">hook</span><span class="p">(</span><span class="n">_model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">_args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier-234"><a href="#BaseClassifier-234"><span class="linenos">234</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="BaseClassifier-235"><a href="#BaseClassifier-235"><span class="linenos">235</span></a>                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
</span><span id="BaseClassifier-236"><a href="#BaseClassifier-236"><span class="linenos">236</span></a>                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="BaseClassifier-237"><a href="#BaseClassifier-237"><span class="linenos">237</span></a>                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tensor</span><span class="p">)</span>
</span><span id="BaseClassifier-238"><a href="#BaseClassifier-238"><span class="linenos">238</span></a>                <span class="p">):</span>
</span><span id="BaseClassifier-239"><a href="#BaseClassifier-239"><span class="linenos">239</span></a>                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="BaseClassifier-240"><a href="#BaseClassifier-240"><span class="linenos">240</span></a>                <span class="k">elif</span> <span class="p">(</span>  <span class="c1"># Special case for ViTs</span>
</span><span id="BaseClassifier-241"><a href="#BaseClassifier-241"><span class="linenos">241</span></a>                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
</span><span id="BaseClassifier-242"><a href="#BaseClassifier-242"><span class="linenos">242</span></a>                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
</span><span id="BaseClassifier-243"><a href="#BaseClassifier-243"><span class="linenos">243</span></a>                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tensor</span><span class="p">)</span>
</span><span id="BaseClassifier-244"><a href="#BaseClassifier-244"><span class="linenos">244</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Tensor</span><span class="p">)</span>
</span><span id="BaseClassifier-245"><a href="#BaseClassifier-245"><span class="linenos">245</span></a>                <span class="p">):</span>
</span><span id="BaseClassifier-246"><a href="#BaseClassifier-246"><span class="linenos">246</span></a>                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="BaseClassifier-247"><a href="#BaseClassifier-247"><span class="linenos">247</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">):</span>
</span><span id="BaseClassifier-248"><a href="#BaseClassifier-248"><span class="linenos">248</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="BaseClassifier-249"><a href="#BaseClassifier-249"><span class="linenos">249</span></a>                        <span class="sa">f</span><span class="s2">&quot;Unsupported latent object type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">out</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="BaseClassifier-250"><a href="#BaseClassifier-250"><span class="linenos">250</span></a>                    <span class="p">)</span>
</span><span id="BaseClassifier-251"><a href="#BaseClassifier-251"><span class="linenos">251</span></a>                <span class="k">if</span> <span class="n">batched</span><span class="p">:</span>
</span><span id="BaseClassifier-252"><a href="#BaseClassifier-252"><span class="linenos">252</span></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output_dict</span><span class="p">:</span>
</span><span id="BaseClassifier-253"><a href="#BaseClassifier-253"><span class="linenos">253</span></a>                        <span class="n">output_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="BaseClassifier-254"><a href="#BaseClassifier-254"><span class="linenos">254</span></a>                    <span class="n">output_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maybe_detach</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
</span><span id="BaseClassifier-255"><a href="#BaseClassifier-255"><span class="linenos">255</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="BaseClassifier-256"><a href="#BaseClassifier-256"><span class="linenos">256</span></a>                    <span class="n">output_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">maybe_detach</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span id="BaseClassifier-257"><a href="#BaseClassifier-257"><span class="linenos">257</span></a>
</span><span id="BaseClassifier-258"><a href="#BaseClassifier-258"><span class="linenos">258</span></a>            <span class="k">return</span> <span class="n">hook</span>
</span><span id="BaseClassifier-259"><a href="#BaseClassifier-259"><span class="linenos">259</span></a>
</span><span id="BaseClassifier-260"><a href="#BaseClassifier-260"><span class="linenos">260</span></a>        <span class="n">batched</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
</span><span id="BaseClassifier-261"><a href="#BaseClassifier-261"><span class="linenos">261</span></a>        <span class="n">handles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RemovableHandle</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="BaseClassifier-262"><a href="#BaseClassifier-262"><span class="linenos">262</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">submodules</span><span class="p">:</span>
</span><span id="BaseClassifier-263"><a href="#BaseClassifier-263"><span class="linenos">263</span></a>            <span class="n">submodule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_submodule</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="BaseClassifier-264"><a href="#BaseClassifier-264"><span class="linenos">264</span></a>            <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submodule</span><span class="o">.</span><span class="n">register_forward_hook</span><span class="p">(</span><span class="n">create_hook</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>
</span><span id="BaseClassifier-265"><a href="#BaseClassifier-265"><span class="linenos">265</span></a>        <span class="k">if</span> <span class="n">batched</span><span class="p">:</span>
</span><span id="BaseClassifier-266"><a href="#BaseClassifier-266"><span class="linenos">266</span></a>            <span class="n">logits</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="BaseClassifier-267"><a href="#BaseClassifier-267"><span class="linenos">267</span></a>                <span class="n">maybe_detach</span><span class="p">(</span>
</span><span id="BaseClassifier-268"><a href="#BaseClassifier-268"><span class="linenos">268</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span>
</span><span id="BaseClassifier-269"><a href="#BaseClassifier-269"><span class="linenos">269</span></a>                        <span class="n">batch</span>
</span><span id="BaseClassifier-270"><a href="#BaseClassifier-270"><span class="linenos">270</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">)</span>
</span><span id="BaseClassifier-271"><a href="#BaseClassifier-271"><span class="linenos">271</span></a>                        <span class="k">else</span> <span class="n">batch</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;image_key&quot;</span><span class="p">]]</span>
</span><span id="BaseClassifier-272"><a href="#BaseClassifier-272"><span class="linenos">272</span></a>                    <span class="p">)</span>
</span><span id="BaseClassifier-273"><a href="#BaseClassifier-273"><span class="linenos">273</span></a>                <span class="p">)</span>
</span><span id="BaseClassifier-274"><a href="#BaseClassifier-274"><span class="linenos">274</span></a>                <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">inputs</span>
</span><span id="BaseClassifier-275"><a href="#BaseClassifier-275"><span class="linenos">275</span></a>            <span class="p">]</span>
</span><span id="BaseClassifier-276"><a href="#BaseClassifier-276"><span class="linenos">276</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BaseClassifier-277"><a href="#BaseClassifier-277"><span class="linenos">277</span></a>            <span class="n">logits</span> <span class="o">=</span> <span class="n">maybe_detach</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="BaseClassifier-278"><a href="#BaseClassifier-278"><span class="linenos">278</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span>
</span><span id="BaseClassifier-279"><a href="#BaseClassifier-279"><span class="linenos">279</span></a>                    <span class="n">inputs</span>
</span><span id="BaseClassifier-280"><a href="#BaseClassifier-280"><span class="linenos">280</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">)</span>
</span><span id="BaseClassifier-281"><a href="#BaseClassifier-281"><span class="linenos">281</span></a>                    <span class="k">else</span> <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;image_key&quot;</span><span class="p">]]</span>
</span><span id="BaseClassifier-282"><a href="#BaseClassifier-282"><span class="linenos">282</span></a>                <span class="p">)</span>
</span><span id="BaseClassifier-283"><a href="#BaseClassifier-283"><span class="linenos">283</span></a>            <span class="p">)</span>
</span><span id="BaseClassifier-284"><a href="#BaseClassifier-284"><span class="linenos">284</span></a>        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">:</span>
</span><span id="BaseClassifier-285"><a href="#BaseClassifier-285"><span class="linenos">285</span></a>            <span class="n">h</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</span><span id="BaseClassifier-286"><a href="#BaseClassifier-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="n">logits</span>
</span><span id="BaseClassifier-287"><a href="#BaseClassifier-287"><span class="linenos">287</span></a>
</span><span id="BaseClassifier-288"><a href="#BaseClassifier-288"><span class="linenos">288</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BaseClassifier-289"><a href="#BaseClassifier-289"><span class="linenos">289</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_processor</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="BaseClassifier-290"><a href="#BaseClassifier-290"><span class="linenos">290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-291"><a href="#BaseClassifier-291"><span class="linenos">291</span></a><span class="sd">        Returns an image processor for the model. By defaults, returns the</span>
</span><span id="BaseClassifier-292"><a href="#BaseClassifier-292"><span class="linenos">292</span></a><span class="sd">        identity function.</span>
</span><span id="BaseClassifier-293"><a href="#BaseClassifier-293"><span class="linenos">293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier-294"><a href="#BaseClassifier-294"><span class="linenos">294</span></a>        <span class="k">return</span> <span class="k">lambda</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">input</span>
</span><span id="BaseClassifier-295"><a href="#BaseClassifier-295"><span class="linenos">295</span></a>
</span><span id="BaseClassifier-296"><a href="#BaseClassifier-296"><span class="linenos">296</span></a>    <span class="nd">@property</span>
</span><span id="BaseClassifier-297"><a href="#BaseClassifier-297"><span class="linenos">297</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lcc_submodules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="BaseClassifier-298"><a href="#BaseClassifier-298"><span class="linenos">298</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-299"><a href="#BaseClassifier-299"><span class="linenos">299</span></a><span class="sd">        Returns the list of submodules considered for LCC, whith correct prefix</span>
</span><span id="BaseClassifier-300"><a href="#BaseClassifier-300"><span class="linenos">300</span></a><span class="sd">        if needed.</span>
</span><span id="BaseClassifier-301"><a href="#BaseClassifier-301"><span class="linenos">301</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier-302"><a href="#BaseClassifier-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lcc_submodules&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span id="BaseClassifier-303"><a href="#BaseClassifier-303"><span class="linenos">303</span></a>
</span><span id="BaseClassifier-304"><a href="#BaseClassifier-304"><span class="linenos">304</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_train_batch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier-305"><a href="#BaseClassifier-305"><span class="linenos">305</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Just logs all optimizer&#39;s learning rate&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-306"><a href="#BaseClassifier-306"><span class="linenos">306</span></a>        <span class="n">log_optimizers_lr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="BaseClassifier-307"><a href="#BaseClassifier-307"><span class="linenos">307</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_batch_end</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="BaseClassifier-308"><a href="#BaseClassifier-308"><span class="linenos">308</span></a>
</span><span id="BaseClassifier-309"><a href="#BaseClassifier-309"><span class="linenos">309</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_train_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier-310"><a href="#BaseClassifier-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cleans up training specific temporary attributes&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-311"><a href="#BaseClassifier-311"><span class="linenos">311</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lcc_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="BaseClassifier-312"><a href="#BaseClassifier-312"><span class="linenos">312</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_epoch_end</span><span class="p">()</span>
</span><span id="BaseClassifier-313"><a href="#BaseClassifier-313"><span class="linenos">313</span></a>
</span><span id="BaseClassifier-314"><a href="#BaseClassifier-314"><span class="linenos">314</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_train_epoch_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier-315"><a href="#BaseClassifier-315"><span class="linenos">315</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-316"><a href="#BaseClassifier-316"><span class="linenos">316</span></a><span class="sd">        Performs dataset-wide latent clustering and stores the results in</span>
</span><span id="BaseClassifier-317"><a href="#BaseClassifier-317"><span class="linenos">317</span></a><span class="sd">        private attribute `BaseClassifier._lc_data`.</span>
</span><span id="BaseClassifier-318"><a href="#BaseClassifier-318"><span class="linenos">318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier-319"><a href="#BaseClassifier-319"><span class="linenos">319</span></a>        <span class="c1"># wether to apply LCC this epoch</span>
</span><span id="BaseClassifier-320"><a href="#BaseClassifier-320"><span class="linenos">320</span></a>        <span class="n">lcc_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lcc_kwargs&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="BaseClassifier-321"><a href="#BaseClassifier-321"><span class="linenos">321</span></a>        <span class="n">do_lcc</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="BaseClassifier-322"><a href="#BaseClassifier-322"><span class="linenos">322</span></a>            <span class="c1"># we are passed warmup (lcc_warmup being None is equivalent to no</span>
</span><span id="BaseClassifier-323"><a href="#BaseClassifier-323"><span class="linenos">323</span></a>            <span class="c1"># warmup)...</span>
</span><span id="BaseClassifier-324"><a href="#BaseClassifier-324"><span class="linenos">324</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;warmup&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="BaseClassifier-325"><a href="#BaseClassifier-325"><span class="linenos">325</span></a>            <span class="ow">and</span> <span class="p">(</span>
</span><span id="BaseClassifier-326"><a href="#BaseClassifier-326"><span class="linenos">326</span></a>                <span class="c1"># ... and an LCC interval is specified...</span>
</span><span id="BaseClassifier-327"><a href="#BaseClassifier-327"><span class="linenos">327</span></a>                <span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interval&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="BaseClassifier-328"><a href="#BaseClassifier-328"><span class="linenos">328</span></a>                <span class="c1"># ... and the current epoch can have LCC done...</span>
</span><span id="BaseClassifier-329"><a href="#BaseClassifier-329"><span class="linenos">329</span></a>                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="BaseClassifier-330"><a href="#BaseClassifier-330"><span class="linenos">330</span></a>                <span class="o">==</span> <span class="mi">0</span>
</span><span id="BaseClassifier-331"><a href="#BaseClassifier-331"><span class="linenos">331</span></a>            <span class="p">)</span>
</span><span id="BaseClassifier-332"><a href="#BaseClassifier-332"><span class="linenos">332</span></a>            <span class="c1"># ... and there are submodule selected for LCC...</span>
</span><span id="BaseClassifier-333"><a href="#BaseClassifier-333"><span class="linenos">333</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lcc_submodules</span>
</span><span id="BaseClassifier-334"><a href="#BaseClassifier-334"><span class="linenos">334</span></a>            <span class="c1"># ... and the LCC weight is non-zero</span>
</span><span id="BaseClassifier-335"><a href="#BaseClassifier-335"><span class="linenos">335</span></a>            <span class="ow">and</span> <span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="BaseClassifier-336"><a href="#BaseClassifier-336"><span class="linenos">336</span></a>        <span class="p">)</span>
</span><span id="BaseClassifier-337"><a href="#BaseClassifier-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="n">do_lcc</span><span class="p">:</span>
</span><span id="BaseClassifier-338"><a href="#BaseClassifier-338"><span class="linenos">338</span></a>            <span class="c1"># The import has to be here to prevent circular imports while having</span>
</span><span id="BaseClassifier-339"><a href="#BaseClassifier-339"><span class="linenos">339</span></a>            <span class="c1"># all the FDLC logic in a separate file</span>
</span><span id="BaseClassifier-340"><a href="#BaseClassifier-340"><span class="linenos">340</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.fdlc</span><span class="w"> </span><span class="kn">import</span> <span class="n">full_dataset_latent_clustering</span>
</span><span id="BaseClassifier-341"><a href="#BaseClassifier-341"><span class="linenos">341</span></a>
</span><span id="BaseClassifier-342"><a href="#BaseClassifier-342"><span class="linenos">342</span></a>            <span class="k">with</span> <span class="n">temporary_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_path</span><span class="p">:</span>
</span><span id="BaseClassifier-343"><a href="#BaseClassifier-343"><span class="linenos">343</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lcc_data</span> <span class="o">=</span> <span class="n">full_dataset_latent_clustering</span><span class="p">(</span>
</span><span id="BaseClassifier-344"><a href="#BaseClassifier-344"><span class="linenos">344</span></a>                    <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="BaseClassifier-345"><a href="#BaseClassifier-345"><span class="linenos">345</span></a>                    <span class="n">output_dir</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">,</span>
</span><span id="BaseClassifier-346"><a href="#BaseClassifier-346"><span class="linenos">346</span></a>                    <span class="n">tqdm_style</span><span class="o">=</span><span class="s2">&quot;console&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier-347"><a href="#BaseClassifier-347"><span class="linenos">347</span></a>                <span class="p">)</span>
</span><span id="BaseClassifier-348"><a href="#BaseClassifier-348"><span class="linenos">348</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_epoch_start</span><span class="p">()</span>
</span><span id="BaseClassifier-349"><a href="#BaseClassifier-349"><span class="linenos">349</span></a>
</span><span id="BaseClassifier-350"><a href="#BaseClassifier-350"><span class="linenos">350</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_train_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier-351"><a href="#BaseClassifier-351"><span class="linenos">351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-352"><a href="#BaseClassifier-352"><span class="linenos">352</span></a><span class="sd">        Explicitly registers hyperparameters and metrics. You&#39;d think Lightning</span>
</span><span id="BaseClassifier-353"><a href="#BaseClassifier-353"><span class="linenos">353</span></a><span class="sd">        would do this automatically, but nope.</span>
</span><span id="BaseClassifier-354"><a href="#BaseClassifier-354"><span class="linenos">354</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier-355"><a href="#BaseClassifier-355"><span class="linenos">355</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_hyperparams</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="BaseClassifier-356"><a href="#BaseClassifier-356"><span class="linenos">356</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">,</span>
</span><span id="BaseClassifier-357"><a href="#BaseClassifier-357"><span class="linenos">357</span></a>            <span class="p">{</span>
</span><span id="BaseClassifier-358"><a href="#BaseClassifier-358"><span class="linenos">358</span></a>                <span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">m</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="BaseClassifier-359"><a href="#BaseClassifier-359"><span class="linenos">359</span></a>                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span>
</span><span id="BaseClassifier-360"><a href="#BaseClassifier-360"><span class="linenos">360</span></a>                    <span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;acc&quot;</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="s2">&quot;ce&quot;</span><span class="p">,</span> <span class="s2">&quot;lcc&quot;</span><span class="p">]</span>
</span><span id="BaseClassifier-361"><a href="#BaseClassifier-361"><span class="linenos">361</span></a>                <span class="p">)</span>
</span><span id="BaseClassifier-362"><a href="#BaseClassifier-362"><span class="linenos">362</span></a>            <span class="p">},</span>
</span><span id="BaseClassifier-363"><a href="#BaseClassifier-363"><span class="linenos">363</span></a>        <span class="p">)</span>
</span><span id="BaseClassifier-364"><a href="#BaseClassifier-364"><span class="linenos">364</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_start</span><span class="p">()</span>
</span><span id="BaseClassifier-365"><a href="#BaseClassifier-365"><span class="linenos">365</span></a>
</span><span id="BaseClassifier-366"><a href="#BaseClassifier-366"><span class="linenos">366</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="BaseClassifier-367"><a href="#BaseClassifier-367"><span class="linenos">367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Override from `pl.LightningModule.test_step`.&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-368"><a href="#BaseClassifier-368"><span class="linenos">368</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span>
</span><span id="BaseClassifier-369"><a href="#BaseClassifier-369"><span class="linenos">369</span></a>
</span><span id="BaseClassifier-370"><a href="#BaseClassifier-370"><span class="linenos">370</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">training_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="BaseClassifier-371"><a href="#BaseClassifier-371"><span class="linenos">371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Override from `pl.LightningModule.training_step`.&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-372"><a href="#BaseClassifier-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">)</span>
</span><span id="BaseClassifier-373"><a href="#BaseClassifier-373"><span class="linenos">373</span></a>
</span><span id="BaseClassifier-374"><a href="#BaseClassifier-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validation_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="BaseClassifier-375"><a href="#BaseClassifier-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Override from `pl.LightningModule.validation_step`.&quot;&quot;&quot;</span>
</span><span id="BaseClassifier-376"><a href="#BaseClassifier-376"><span class="linenos">376</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Base image classifier class that supports LCC.</p>

<h6 id="warning">Warning:</h6>

<blockquote>
  <p>When subclassing this, remember that the forward method must be able to
  deal with either <code>Tensor</code> or <code>Batch</code> inputs, and must return a logit
  <code>Tensor</code>.</p>
</blockquote>
</div>


                            <div id="BaseClassifier.__init__" class="classattr">
                                        <input id="BaseClassifier.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">BaseClassifier</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">lcc_submodules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lcc_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ce_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">image_key</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">label_key</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="BaseClassifier.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.__init__-74"><a href="#BaseClassifier.__init__-74"><span class="linenos"> 74</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="BaseClassifier.__init__-75"><a href="#BaseClassifier.__init__-75"><span class="linenos"> 75</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-76"><a href="#BaseClassifier.__init__-76"><span class="linenos"> 76</span></a>        <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-77"><a href="#BaseClassifier.__init__-77"><span class="linenos"> 77</span></a>        <span class="n">lcc_submodules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-78"><a href="#BaseClassifier.__init__-78"><span class="linenos"> 78</span></a>        <span class="n">lcc_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-79"><a href="#BaseClassifier.__init__-79"><span class="linenos"> 79</span></a>        <span class="n">ce_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-80"><a href="#BaseClassifier.__init__-80"><span class="linenos"> 80</span></a>        <span class="n">image_key</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-81"><a href="#BaseClassifier.__init__-81"><span class="linenos"> 81</span></a>        <span class="n">label_key</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-82"><a href="#BaseClassifier.__init__-82"><span class="linenos"> 82</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-83"><a href="#BaseClassifier.__init__-83"><span class="linenos"> 83</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier.__init__-84"><a href="#BaseClassifier.__init__-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier.__init__-85"><a href="#BaseClassifier.__init__-85"><span class="linenos"> 85</span></a><span class="sd">        Args:</span>
</span><span id="BaseClassifier.__init__-86"><a href="#BaseClassifier.__init__-86"><span class="linenos"> 86</span></a><span class="sd">            n_classes (int):</span>
</span><span id="BaseClassifier.__init__-87"><a href="#BaseClassifier.__init__-87"><span class="linenos"> 87</span></a><span class="sd">            lcc_submodules (list[str] | None, optional): Submodules to consider</span>
</span><span id="BaseClassifier.__init__-88"><a href="#BaseClassifier.__init__-88"><span class="linenos"> 88</span></a><span class="sd">                for the latent correction loss. If `None` or `[]`, LCC is not</span>
</span><span id="BaseClassifier.__init__-89"><a href="#BaseClassifier.__init__-89"><span class="linenos"> 89</span></a><span class="sd">                performed</span>
</span><span id="BaseClassifier.__init__-90"><a href="#BaseClassifier.__init__-90"><span class="linenos"> 90</span></a><span class="sd">            lcc_kwargs (dict | None, optional): Optional parameters for LCC.</span>
</span><span id="BaseClassifier.__init__-91"><a href="#BaseClassifier.__init__-91"><span class="linenos"> 91</span></a><span class="sd">                Expected entries (all optional) are:</span>
</span><span id="BaseClassifier.__init__-92"><a href="#BaseClassifier.__init__-92"><span class="linenos"> 92</span></a><span class="sd">                * **weight (float):** Defaults to $10^{-4}$</span>
</span><span id="BaseClassifier.__init__-93"><a href="#BaseClassifier.__init__-93"><span class="linenos"> 93</span></a><span class="sd">                * **class_selection</span>
</span><span id="BaseClassifier.__init__-94"><a href="#BaseClassifier.__init__-94"><span class="linenos"> 94</span></a><span class="sd">                    (`lcc.correction.LCCClassSelection` | None):** Defaults to</span>
</span><span id="BaseClassifier.__init__-95"><a href="#BaseClassifier.__init__-95"><span class="linenos"> 95</span></a><span class="sd">                    `None`, which means all classes are considered for</span>
</span><span id="BaseClassifier.__init__-96"><a href="#BaseClassifier.__init__-96"><span class="linenos"> 96</span></a><span class="sd">                    correction</span>
</span><span id="BaseClassifier.__init__-97"><a href="#BaseClassifier.__init__-97"><span class="linenos"> 97</span></a><span class="sd">                * **interval (int):** Apply LCC every `interval` epochs.</span>
</span><span id="BaseClassifier.__init__-98"><a href="#BaseClassifier.__init__-98"><span class="linenos"> 98</span></a><span class="sd">                    Defaults to $1$, meaning LCC will be applied every epoch</span>
</span><span id="BaseClassifier.__init__-99"><a href="#BaseClassifier.__init__-99"><span class="linenos"> 99</span></a><span class="sd">                    (after warmup).</span>
</span><span id="BaseClassifier.__init__-100"><a href="#BaseClassifier.__init__-100"><span class="linenos">100</span></a><span class="sd">                * **warmup (int):** Number of epochs to wait before</span>
</span><span id="BaseClassifier.__init__-101"><a href="#BaseClassifier.__init__-101"><span class="linenos">101</span></a><span class="sd">                    starting LCC. Defaults to $0$, meaning LCC will start</span>
</span><span id="BaseClassifier.__init__-102"><a href="#BaseClassifier.__init__-102"><span class="linenos">102</span></a><span class="sd">                    immediately.</span>
</span><span id="BaseClassifier.__init__-103"><a href="#BaseClassifier.__init__-103"><span class="linenos">103</span></a><span class="sd">                * **k (int):** Number of nearest neighbors to consider for LCC,</span>
</span><span id="BaseClassifier.__init__-104"><a href="#BaseClassifier.__init__-104"><span class="linenos">104</span></a><span class="sd">                  and Louvain clustering.</span>
</span><span id="BaseClassifier.__init__-105"><a href="#BaseClassifier.__init__-105"><span class="linenos">105</span></a><span class="sd">                * **pca_dim (int):** Samples are reduced to this dimension</span>
</span><span id="BaseClassifier.__init__-106"><a href="#BaseClassifier.__init__-106"><span class="linenos">106</span></a><span class="sd">                  before constructing the KNN graph. This must be at most the</span>
</span><span id="BaseClassifier.__init__-107"><a href="#BaseClassifier.__init__-107"><span class="linenos">107</span></a><span class="sd">                  batch size.</span>
</span><span id="BaseClassifier.__init__-108"><a href="#BaseClassifier.__init__-108"><span class="linenos">108</span></a><span class="sd">                * **loss (`&quot;exact&quot;` or `&quot;randomized&quot;`)**: Way the LCC loss is</span>
</span><span id="BaseClassifier.__init__-109"><a href="#BaseClassifier.__init__-109"><span class="linenos">109</span></a><span class="sd">                  computed from the clustering data. See `lcc.correction.loss`.</span>
</span><span id="BaseClassifier.__init__-110"><a href="#BaseClassifier.__init__-110"><span class="linenos">110</span></a><span class="sd">                * **ccspc (int)**: If the loss type is `&quot;randomized&quot;`, then this</span>
</span><span id="BaseClassifier.__init__-111"><a href="#BaseClassifier.__init__-111"><span class="linenos">111</span></a><span class="sd">                  parameter specified the number of CC samples per cluster to</span>
</span><span id="BaseClassifier.__init__-112"><a href="#BaseClassifier.__init__-112"><span class="linenos">112</span></a><span class="sd">                  keep as potential correction targets. See also</span>
</span><span id="BaseClassifier.__init__-113"><a href="#BaseClassifier.__init__-113"><span class="linenos">113</span></a><span class="sd">                  `lcc.correction.loss.RandomizedLCCLoss`.</span>
</span><span id="BaseClassifier.__init__-114"><a href="#BaseClassifier.__init__-114"><span class="linenos">114</span></a><span class="sd">                * **clustering_method (`&quot;louvain&quot;` or `&quot;peer_pressure&quot;`)**:</span>
</span><span id="BaseClassifier.__init__-115"><a href="#BaseClassifier.__init__-115"><span class="linenos">115</span></a><span class="sd">                  Clustering algorithm for the dataset of latent</span>
</span><span id="BaseClassifier.__init__-116"><a href="#BaseClassifier.__init__-116"><span class="linenos">116</span></a><span class="sd">                  representations.</span>
</span><span id="BaseClassifier.__init__-117"><a href="#BaseClassifier.__init__-117"><span class="linenos">117</span></a><span class="sd">            ce_weight (float, optional): Weight of the cross-entropy loss in the</span>
</span><span id="BaseClassifier.__init__-118"><a href="#BaseClassifier.__init__-118"><span class="linenos">118</span></a><span class="sd">                clustering-CE loss. Ignored if LCC is not applied. Defaults to</span>
</span><span id="BaseClassifier.__init__-119"><a href="#BaseClassifier.__init__-119"><span class="linenos">119</span></a><span class="sd">                $1$.</span>
</span><span id="BaseClassifier.__init__-120"><a href="#BaseClassifier.__init__-120"><span class="linenos">120</span></a><span class="sd">            image_key (Any, optional): A batch passed to the model can be a</span>
</span><span id="BaseClassifier.__init__-121"><a href="#BaseClassifier.__init__-121"><span class="linenos">121</span></a><span class="sd">                tuple (most common) or a dict. This parameter specifies the key</span>
</span><span id="BaseClassifier.__init__-122"><a href="#BaseClassifier.__init__-122"><span class="linenos">122</span></a><span class="sd">                to use to retrieve the input tensor.</span>
</span><span id="BaseClassifier.__init__-123"><a href="#BaseClassifier.__init__-123"><span class="linenos">123</span></a><span class="sd">            label_key (Any, optional): Analogous to `image_key`.</span>
</span><span id="BaseClassifier.__init__-124"><a href="#BaseClassifier.__init__-124"><span class="linenos">124</span></a><span class="sd">            kwargs: Forwarded to</span>
</span><span id="BaseClassifier.__init__-125"><a href="#BaseClassifier.__init__-125"><span class="linenos">125</span></a><span class="sd">                [`pl.LightningModule`](https://lightning.ai/docs/pytorch/stable/common/lightning_module.html#)</span>
</span><span id="BaseClassifier.__init__-126"><a href="#BaseClassifier.__init__-126"><span class="linenos">126</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier.__init__-127"><a href="#BaseClassifier.__init__-127"><span class="linenos">127</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="BaseClassifier.__init__-128"><a href="#BaseClassifier.__init__-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">(</span>
</span><span id="BaseClassifier.__init__-129"><a href="#BaseClassifier.__init__-129"><span class="linenos">129</span></a>            <span class="s2">&quot;ce_weight&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-130"><a href="#BaseClassifier.__init__-130"><span class="linenos">130</span></a>            <span class="s2">&quot;image_key&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-131"><a href="#BaseClassifier.__init__-131"><span class="linenos">131</span></a>            <span class="s2">&quot;label_key&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-132"><a href="#BaseClassifier.__init__-132"><span class="linenos">132</span></a>            <span class="s2">&quot;lcc_kwargs&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-133"><a href="#BaseClassifier.__init__-133"><span class="linenos">133</span></a>            <span class="s2">&quot;lcc_submodules&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-134"><a href="#BaseClassifier.__init__-134"><span class="linenos">134</span></a>            <span class="s2">&quot;n_classes&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-135"><a href="#BaseClassifier.__init__-135"><span class="linenos">135</span></a>        <span class="p">)</span>
</span><span id="BaseClassifier.__init__-136"><a href="#BaseClassifier.__init__-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">lcc_submodules</span><span class="p">:</span>
</span><span id="BaseClassifier.__init__-137"><a href="#BaseClassifier.__init__-137"><span class="linenos">137</span></a>            <span class="n">validate_lcc_kwargs</span><span class="p">(</span><span class="n">lcc_kwargs</span><span class="p">)</span>
</span><span id="BaseClassifier.__init__-138"><a href="#BaseClassifier.__init__-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">standard_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
</span><span id="BaseClassifier.__init__-139"><a href="#BaseClassifier.__init__-139"><span class="linenos">139</span></a>        <span class="n">acc_kw</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="BaseClassifier.__init__-140"><a href="#BaseClassifier.__init__-140"><span class="linenos">140</span></a>            <span class="s2">&quot;task&quot;</span><span class="p">:</span> <span class="s2">&quot;multiclass&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-141"><a href="#BaseClassifier.__init__-141"><span class="linenos">141</span></a>            <span class="s2">&quot;num_classes&quot;</span><span class="p">:</span> <span class="n">n_classes</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-142"><a href="#BaseClassifier.__init__-142"><span class="linenos">142</span></a>            <span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="s2">&quot;micro&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier.__init__-143"><a href="#BaseClassifier.__init__-143"><span class="linenos">143</span></a>        <span class="p">}</span>
</span><span id="BaseClassifier.__init__-144"><a href="#BaseClassifier.__init__-144"><span class="linenos">144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_top1</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">acc_kw</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="BaseClassifier.__init__-145"><a href="#BaseClassifier.__init__-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">n_classes</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="BaseClassifier.__init__-146"><a href="#BaseClassifier.__init__-146"><span class="linenos">146</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">accuracy_top5</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">acc_kw</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>n_classes (int):</strong> </li>
<li><strong>lcc_submodules (list[str] | None, optional):</strong>  Submodules to consider
for the latent correction loss. If <code>None</code> or <code>[]</code>, LCC is not
performed</li>
<li><strong>lcc_kwargs (dict | None, optional):</strong>  Optional parameters for LCC.
Expected entries (all optional) are:
<ul>
<li><strong>weight (float):</strong> Defaults to $10^{-4}$</li>
<li><strong>class_selection
(<code><a href="correction.html#LCCClassSelection">lcc.correction.LCCClassSelection</a></code> | None):</strong> Defaults to
<code>None</code>, which means all classes are considered for
correction</li>
<li><strong>interval (int):</strong> Apply LCC every <code>interval</code> epochs.
Defaults to $1$, meaning LCC will be applied every epoch
(after warmup).</li>
<li><strong>warmup (int):</strong> Number of epochs to wait before
starting LCC. Defaults to $0$, meaning LCC will start
immediately.</li>
<li><strong>k (int):</strong> Number of nearest neighbors to consider for LCC,
and Louvain clustering.</li>
<li><strong>pca_dim (int):</strong> Samples are reduced to this dimension
before constructing the KNN graph. This must be at most the
batch size.</li>
<li><strong>loss (<code>"exact"</code> or <code>"randomized"</code>)</strong>: Way the LCC loss is
computed from the clustering data. See <code>lcc.correction.loss</code>.</li>
<li><strong>ccspc (int)</strong>: If the loss type is <code>"randomized"</code>, then this
parameter specified the number of CC samples per cluster to
keep as potential correction targets. See also
<code><a href="correction.html#RandomizedLCCLoss">lcc.correction.loss.RandomizedLCCLoss</a></code>.</li>
<li><strong>clustering_method (<code>"louvain"</code> or <code>"peer_pressure"</code>)</strong>:
Clustering algorithm for the dataset of latent
representations.</li>
</ul></li>
<li><strong>ce_weight (float, optional):</strong>  Weight of the cross-entropy loss in the
clustering-CE loss. Ignored if LCC is not applied. Defaults to
$1$.</li>
<li><strong>image_key (Any, optional):</strong>  A batch passed to the model can be a
tuple (most common) or a dict. This parameter specifies the key
to use to retrieve the input tensor.</li>
<li><strong>label_key (Any, optional):</strong>  Analogous to <code>image_key</code>.</li>
<li><strong>kwargs:</strong>  Forwarded to
<a href="https://lightning.ai/docs/pytorch/stable/common/lightning_module.html#"><code>pl.LightningModule</code></a></li>
</ul>
</div>


                            </div>
                            <div id="BaseClassifier.lcc_data" class="classattr">
                                <div class="attr variable">
            <span class="name">lcc_data</span><span class="annotation">: dict[str, <a href="#LatentClusteringData">LatentClusteringData</a>] | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#BaseClassifier.lcc_data"></a>
    
            <div class="docstring"><p>If LCC is applied, then this is non <code>None</code> and updated at the begining of
each epoch. See also <code>full_dataset_latent_clustering</code>.</p>
</div>


                            </div>
                            <div id="BaseClassifier.standard_loss" class="classattr">
                                <div class="attr variable">
            <span class="name">standard_loss</span><span class="annotation">: torch.nn.modules.module.Module</span>

        
    </div>
    <a class="headerlink" href="#BaseClassifier.standard_loss"></a>
    
            <div class="docstring"><p>'Standard' loss to use together with LCC.</p>
</div>


                            </div>
                            <div id="BaseClassifier.accuracy_top1" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_top1</span><span class="annotation">: torch.nn.modules.module.Module</span>

        
    </div>
    <a class="headerlink" href="#BaseClassifier.accuracy_top1"></a>
    
            <div class="docstring"><p>Top-1 accuracy metric.</p>
</div>


                            </div>
                            <div id="BaseClassifier.accuracy_top5" class="classattr">
                                <div class="attr variable">
            <span class="name">accuracy_top5</span><span class="annotation">: torch.nn.modules.module.Module | None</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#BaseClassifier.accuracy_top5"></a>
    
            <div class="docstring"><p>Top-5 accuracy metric.</p>
</div>


                            </div>
                            <div id="BaseClassifier.configure_optimizers" class="classattr">
                                        <input id="BaseClassifier.configure_optimizers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">configure_optimizers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="BaseClassifier.configure_optimizers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.configure_optimizers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.configure_optimizers-194"><a href="#BaseClassifier.configure_optimizers-194"><span class="linenos">194</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">configure_optimizers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="BaseClassifier.configure_optimizers-195"><a href="#BaseClassifier.configure_optimizers-195"><span class="linenos">195</span></a>        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span id="BaseClassifier.configure_optimizers-196"><a href="#BaseClassifier.configure_optimizers-196"><span class="linenos">196</span></a>        <span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">CosineAnnealingLR</span><span class="p">(</span>
</span><span id="BaseClassifier.configure_optimizers-197"><a href="#BaseClassifier.configure_optimizers-197"><span class="linenos">197</span></a>            <span class="n">optimizer</span><span class="p">,</span> <span class="n">T_max</span><span class="o">=</span><span class="mi">50</span>
</span><span id="BaseClassifier.configure_optimizers-198"><a href="#BaseClassifier.configure_optimizers-198"><span class="linenos">198</span></a>        <span class="p">)</span>
</span><span id="BaseClassifier.configure_optimizers-199"><a href="#BaseClassifier.configure_optimizers-199"><span class="linenos">199</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="BaseClassifier.configure_optimizers-200"><a href="#BaseClassifier.configure_optimizers-200"><span class="linenos">200</span></a>            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
</span><span id="BaseClassifier.configure_optimizers-201"><a href="#BaseClassifier.configure_optimizers-201"><span class="linenos">201</span></a>            <span class="s2">&quot;lr_scheduler&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;scheduler&quot;</span><span class="p">:</span> <span class="n">scheduler</span><span class="p">},</span>
</span><span id="BaseClassifier.configure_optimizers-202"><a href="#BaseClassifier.configure_optimizers-202"><span class="linenos">202</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Choose what optimizers and learning-rate schedulers to use in your optimization. Normally you'd need one.
But in the case of GANs or similar you might have multiple. Optimization with multiple optimizers only works in
the manual optimization mode.</p>

<h6 id="return">Return:</h6>

<blockquote>
  <p>Any of these 6 options.</p>
  
  <ul>
  <li><strong>Single optimizer</strong>.</li>
  <li><strong>List or Tuple</strong> of optimizers.</li>
  <li><strong>Two lists</strong> - The first list has multiple optimizers, and the second has multiple LR schedulers
  (or multiple <code>lr_scheduler_config</code>).</li>
  <li><strong>Dictionary</strong>, with an <code>"optimizer"</code> key, and (optionally) a <code>"lr_scheduler"</code>
  key whose value is a single LR scheduler or <code>lr_scheduler_config</code>.</li>
  <li><strong>None</strong> - Fit will run without any optimizer.</li>
  </ul>
</blockquote>

<p>The <code>lr_scheduler_config</code> is a dictionary which contains the scheduler and its associated configuration.
The default configuration is shown below.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">lr_scheduler_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># REQUIRED: The scheduler instance</span>
    <span class="s2">&quot;scheduler&quot;</span><span class="p">:</span> <span class="n">lr_scheduler</span><span class="p">,</span>
    <span class="c1"># The unit of the scheduler&#39;s step size, could also be &#39;step&#39;.</span>
    <span class="c1"># &#39;epoch&#39; updates the scheduler on epoch end whereas &#39;step&#39;</span>
    <span class="c1"># updates it after a optimizer update.</span>
    <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="s2">&quot;epoch&quot;</span><span class="p">,</span>
    <span class="c1"># How many epochs/steps should pass between calls to</span>
    <span class="c1"># `scheduler.step()`. 1 corresponds to updating the learning</span>
    <span class="c1"># rate after every epoch/step.</span>
    <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="c1"># Metric to to monitor for schedulers like `ReduceLROnPlateau`</span>
    <span class="s2">&quot;monitor&quot;</span><span class="p">:</span> <span class="s2">&quot;val_loss&quot;</span><span class="p">,</span>
    <span class="c1"># If set to `True`, will enforce that the value specified &#39;monitor&#39;</span>
    <span class="c1"># is available when the scheduler is updated, thus stopping</span>
    <span class="c1"># training if not found. If set to `False`, it will only produce a warning</span>
    <span class="s2">&quot;strict&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="c1"># If using the `LearningRateMonitor` callback to monitor the</span>
    <span class="c1"># learning rate progress, this keyword can be used to specify</span>
    <span class="c1"># a custom logged name</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">}</span>
</code></pre>
</div>

<p>When there are schedulers in which the <code>.step()</code> method is conditioned on a value, such as the
<code>torch.optim.lr_scheduler.ReduceLROnPlateau</code> scheduler, Lightning requires that the
<code>lr_scheduler_config</code> contains the keyword <code>"monitor"</code> set to the metric name that the scheduler
should be conditioned on.</p>

<p>.. testcode::</p>

<pre><code># The ReduceLROnPlateau scheduler requires a monitor
def configure_optimizers(self):
    optimizer = Adam(...)
    return {
        "optimizer": optimizer,
        "lr_scheduler": {
            "scheduler": ReduceLROnPlateau(optimizer, ...),
            "monitor": "metric_to_track",
            "frequency": "indicates how often the metric is updated",
            # If "monitor" references validation metrics, then "frequency" should be set to a
            # multiple of "trainer.check_val_every_n_epoch".
        },
    }


# In the case of two optimizers, only one using the ReduceLROnPlateau scheduler
def configure_optimizers(self):
    optimizer1 = Adam(...)
    optimizer2 = SGD(...)
    scheduler1 = ReduceLROnPlateau(optimizer1, ...)
    scheduler2 = LambdaLR(optimizer2, ...)
    return (
        {
            "optimizer": optimizer1,
            "lr_scheduler": {
                "scheduler": scheduler1,
                "monitor": "metric_to_track",
            },
        },
        {"optimizer": optimizer2, "lr_scheduler": scheduler2},
    )
</code></pre>

<p>Metrics can be made available to monitor by simply logging it using
<code>self.log('metric_to_track', metric_val)</code> in your <code>~pytorch_lightning.core.LightningModule</code>.</p>

<h6 id="note">Note:</h6>

<blockquote>
  <p>Some things to know:</p>
  
  <ul>
  <li>Lightning calls <code>.backward()</code> and <code>.step()</code> automatically in case of automatic optimization.</li>
  <li>If a learning rate scheduler is specified in <code><a href="#BaseClassifier.configure_optimizers">configure_optimizers()</a></code> with key
  <code>"interval"</code> (default "epoch") in the scheduler configuration, Lightning will call
  the scheduler's <code>.step()</code> method automatically in case of automatic optimization.</li>
  <li>If you use 16-bit precision (<code>precision=16</code>), Lightning will automatically handle the optimizer.</li>
  <li>If you use <code>torch.optim.LBFGS</code>, Lightning handles the closure function automatically for you.</li>
  <li>If you use multiple optimizers, you will have to switch to 'manual optimization' mode and step them
  yourself.</li>
  <li>If you need to control how often the optimizer steps, override the <code><a href="#BaseClassifier.optimizer_step">optimizer_step()</a></code> hook.</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div id="BaseClassifier.forward_intermediate" class="classattr">
                                        <input id="BaseClassifier.forward_intermediate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">forward_intermediate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">inputs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]]</span>,</span><span class="param">	<span class="n">submodules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">output_dict</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">keep_gradients</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="BaseClassifier.forward_intermediate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.forward_intermediate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.forward_intermediate-204"><a href="#BaseClassifier.forward_intermediate-204"><span class="linenos">204</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward_intermediate</span><span class="p">(</span>
</span><span id="BaseClassifier.forward_intermediate-205"><a href="#BaseClassifier.forward_intermediate-205"><span class="linenos">205</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="BaseClassifier.forward_intermediate-206"><a href="#BaseClassifier.forward_intermediate-206"><span class="linenos">206</span></a>        <span class="n">inputs</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">|</span> <span class="n">Batch</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Batch</span><span class="p">],</span>
</span><span id="BaseClassifier.forward_intermediate-207"><a href="#BaseClassifier.forward_intermediate-207"><span class="linenos">207</span></a>        <span class="n">submodules</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="BaseClassifier.forward_intermediate-208"><a href="#BaseClassifier.forward_intermediate-208"><span class="linenos">208</span></a>        <span class="n">output_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="BaseClassifier.forward_intermediate-209"><a href="#BaseClassifier.forward_intermediate-209"><span class="linenos">209</span></a>        <span class="n">keep_gradients</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BaseClassifier.forward_intermediate-210"><a href="#BaseClassifier.forward_intermediate-210"><span class="linenos">210</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="BaseClassifier.forward_intermediate-211"><a href="#BaseClassifier.forward_intermediate-211"><span class="linenos">211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier.forward_intermediate-212"><a href="#BaseClassifier.forward_intermediate-212"><span class="linenos">212</span></a><span class="sd">        Runs the model and collects the output of specified submodules. The</span>
</span><span id="BaseClassifier.forward_intermediate-213"><a href="#BaseClassifier.forward_intermediate-213"><span class="linenos">213</span></a><span class="sd">        intermediate outputs are stored in `output_dict` under the</span>
</span><span id="BaseClassifier.forward_intermediate-214"><a href="#BaseClassifier.forward_intermediate-214"><span class="linenos">214</span></a><span class="sd">        corresponding submodule name. In particular, this method has side</span>
</span><span id="BaseClassifier.forward_intermediate-215"><a href="#BaseClassifier.forward_intermediate-215"><span class="linenos">215</span></a><span class="sd">        effects.</span>
</span><span id="BaseClassifier.forward_intermediate-216"><a href="#BaseClassifier.forward_intermediate-216"><span class="linenos">216</span></a>
</span><span id="BaseClassifier.forward_intermediate-217"><a href="#BaseClassifier.forward_intermediate-217"><span class="linenos">217</span></a><span class="sd">        Args:</span>
</span><span id="BaseClassifier.forward_intermediate-218"><a href="#BaseClassifier.forward_intermediate-218"><span class="linenos">218</span></a><span class="sd">            x (Tensor | Batch | list[Tensor] | list[Batch]): If batched (i.e.</span>
</span><span id="BaseClassifier.forward_intermediate-219"><a href="#BaseClassifier.forward_intermediate-219"><span class="linenos">219</span></a><span class="sd">                `x` is a list), then so is the output of this function and the</span>
</span><span id="BaseClassifier.forward_intermediate-220"><a href="#BaseClassifier.forward_intermediate-220"><span class="linenos">220</span></a><span class="sd">                entries in the `output_dict`</span>
</span><span id="BaseClassifier.forward_intermediate-221"><a href="#BaseClassifier.forward_intermediate-221"><span class="linenos">221</span></a><span class="sd">            submodules (list[str]):</span>
</span><span id="BaseClassifier.forward_intermediate-222"><a href="#BaseClassifier.forward_intermediate-222"><span class="linenos">222</span></a><span class="sd">            output_dict (dict):</span>
</span><span id="BaseClassifier.forward_intermediate-223"><a href="#BaseClassifier.forward_intermediate-223"><span class="linenos">223</span></a><span class="sd">            keep_gradients (bool, optional): If `True`, the tensors in</span>
</span><span id="BaseClassifier.forward_intermediate-224"><a href="#BaseClassifier.forward_intermediate-224"><span class="linenos">224</span></a><span class="sd">                `output_dict` keep their gradients (if they had some on the</span>
</span><span id="BaseClassifier.forward_intermediate-225"><a href="#BaseClassifier.forward_intermediate-225"><span class="linenos">225</span></a><span class="sd">                first place). If `False`, they are detached and moved to the</span>
</span><span id="BaseClassifier.forward_intermediate-226"><a href="#BaseClassifier.forward_intermediate-226"><span class="linenos">226</span></a><span class="sd">                CPU.</span>
</span><span id="BaseClassifier.forward_intermediate-227"><a href="#BaseClassifier.forward_intermediate-227"><span class="linenos">227</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier.forward_intermediate-228"><a href="#BaseClassifier.forward_intermediate-228"><span class="linenos">228</span></a>
</span><span id="BaseClassifier.forward_intermediate-229"><a href="#BaseClassifier.forward_intermediate-229"><span class="linenos">229</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">maybe_detach</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="BaseClassifier.forward_intermediate-230"><a href="#BaseClassifier.forward_intermediate-230"><span class="linenos">230</span></a>            <span class="k">return</span> <span class="n">x</span> <span class="k">if</span> <span class="n">keep_gradients</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
</span><span id="BaseClassifier.forward_intermediate-231"><a href="#BaseClassifier.forward_intermediate-231"><span class="linenos">231</span></a>
</span><span id="BaseClassifier.forward_intermediate-232"><a href="#BaseClassifier.forward_intermediate-232"><span class="linenos">232</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">create_hook</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="BaseClassifier.forward_intermediate-233"><a href="#BaseClassifier.forward_intermediate-233"><span class="linenos">233</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">hook</span><span class="p">(</span><span class="n">_model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">_args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier.forward_intermediate-234"><a href="#BaseClassifier.forward_intermediate-234"><span class="linenos">234</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="BaseClassifier.forward_intermediate-235"><a href="#BaseClassifier.forward_intermediate-235"><span class="linenos">235</span></a>                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
</span><span id="BaseClassifier.forward_intermediate-236"><a href="#BaseClassifier.forward_intermediate-236"><span class="linenos">236</span></a>                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="BaseClassifier.forward_intermediate-237"><a href="#BaseClassifier.forward_intermediate-237"><span class="linenos">237</span></a>                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tensor</span><span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-238"><a href="#BaseClassifier.forward_intermediate-238"><span class="linenos">238</span></a>                <span class="p">):</span>
</span><span id="BaseClassifier.forward_intermediate-239"><a href="#BaseClassifier.forward_intermediate-239"><span class="linenos">239</span></a>                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="BaseClassifier.forward_intermediate-240"><a href="#BaseClassifier.forward_intermediate-240"><span class="linenos">240</span></a>                <span class="k">elif</span> <span class="p">(</span>  <span class="c1"># Special case for ViTs</span>
</span><span id="BaseClassifier.forward_intermediate-241"><a href="#BaseClassifier.forward_intermediate-241"><span class="linenos">241</span></a>                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
</span><span id="BaseClassifier.forward_intermediate-242"><a href="#BaseClassifier.forward_intermediate-242"><span class="linenos">242</span></a>                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
</span><span id="BaseClassifier.forward_intermediate-243"><a href="#BaseClassifier.forward_intermediate-243"><span class="linenos">243</span></a>                    <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tensor</span><span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-244"><a href="#BaseClassifier.forward_intermediate-244"><span class="linenos">244</span></a>                    <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Tensor</span><span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-245"><a href="#BaseClassifier.forward_intermediate-245"><span class="linenos">245</span></a>                <span class="p">):</span>
</span><span id="BaseClassifier.forward_intermediate-246"><a href="#BaseClassifier.forward_intermediate-246"><span class="linenos">246</span></a>                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="BaseClassifier.forward_intermediate-247"><a href="#BaseClassifier.forward_intermediate-247"><span class="linenos">247</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">):</span>
</span><span id="BaseClassifier.forward_intermediate-248"><a href="#BaseClassifier.forward_intermediate-248"><span class="linenos">248</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="BaseClassifier.forward_intermediate-249"><a href="#BaseClassifier.forward_intermediate-249"><span class="linenos">249</span></a>                        <span class="sa">f</span><span class="s2">&quot;Unsupported latent object type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">out</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="BaseClassifier.forward_intermediate-250"><a href="#BaseClassifier.forward_intermediate-250"><span class="linenos">250</span></a>                    <span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-251"><a href="#BaseClassifier.forward_intermediate-251"><span class="linenos">251</span></a>                <span class="k">if</span> <span class="n">batched</span><span class="p">:</span>
</span><span id="BaseClassifier.forward_intermediate-252"><a href="#BaseClassifier.forward_intermediate-252"><span class="linenos">252</span></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output_dict</span><span class="p">:</span>
</span><span id="BaseClassifier.forward_intermediate-253"><a href="#BaseClassifier.forward_intermediate-253"><span class="linenos">253</span></a>                        <span class="n">output_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="BaseClassifier.forward_intermediate-254"><a href="#BaseClassifier.forward_intermediate-254"><span class="linenos">254</span></a>                    <span class="n">output_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maybe_detach</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
</span><span id="BaseClassifier.forward_intermediate-255"><a href="#BaseClassifier.forward_intermediate-255"><span class="linenos">255</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="BaseClassifier.forward_intermediate-256"><a href="#BaseClassifier.forward_intermediate-256"><span class="linenos">256</span></a>                    <span class="n">output_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">maybe_detach</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-257"><a href="#BaseClassifier.forward_intermediate-257"><span class="linenos">257</span></a>
</span><span id="BaseClassifier.forward_intermediate-258"><a href="#BaseClassifier.forward_intermediate-258"><span class="linenos">258</span></a>            <span class="k">return</span> <span class="n">hook</span>
</span><span id="BaseClassifier.forward_intermediate-259"><a href="#BaseClassifier.forward_intermediate-259"><span class="linenos">259</span></a>
</span><span id="BaseClassifier.forward_intermediate-260"><a href="#BaseClassifier.forward_intermediate-260"><span class="linenos">260</span></a>        <span class="n">batched</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span>
</span><span id="BaseClassifier.forward_intermediate-261"><a href="#BaseClassifier.forward_intermediate-261"><span class="linenos">261</span></a>        <span class="n">handles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RemovableHandle</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="BaseClassifier.forward_intermediate-262"><a href="#BaseClassifier.forward_intermediate-262"><span class="linenos">262</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">submodules</span><span class="p">:</span>
</span><span id="BaseClassifier.forward_intermediate-263"><a href="#BaseClassifier.forward_intermediate-263"><span class="linenos">263</span></a>            <span class="n">submodule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_submodule</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-264"><a href="#BaseClassifier.forward_intermediate-264"><span class="linenos">264</span></a>            <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">submodule</span><span class="o">.</span><span class="n">register_forward_hook</span><span class="p">(</span><span class="n">create_hook</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>
</span><span id="BaseClassifier.forward_intermediate-265"><a href="#BaseClassifier.forward_intermediate-265"><span class="linenos">265</span></a>        <span class="k">if</span> <span class="n">batched</span><span class="p">:</span>
</span><span id="BaseClassifier.forward_intermediate-266"><a href="#BaseClassifier.forward_intermediate-266"><span class="linenos">266</span></a>            <span class="n">logits</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="BaseClassifier.forward_intermediate-267"><a href="#BaseClassifier.forward_intermediate-267"><span class="linenos">267</span></a>                <span class="n">maybe_detach</span><span class="p">(</span>
</span><span id="BaseClassifier.forward_intermediate-268"><a href="#BaseClassifier.forward_intermediate-268"><span class="linenos">268</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span>
</span><span id="BaseClassifier.forward_intermediate-269"><a href="#BaseClassifier.forward_intermediate-269"><span class="linenos">269</span></a>                        <span class="n">batch</span>
</span><span id="BaseClassifier.forward_intermediate-270"><a href="#BaseClassifier.forward_intermediate-270"><span class="linenos">270</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-271"><a href="#BaseClassifier.forward_intermediate-271"><span class="linenos">271</span></a>                        <span class="k">else</span> <span class="n">batch</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;image_key&quot;</span><span class="p">]]</span>
</span><span id="BaseClassifier.forward_intermediate-272"><a href="#BaseClassifier.forward_intermediate-272"><span class="linenos">272</span></a>                    <span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-273"><a href="#BaseClassifier.forward_intermediate-273"><span class="linenos">273</span></a>                <span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-274"><a href="#BaseClassifier.forward_intermediate-274"><span class="linenos">274</span></a>                <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">inputs</span>
</span><span id="BaseClassifier.forward_intermediate-275"><a href="#BaseClassifier.forward_intermediate-275"><span class="linenos">275</span></a>            <span class="p">]</span>
</span><span id="BaseClassifier.forward_intermediate-276"><a href="#BaseClassifier.forward_intermediate-276"><span class="linenos">276</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="BaseClassifier.forward_intermediate-277"><a href="#BaseClassifier.forward_intermediate-277"><span class="linenos">277</span></a>            <span class="n">logits</span> <span class="o">=</span> <span class="n">maybe_detach</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="BaseClassifier.forward_intermediate-278"><a href="#BaseClassifier.forward_intermediate-278"><span class="linenos">278</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span>
</span><span id="BaseClassifier.forward_intermediate-279"><a href="#BaseClassifier.forward_intermediate-279"><span class="linenos">279</span></a>                    <span class="n">inputs</span>
</span><span id="BaseClassifier.forward_intermediate-280"><a href="#BaseClassifier.forward_intermediate-280"><span class="linenos">280</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-281"><a href="#BaseClassifier.forward_intermediate-281"><span class="linenos">281</span></a>                    <span class="k">else</span> <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;image_key&quot;</span><span class="p">]]</span>
</span><span id="BaseClassifier.forward_intermediate-282"><a href="#BaseClassifier.forward_intermediate-282"><span class="linenos">282</span></a>                <span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-283"><a href="#BaseClassifier.forward_intermediate-283"><span class="linenos">283</span></a>            <span class="p">)</span>
</span><span id="BaseClassifier.forward_intermediate-284"><a href="#BaseClassifier.forward_intermediate-284"><span class="linenos">284</span></a>        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">:</span>
</span><span id="BaseClassifier.forward_intermediate-285"><a href="#BaseClassifier.forward_intermediate-285"><span class="linenos">285</span></a>            <span class="n">h</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</span><span id="BaseClassifier.forward_intermediate-286"><a href="#BaseClassifier.forward_intermediate-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="n">logits</span>
</span></pre></div>


            <div class="docstring"><p>Runs the model and collects the output of specified submodules. The
intermediate outputs are stored in <code>output_dict</code> under the
corresponding submodule name. In particular, this method has side
effects.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>x (Tensor | Batch | list[Tensor] | list[Batch]):</strong>  If batched (i.e.
<code>x</code> is a list), then so is the output of this function and the
entries in the <code>output_dict</code></li>
<li><strong>submodules (list[str]):</strong> </li>
<li><strong>output_dict (dict):</strong> </li>
<li><strong>keep_gradients (bool, optional):</strong>  If <code>True</code>, the tensors in
<code>output_dict</code> keep their gradients (if they had some on the
first place). If <code>False</code>, they are detached and moved to the
CPU.</li>
</ul>
</div>


                            </div>
                            <div id="BaseClassifier.get_image_processor" class="classattr">
                                        <input id="BaseClassifier.get_image_processor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_image_processor</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="BaseClassifier.get_image_processor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.get_image_processor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.get_image_processor-288"><a href="#BaseClassifier.get_image_processor-288"><span class="linenos">288</span></a>    <span class="nd">@staticmethod</span>
</span><span id="BaseClassifier.get_image_processor-289"><a href="#BaseClassifier.get_image_processor-289"><span class="linenos">289</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_processor</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="BaseClassifier.get_image_processor-290"><a href="#BaseClassifier.get_image_processor-290"><span class="linenos">290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier.get_image_processor-291"><a href="#BaseClassifier.get_image_processor-291"><span class="linenos">291</span></a><span class="sd">        Returns an image processor for the model. By defaults, returns the</span>
</span><span id="BaseClassifier.get_image_processor-292"><a href="#BaseClassifier.get_image_processor-292"><span class="linenos">292</span></a><span class="sd">        identity function.</span>
</span><span id="BaseClassifier.get_image_processor-293"><a href="#BaseClassifier.get_image_processor-293"><span class="linenos">293</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier.get_image_processor-294"><a href="#BaseClassifier.get_image_processor-294"><span class="linenos">294</span></a>        <span class="k">return</span> <span class="k">lambda</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">input</span>
</span></pre></div>


            <div class="docstring"><p>Returns an image processor for the model. By defaults, returns the
identity function.</p>
</div>


                            </div>
                            <div id="BaseClassifier.lcc_submodules" class="classattr">
                                        <input id="BaseClassifier.lcc_submodules-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">lcc_submodules</span><span class="annotation">: list[str]</span>

                <label class="view-source-button" for="BaseClassifier.lcc_submodules-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.lcc_submodules"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.lcc_submodules-296"><a href="#BaseClassifier.lcc_submodules-296"><span class="linenos">296</span></a>    <span class="nd">@property</span>
</span><span id="BaseClassifier.lcc_submodules-297"><a href="#BaseClassifier.lcc_submodules-297"><span class="linenos">297</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lcc_submodules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="BaseClassifier.lcc_submodules-298"><a href="#BaseClassifier.lcc_submodules-298"><span class="linenos">298</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier.lcc_submodules-299"><a href="#BaseClassifier.lcc_submodules-299"><span class="linenos">299</span></a><span class="sd">        Returns the list of submodules considered for LCC, whith correct prefix</span>
</span><span id="BaseClassifier.lcc_submodules-300"><a href="#BaseClassifier.lcc_submodules-300"><span class="linenos">300</span></a><span class="sd">        if needed.</span>
</span><span id="BaseClassifier.lcc_submodules-301"><a href="#BaseClassifier.lcc_submodules-301"><span class="linenos">301</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier.lcc_submodules-302"><a href="#BaseClassifier.lcc_submodules-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lcc_submodules&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Returns the list of submodules considered for LCC, whith correct prefix
if needed.</p>
</div>


                            </div>
                            <div id="BaseClassifier.on_train_batch_end" class="classattr">
                                        <input id="BaseClassifier.on_train_batch_end-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">on_train_batch_end</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="BaseClassifier.on_train_batch_end-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.on_train_batch_end"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.on_train_batch_end-304"><a href="#BaseClassifier.on_train_batch_end-304"><span class="linenos">304</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_train_batch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier.on_train_batch_end-305"><a href="#BaseClassifier.on_train_batch_end-305"><span class="linenos">305</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Just logs all optimizer&#39;s learning rate&quot;&quot;&quot;</span>
</span><span id="BaseClassifier.on_train_batch_end-306"><a href="#BaseClassifier.on_train_batch_end-306"><span class="linenos">306</span></a>        <span class="n">log_optimizers_lr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="BaseClassifier.on_train_batch_end-307"><a href="#BaseClassifier.on_train_batch_end-307"><span class="linenos">307</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_batch_end</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Just logs all optimizer's learning rate</p>
</div>


                            </div>
                            <div id="BaseClassifier.on_train_epoch_end" class="classattr">
                                        <input id="BaseClassifier.on_train_epoch_end-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">on_train_epoch_end</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="BaseClassifier.on_train_epoch_end-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.on_train_epoch_end"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.on_train_epoch_end-309"><a href="#BaseClassifier.on_train_epoch_end-309"><span class="linenos">309</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_train_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier.on_train_epoch_end-310"><a href="#BaseClassifier.on_train_epoch_end-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cleans up training specific temporary attributes&quot;&quot;&quot;</span>
</span><span id="BaseClassifier.on_train_epoch_end-311"><a href="#BaseClassifier.on_train_epoch_end-311"><span class="linenos">311</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lcc_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="BaseClassifier.on_train_epoch_end-312"><a href="#BaseClassifier.on_train_epoch_end-312"><span class="linenos">312</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_epoch_end</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Cleans up training specific temporary attributes</p>
</div>


                            </div>
                            <div id="BaseClassifier.on_train_epoch_start" class="classattr">
                                        <input id="BaseClassifier.on_train_epoch_start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">on_train_epoch_start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="BaseClassifier.on_train_epoch_start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.on_train_epoch_start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.on_train_epoch_start-314"><a href="#BaseClassifier.on_train_epoch_start-314"><span class="linenos">314</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_train_epoch_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier.on_train_epoch_start-315"><a href="#BaseClassifier.on_train_epoch_start-315"><span class="linenos">315</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier.on_train_epoch_start-316"><a href="#BaseClassifier.on_train_epoch_start-316"><span class="linenos">316</span></a><span class="sd">        Performs dataset-wide latent clustering and stores the results in</span>
</span><span id="BaseClassifier.on_train_epoch_start-317"><a href="#BaseClassifier.on_train_epoch_start-317"><span class="linenos">317</span></a><span class="sd">        private attribute `BaseClassifier._lc_data`.</span>
</span><span id="BaseClassifier.on_train_epoch_start-318"><a href="#BaseClassifier.on_train_epoch_start-318"><span class="linenos">318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier.on_train_epoch_start-319"><a href="#BaseClassifier.on_train_epoch_start-319"><span class="linenos">319</span></a>        <span class="c1"># wether to apply LCC this epoch</span>
</span><span id="BaseClassifier.on_train_epoch_start-320"><a href="#BaseClassifier.on_train_epoch_start-320"><span class="linenos">320</span></a>        <span class="n">lcc_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lcc_kwargs&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="BaseClassifier.on_train_epoch_start-321"><a href="#BaseClassifier.on_train_epoch_start-321"><span class="linenos">321</span></a>        <span class="n">do_lcc</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="BaseClassifier.on_train_epoch_start-322"><a href="#BaseClassifier.on_train_epoch_start-322"><span class="linenos">322</span></a>            <span class="c1"># we are passed warmup (lcc_warmup being None is equivalent to no</span>
</span><span id="BaseClassifier.on_train_epoch_start-323"><a href="#BaseClassifier.on_train_epoch_start-323"><span class="linenos">323</span></a>            <span class="c1"># warmup)...</span>
</span><span id="BaseClassifier.on_train_epoch_start-324"><a href="#BaseClassifier.on_train_epoch_start-324"><span class="linenos">324</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;warmup&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="BaseClassifier.on_train_epoch_start-325"><a href="#BaseClassifier.on_train_epoch_start-325"><span class="linenos">325</span></a>            <span class="ow">and</span> <span class="p">(</span>
</span><span id="BaseClassifier.on_train_epoch_start-326"><a href="#BaseClassifier.on_train_epoch_start-326"><span class="linenos">326</span></a>                <span class="c1"># ... and an LCC interval is specified...</span>
</span><span id="BaseClassifier.on_train_epoch_start-327"><a href="#BaseClassifier.on_train_epoch_start-327"><span class="linenos">327</span></a>                <span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interval&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="BaseClassifier.on_train_epoch_start-328"><a href="#BaseClassifier.on_train_epoch_start-328"><span class="linenos">328</span></a>                <span class="c1"># ... and the current epoch can have LCC done...</span>
</span><span id="BaseClassifier.on_train_epoch_start-329"><a href="#BaseClassifier.on_train_epoch_start-329"><span class="linenos">329</span></a>                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_epoch</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="BaseClassifier.on_train_epoch_start-330"><a href="#BaseClassifier.on_train_epoch_start-330"><span class="linenos">330</span></a>                <span class="o">==</span> <span class="mi">0</span>
</span><span id="BaseClassifier.on_train_epoch_start-331"><a href="#BaseClassifier.on_train_epoch_start-331"><span class="linenos">331</span></a>            <span class="p">)</span>
</span><span id="BaseClassifier.on_train_epoch_start-332"><a href="#BaseClassifier.on_train_epoch_start-332"><span class="linenos">332</span></a>            <span class="c1"># ... and there are submodule selected for LCC...</span>
</span><span id="BaseClassifier.on_train_epoch_start-333"><a href="#BaseClassifier.on_train_epoch_start-333"><span class="linenos">333</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lcc_submodules</span>
</span><span id="BaseClassifier.on_train_epoch_start-334"><a href="#BaseClassifier.on_train_epoch_start-334"><span class="linenos">334</span></a>            <span class="c1"># ... and the LCC weight is non-zero</span>
</span><span id="BaseClassifier.on_train_epoch_start-335"><a href="#BaseClassifier.on_train_epoch_start-335"><span class="linenos">335</span></a>            <span class="ow">and</span> <span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="BaseClassifier.on_train_epoch_start-336"><a href="#BaseClassifier.on_train_epoch_start-336"><span class="linenos">336</span></a>        <span class="p">)</span>
</span><span id="BaseClassifier.on_train_epoch_start-337"><a href="#BaseClassifier.on_train_epoch_start-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="n">do_lcc</span><span class="p">:</span>
</span><span id="BaseClassifier.on_train_epoch_start-338"><a href="#BaseClassifier.on_train_epoch_start-338"><span class="linenos">338</span></a>            <span class="c1"># The import has to be here to prevent circular imports while having</span>
</span><span id="BaseClassifier.on_train_epoch_start-339"><a href="#BaseClassifier.on_train_epoch_start-339"><span class="linenos">339</span></a>            <span class="c1"># all the FDLC logic in a separate file</span>
</span><span id="BaseClassifier.on_train_epoch_start-340"><a href="#BaseClassifier.on_train_epoch_start-340"><span class="linenos">340</span></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">.fdlc</span><span class="w"> </span><span class="kn">import</span> <span class="n">full_dataset_latent_clustering</span>
</span><span id="BaseClassifier.on_train_epoch_start-341"><a href="#BaseClassifier.on_train_epoch_start-341"><span class="linenos">341</span></a>
</span><span id="BaseClassifier.on_train_epoch_start-342"><a href="#BaseClassifier.on_train_epoch_start-342"><span class="linenos">342</span></a>            <span class="k">with</span> <span class="n">temporary_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_path</span><span class="p">:</span>
</span><span id="BaseClassifier.on_train_epoch_start-343"><a href="#BaseClassifier.on_train_epoch_start-343"><span class="linenos">343</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lcc_data</span> <span class="o">=</span> <span class="n">full_dataset_latent_clustering</span><span class="p">(</span>
</span><span id="BaseClassifier.on_train_epoch_start-344"><a href="#BaseClassifier.on_train_epoch_start-344"><span class="linenos">344</span></a>                    <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="BaseClassifier.on_train_epoch_start-345"><a href="#BaseClassifier.on_train_epoch_start-345"><span class="linenos">345</span></a>                    <span class="n">output_dir</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">,</span>
</span><span id="BaseClassifier.on_train_epoch_start-346"><a href="#BaseClassifier.on_train_epoch_start-346"><span class="linenos">346</span></a>                    <span class="n">tqdm_style</span><span class="o">=</span><span class="s2">&quot;console&quot;</span><span class="p">,</span>
</span><span id="BaseClassifier.on_train_epoch_start-347"><a href="#BaseClassifier.on_train_epoch_start-347"><span class="linenos">347</span></a>                <span class="p">)</span>
</span><span id="BaseClassifier.on_train_epoch_start-348"><a href="#BaseClassifier.on_train_epoch_start-348"><span class="linenos">348</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_epoch_start</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Performs dataset-wide latent clustering and stores the results in
private attribute <code>BaseClassifier._lc_data</code>.</p>
</div>


                            </div>
                            <div id="BaseClassifier.on_train_start" class="classattr">
                                        <input id="BaseClassifier.on_train_start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">on_train_start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="BaseClassifier.on_train_start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.on_train_start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.on_train_start-350"><a href="#BaseClassifier.on_train_start-350"><span class="linenos">350</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_train_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BaseClassifier.on_train_start-351"><a href="#BaseClassifier.on_train_start-351"><span class="linenos">351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="BaseClassifier.on_train_start-352"><a href="#BaseClassifier.on_train_start-352"><span class="linenos">352</span></a><span class="sd">        Explicitly registers hyperparameters and metrics. You&#39;d think Lightning</span>
</span><span id="BaseClassifier.on_train_start-353"><a href="#BaseClassifier.on_train_start-353"><span class="linenos">353</span></a><span class="sd">        would do this automatically, but nope.</span>
</span><span id="BaseClassifier.on_train_start-354"><a href="#BaseClassifier.on_train_start-354"><span class="linenos">354</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BaseClassifier.on_train_start-355"><a href="#BaseClassifier.on_train_start-355"><span class="linenos">355</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_hyperparams</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="BaseClassifier.on_train_start-356"><a href="#BaseClassifier.on_train_start-356"><span class="linenos">356</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">,</span>
</span><span id="BaseClassifier.on_train_start-357"><a href="#BaseClassifier.on_train_start-357"><span class="linenos">357</span></a>            <span class="p">{</span>
</span><span id="BaseClassifier.on_train_start-358"><a href="#BaseClassifier.on_train_start-358"><span class="linenos">358</span></a>                <span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">m</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="BaseClassifier.on_train_start-359"><a href="#BaseClassifier.on_train_start-359"><span class="linenos">359</span></a>                <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span>
</span><span id="BaseClassifier.on_train_start-360"><a href="#BaseClassifier.on_train_start-360"><span class="linenos">360</span></a>                    <span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;acc&quot;</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="s2">&quot;ce&quot;</span><span class="p">,</span> <span class="s2">&quot;lcc&quot;</span><span class="p">]</span>
</span><span id="BaseClassifier.on_train_start-361"><a href="#BaseClassifier.on_train_start-361"><span class="linenos">361</span></a>                <span class="p">)</span>
</span><span id="BaseClassifier.on_train_start-362"><a href="#BaseClassifier.on_train_start-362"><span class="linenos">362</span></a>            <span class="p">},</span>
</span><span id="BaseClassifier.on_train_start-363"><a href="#BaseClassifier.on_train_start-363"><span class="linenos">363</span></a>        <span class="p">)</span>
</span><span id="BaseClassifier.on_train_start-364"><a href="#BaseClassifier.on_train_start-364"><span class="linenos">364</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_start</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Explicitly registers hyperparameters and metrics. You'd think Lightning
would do this automatically, but nope.</p>
</div>


                            </div>
                            <div id="BaseClassifier.test_step" class="classattr">
                                        <input id="BaseClassifier.test_step-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test_step</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>, </span><span class="param"><span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="BaseClassifier.test_step-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.test_step"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.test_step-366"><a href="#BaseClassifier.test_step-366"><span class="linenos">366</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="BaseClassifier.test_step-367"><a href="#BaseClassifier.test_step-367"><span class="linenos">367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Override from `pl.LightningModule.test_step`.&quot;&quot;&quot;</span>
</span><span id="BaseClassifier.test_step-368"><a href="#BaseClassifier.test_step-368"><span class="linenos">368</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Override from <code>pl.LightningModule.test_step</code>.</p>
</div>


                            </div>
                            <div id="BaseClassifier.training_step" class="classattr">
                                        <input id="BaseClassifier.training_step-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">training_step</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>, </span><span class="param"><span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="BaseClassifier.training_step-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.training_step"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.training_step-370"><a href="#BaseClassifier.training_step-370"><span class="linenos">370</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">training_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="BaseClassifier.training_step-371"><a href="#BaseClassifier.training_step-371"><span class="linenos">371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Override from `pl.LightningModule.training_step`.&quot;&quot;&quot;</span>
</span><span id="BaseClassifier.training_step-372"><a href="#BaseClassifier.training_step-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Override from <code>pl.LightningModule.training_step</code>.</p>
</div>


                            </div>
                            <div id="BaseClassifier.validation_step" class="classattr">
                                        <input id="BaseClassifier.validation_step-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validation_step</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>, </span><span class="param"><span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="BaseClassifier.validation_step-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BaseClassifier.validation_step"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BaseClassifier.validation_step-374"><a href="#BaseClassifier.validation_step-374"><span class="linenos">374</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validation_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Batch</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="BaseClassifier.validation_step-375"><a href="#BaseClassifier.validation_step-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Override from `pl.LightningModule.validation_step`.&quot;&quot;&quot;</span>
</span><span id="BaseClassifier.validation_step-376"><a href="#BaseClassifier.validation_step-376"><span class="linenos">376</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Override from <code>pl.LightningModule.validation_step</code>.</p>
</div>


                            </div>
                </section>
                <section id="get_classifier_cls">
                            <input id="get_classifier_cls-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_classifier_cls</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">type</span><span class="p">[</span><span class="n"><a href="#BaseClassifier">BaseClassifier</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_classifier_cls-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_classifier_cls"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_classifier_cls-26"><a href="#get_classifier_cls-26"><span class="linenos">26</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_classifier_cls</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseClassifier</span><span class="p">]:</span>
</span><span id="get_classifier_cls-27"><a href="#get_classifier_cls-27"><span class="linenos">27</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_classifier_cls-28"><a href="#get_classifier_cls-28"><span class="linenos">28</span></a><span class="sd">    Returns the classifier class to use for a given model name.</span>
</span><span id="get_classifier_cls-29"><a href="#get_classifier_cls-29"><span class="linenos">29</span></a>
</span><span id="get_classifier_cls-30"><a href="#get_classifier_cls-30"><span class="linenos">30</span></a><span class="sd">    Args:</span>
</span><span id="get_classifier_cls-31"><a href="#get_classifier_cls-31"><span class="linenos">31</span></a><span class="sd">        model_name (str):</span>
</span><span id="get_classifier_cls-32"><a href="#get_classifier_cls-32"><span class="linenos">32</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_classifier_cls-33"><a href="#get_classifier_cls-33"><span class="linenos">33</span></a>    <span class="k">if</span> <span class="n">model_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;timm/&quot;</span><span class="p">):</span>
</span><span id="get_classifier_cls-34"><a href="#get_classifier_cls-34"><span class="linenos">34</span></a>        <span class="k">return</span> <span class="n">TimmClassifier</span>
</span><span id="get_classifier_cls-35"><a href="#get_classifier_cls-35"><span class="linenos">35</span></a>    <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">model_name</span><span class="p">:</span>
</span><span id="get_classifier_cls-36"><a href="#get_classifier_cls-36"><span class="linenos">36</span></a>        <span class="k">return</span> <span class="n">HuggingFaceClassifier</span>
</span><span id="get_classifier_cls-37"><a href="#get_classifier_cls-37"><span class="linenos">37</span></a>    <span class="k">return</span> <span class="n">TorchvisionClassifier</span>
</span></pre></div>


            <div class="docstring"><p>Returns the classifier class to use for a given model name.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_name (str):</strong> </li>
</ul>
</div>


                </section>
                <section id="HuggingFaceClassifier">
                            <input id="HuggingFaceClassifier-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HuggingFaceClassifier</span><wbr>(<span class="base"><a href="#WrappedClassifier">lcc.classifiers.WrappedClassifier</a></span>):

                <label class="view-source-button" for="HuggingFaceClassifier-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HuggingFaceClassifier"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HuggingFaceClassifier-11"><a href="#HuggingFaceClassifier-11"><span class="linenos">11</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HuggingFaceClassifier</span><span class="p">(</span><span class="n">WrappedClassifier</span><span class="p">):</span>
</span><span id="HuggingFaceClassifier-12"><a href="#HuggingFaceClassifier-12"><span class="linenos">12</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HuggingFaceClassifier-13"><a href="#HuggingFaceClassifier-13"><span class="linenos">13</span></a><span class="sd">    Pretrained classifier model loaded from the [HuggingFace model</span>
</span><span id="HuggingFaceClassifier-14"><a href="#HuggingFaceClassifier-14"><span class="linenos">14</span></a><span class="sd">    hub](https://huggingface.co/models?pipeline_tag=image-classification).</span>
</span><span id="HuggingFaceClassifier-15"><a href="#HuggingFaceClassifier-15"><span class="linenos">15</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="HuggingFaceClassifier-16"><a href="#HuggingFaceClassifier-16"><span class="linenos">16</span></a>
</span><span id="HuggingFaceClassifier-17"><a href="#HuggingFaceClassifier-17"><span class="linenos">17</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HuggingFaceClassifier-18"><a href="#HuggingFaceClassifier-18"><span class="linenos">18</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HuggingFaceClassifier-19"><a href="#HuggingFaceClassifier-19"><span class="linenos">19</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="HuggingFaceClassifier-20"><a href="#HuggingFaceClassifier-20"><span class="linenos">20</span></a>        <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="HuggingFaceClassifier-21"><a href="#HuggingFaceClassifier-21"><span class="linenos">21</span></a>        <span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HuggingFaceClassifier-22"><a href="#HuggingFaceClassifier-22"><span class="linenos">22</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="HuggingFaceClassifier-23"><a href="#HuggingFaceClassifier-23"><span class="linenos">23</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HuggingFaceClassifier-24"><a href="#HuggingFaceClassifier-24"><span class="linenos">24</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HuggingFaceClassifier-25"><a href="#HuggingFaceClassifier-25"><span class="linenos">25</span></a><span class="sd">        See also:</span>
</span><span id="HuggingFaceClassifier-26"><a href="#HuggingFaceClassifier-26"><span class="linenos">26</span></a><span class="sd">            `lcc.classifiers.WrappedClassifier.__init__` and</span>
</span><span id="HuggingFaceClassifier-27"><a href="#HuggingFaceClassifier-27"><span class="linenos">27</span></a><span class="sd">            `lcc.classifiers.BaseClassifier.__init__`.</span>
</span><span id="HuggingFaceClassifier-28"><a href="#HuggingFaceClassifier-28"><span class="linenos">28</span></a>
</span><span id="HuggingFaceClassifier-29"><a href="#HuggingFaceClassifier-29"><span class="linenos">29</span></a><span class="sd">        Args:</span>
</span><span id="HuggingFaceClassifier-30"><a href="#HuggingFaceClassifier-30"><span class="linenos">30</span></a><span class="sd">            model_name (str): Model name as in the [HuggingFace model</span>
</span><span id="HuggingFaceClassifier-31"><a href="#HuggingFaceClassifier-31"><span class="linenos">31</span></a><span class="sd">                hub](https://huggingface.co/models?pipeline_tag=image-classification).</span>
</span><span id="HuggingFaceClassifier-32"><a href="#HuggingFaceClassifier-32"><span class="linenos">32</span></a><span class="sd">                If the model name starts with `timm/`, use</span>
</span><span id="HuggingFaceClassifier-33"><a href="#HuggingFaceClassifier-33"><span class="linenos">33</span></a><span class="sd">                `lcc.classifiers.TimmClassifier` instead.</span>
</span><span id="HuggingFaceClassifier-34"><a href="#HuggingFaceClassifier-34"><span class="linenos">34</span></a><span class="sd">            n_classes (int): See `lcc.classifiers.WrappedClassifier.__init__`.</span>
</span><span id="HuggingFaceClassifier-35"><a href="#HuggingFaceClassifier-35"><span class="linenos">35</span></a><span class="sd">            head_name (str | None, optional): See</span>
</span><span id="HuggingFaceClassifier-36"><a href="#HuggingFaceClassifier-36"><span class="linenos">36</span></a><span class="sd">                `lcc.classifiers.WrappedClassifier.__init__`.</span>
</span><span id="HuggingFaceClassifier-37"><a href="#HuggingFaceClassifier-37"><span class="linenos">37</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HuggingFaceClassifier-38"><a href="#HuggingFaceClassifier-38"><span class="linenos">38</span></a>        <span class="k">if</span> <span class="n">model_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;timm/&quot;</span><span class="p">):</span>
</span><span id="HuggingFaceClassifier-39"><a href="#HuggingFaceClassifier-39"><span class="linenos">39</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="HuggingFaceClassifier-40"><a href="#HuggingFaceClassifier-40"><span class="linenos">40</span></a>                <span class="s2">&quot;If the model name starts with `timm/`, use &quot;</span>
</span><span id="HuggingFaceClassifier-41"><a href="#HuggingFaceClassifier-41"><span class="linenos">41</span></a>                <span class="s2">&quot;`lcc.classifiers.TimmClassifier` instead.&quot;</span>
</span><span id="HuggingFaceClassifier-42"><a href="#HuggingFaceClassifier-42"><span class="linenos">42</span></a>            <span class="p">)</span>
</span><span id="HuggingFaceClassifier-43"><a href="#HuggingFaceClassifier-43"><span class="linenos">43</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForImageClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
</span><span id="HuggingFaceClassifier-44"><a href="#HuggingFaceClassifier-44"><span class="linenos">44</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">head_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="HuggingFaceClassifier-45"><a href="#HuggingFaceClassifier-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>
</span><span id="HuggingFaceClassifier-46"><a href="#HuggingFaceClassifier-46"><span class="linenos">46</span></a>
</span><span id="HuggingFaceClassifier-47"><a href="#HuggingFaceClassifier-47"><span class="linenos">47</span></a>    <span class="nd">@staticmethod</span>
</span><span id="HuggingFaceClassifier-48"><a href="#HuggingFaceClassifier-48"><span class="linenos">48</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_processor</span><span class="p">(</span>
</span><span id="HuggingFaceClassifier-49"><a href="#HuggingFaceClassifier-49"><span class="linenos">49</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="HuggingFaceClassifier-50"><a href="#HuggingFaceClassifier-50"><span class="linenos">50</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="HuggingFaceClassifier-51"><a href="#HuggingFaceClassifier-51"><span class="linenos">51</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HuggingFaceClassifier-52"><a href="#HuggingFaceClassifier-52"><span class="linenos">52</span></a><span class="sd">        Wraps the HuggingFace `AutoImageProcessor` associated to a given model.</span>
</span><span id="HuggingFaceClassifier-53"><a href="#HuggingFaceClassifier-53"><span class="linenos">53</span></a>
</span><span id="HuggingFaceClassifier-54"><a href="#HuggingFaceClassifier-54"><span class="linenos">54</span></a><span class="sd">        Args:</span>
</span><span id="HuggingFaceClassifier-55"><a href="#HuggingFaceClassifier-55"><span class="linenos">55</span></a><span class="sd">            model_name (str): Model name as in the [HuggingFace model</span>
</span><span id="HuggingFaceClassifier-56"><a href="#HuggingFaceClassifier-56"><span class="linenos">56</span></a><span class="sd">                hub](https://huggingface.co/models?pipeline_tag=image-classification).</span>
</span><span id="HuggingFaceClassifier-57"><a href="#HuggingFaceClassifier-57"><span class="linenos">57</span></a><span class="sd">                Must not start with `timm/`.</span>
</span><span id="HuggingFaceClassifier-58"><a href="#HuggingFaceClassifier-58"><span class="linenos">58</span></a>
</span><span id="HuggingFaceClassifier-59"><a href="#HuggingFaceClassifier-59"><span class="linenos">59</span></a><span class="sd">        Returns:</span>
</span><span id="HuggingFaceClassifier-60"><a href="#HuggingFaceClassifier-60"><span class="linenos">60</span></a><span class="sd">            A callable that uses a</span>
</span><span id="HuggingFaceClassifier-61"><a href="#HuggingFaceClassifier-61"><span class="linenos">61</span></a><span class="sd">            [`transformers.AutoImageProcessor`](https://huggingface.co/docs/transformers/v4.44.2/en/model_doc/auto#transformers.AutoImageProcessor)</span>
</span><span id="HuggingFaceClassifier-62"><a href="#HuggingFaceClassifier-62"><span class="linenos">62</span></a><span class="sd">            under the hood.</span>
</span><span id="HuggingFaceClassifier-63"><a href="#HuggingFaceClassifier-63"><span class="linenos">63</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HuggingFaceClassifier-64"><a href="#HuggingFaceClassifier-64"><span class="linenos">64</span></a>        <span class="n">hf_transorm</span> <span class="o">=</span> <span class="n">AutoImageProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
</span><span id="HuggingFaceClassifier-65"><a href="#HuggingFaceClassifier-65"><span class="linenos">65</span></a>
</span><span id="HuggingFaceClassifier-66"><a href="#HuggingFaceClassifier-66"><span class="linenos">66</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_transform</span><span class="p">(</span><span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="HuggingFaceClassifier-67"><a href="#HuggingFaceClassifier-67"><span class="linenos">67</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="HuggingFaceClassifier-68"><a href="#HuggingFaceClassifier-68"><span class="linenos">68</span></a>                <span class="n">k</span><span class="p">:</span> <span class="p">(</span>
</span><span id="HuggingFaceClassifier-69"><a href="#HuggingFaceClassifier-69"><span class="linenos">69</span></a>                    <span class="n">hf_transorm</span><span class="p">(</span>
</span><span id="HuggingFaceClassifier-70"><a href="#HuggingFaceClassifier-70"><span class="linenos">70</span></a>                        <span class="p">[</span><span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">v</span><span class="p">],</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span>
</span><span id="HuggingFaceClassifier-71"><a href="#HuggingFaceClassifier-71"><span class="linenos">71</span></a>                    <span class="p">)[</span><span class="s2">&quot;pixel_values&quot;</span><span class="p">]</span>
</span><span id="HuggingFaceClassifier-72"><a href="#HuggingFaceClassifier-72"><span class="linenos">72</span></a>                    <span class="c1"># TODO: pass image_key from DS </span>
</span><span id="HuggingFaceClassifier-73"><a href="#HuggingFaceClassifier-73"><span class="linenos">73</span></a>                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">]</span>
</span><span id="HuggingFaceClassifier-74"><a href="#HuggingFaceClassifier-74"><span class="linenos">74</span></a>                    <span class="k">else</span> <span class="n">v</span>
</span><span id="HuggingFaceClassifier-75"><a href="#HuggingFaceClassifier-75"><span class="linenos">75</span></a>                <span class="p">)</span>
</span><span id="HuggingFaceClassifier-76"><a href="#HuggingFaceClassifier-76"><span class="linenos">76</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="HuggingFaceClassifier-77"><a href="#HuggingFaceClassifier-77"><span class="linenos">77</span></a>            <span class="p">}</span>
</span><span id="HuggingFaceClassifier-78"><a href="#HuggingFaceClassifier-78"><span class="linenos">78</span></a>
</span><span id="HuggingFaceClassifier-79"><a href="#HuggingFaceClassifier-79"><span class="linenos">79</span></a>        <span class="k">return</span> <span class="n">_transform</span>
</span></pre></div>


            <div class="docstring"><p>Pretrained classifier model loaded from the <a href="https://huggingface.co/models?pipeline_tag=image-classification">HuggingFace model
hub</a>.</p>
</div>


                            <div id="HuggingFaceClassifier.__init__" class="classattr">
                                        <input id="HuggingFaceClassifier.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">HuggingFaceClassifier</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="HuggingFaceClassifier.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HuggingFaceClassifier.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HuggingFaceClassifier.__init__-17"><a href="#HuggingFaceClassifier.__init__-17"><span class="linenos">17</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="HuggingFaceClassifier.__init__-18"><a href="#HuggingFaceClassifier.__init__-18"><span class="linenos">18</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="HuggingFaceClassifier.__init__-19"><a href="#HuggingFaceClassifier.__init__-19"><span class="linenos">19</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="HuggingFaceClassifier.__init__-20"><a href="#HuggingFaceClassifier.__init__-20"><span class="linenos">20</span></a>        <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="HuggingFaceClassifier.__init__-21"><a href="#HuggingFaceClassifier.__init__-21"><span class="linenos">21</span></a>        <span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HuggingFaceClassifier.__init__-22"><a href="#HuggingFaceClassifier.__init__-22"><span class="linenos">22</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="HuggingFaceClassifier.__init__-23"><a href="#HuggingFaceClassifier.__init__-23"><span class="linenos">23</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HuggingFaceClassifier.__init__-24"><a href="#HuggingFaceClassifier.__init__-24"><span class="linenos">24</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HuggingFaceClassifier.__init__-25"><a href="#HuggingFaceClassifier.__init__-25"><span class="linenos">25</span></a><span class="sd">        See also:</span>
</span><span id="HuggingFaceClassifier.__init__-26"><a href="#HuggingFaceClassifier.__init__-26"><span class="linenos">26</span></a><span class="sd">            `lcc.classifiers.WrappedClassifier.__init__` and</span>
</span><span id="HuggingFaceClassifier.__init__-27"><a href="#HuggingFaceClassifier.__init__-27"><span class="linenos">27</span></a><span class="sd">            `lcc.classifiers.BaseClassifier.__init__`.</span>
</span><span id="HuggingFaceClassifier.__init__-28"><a href="#HuggingFaceClassifier.__init__-28"><span class="linenos">28</span></a>
</span><span id="HuggingFaceClassifier.__init__-29"><a href="#HuggingFaceClassifier.__init__-29"><span class="linenos">29</span></a><span class="sd">        Args:</span>
</span><span id="HuggingFaceClassifier.__init__-30"><a href="#HuggingFaceClassifier.__init__-30"><span class="linenos">30</span></a><span class="sd">            model_name (str): Model name as in the [HuggingFace model</span>
</span><span id="HuggingFaceClassifier.__init__-31"><a href="#HuggingFaceClassifier.__init__-31"><span class="linenos">31</span></a><span class="sd">                hub](https://huggingface.co/models?pipeline_tag=image-classification).</span>
</span><span id="HuggingFaceClassifier.__init__-32"><a href="#HuggingFaceClassifier.__init__-32"><span class="linenos">32</span></a><span class="sd">                If the model name starts with `timm/`, use</span>
</span><span id="HuggingFaceClassifier.__init__-33"><a href="#HuggingFaceClassifier.__init__-33"><span class="linenos">33</span></a><span class="sd">                `lcc.classifiers.TimmClassifier` instead.</span>
</span><span id="HuggingFaceClassifier.__init__-34"><a href="#HuggingFaceClassifier.__init__-34"><span class="linenos">34</span></a><span class="sd">            n_classes (int): See `lcc.classifiers.WrappedClassifier.__init__`.</span>
</span><span id="HuggingFaceClassifier.__init__-35"><a href="#HuggingFaceClassifier.__init__-35"><span class="linenos">35</span></a><span class="sd">            head_name (str | None, optional): See</span>
</span><span id="HuggingFaceClassifier.__init__-36"><a href="#HuggingFaceClassifier.__init__-36"><span class="linenos">36</span></a><span class="sd">                `lcc.classifiers.WrappedClassifier.__init__`.</span>
</span><span id="HuggingFaceClassifier.__init__-37"><a href="#HuggingFaceClassifier.__init__-37"><span class="linenos">37</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HuggingFaceClassifier.__init__-38"><a href="#HuggingFaceClassifier.__init__-38"><span class="linenos">38</span></a>        <span class="k">if</span> <span class="n">model_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;timm/&quot;</span><span class="p">):</span>
</span><span id="HuggingFaceClassifier.__init__-39"><a href="#HuggingFaceClassifier.__init__-39"><span class="linenos">39</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="HuggingFaceClassifier.__init__-40"><a href="#HuggingFaceClassifier.__init__-40"><span class="linenos">40</span></a>                <span class="s2">&quot;If the model name starts with `timm/`, use &quot;</span>
</span><span id="HuggingFaceClassifier.__init__-41"><a href="#HuggingFaceClassifier.__init__-41"><span class="linenos">41</span></a>                <span class="s2">&quot;`lcc.classifiers.TimmClassifier` instead.&quot;</span>
</span><span id="HuggingFaceClassifier.__init__-42"><a href="#HuggingFaceClassifier.__init__-42"><span class="linenos">42</span></a>            <span class="p">)</span>
</span><span id="HuggingFaceClassifier.__init__-43"><a href="#HuggingFaceClassifier.__init__-43"><span class="linenos">43</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForImageClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
</span><span id="HuggingFaceClassifier.__init__-44"><a href="#HuggingFaceClassifier.__init__-44"><span class="linenos">44</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">head_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="HuggingFaceClassifier.__init__-45"><a href="#HuggingFaceClassifier.__init__-45"><span class="linenos">45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h6 id="see-also">See also:</h6>

<blockquote>
  <p><code><a href="#WrappedClassifier.__init__">lcc.classifiers.WrappedClassifier.__init__</a></code> and
  <code><a href="#BaseClassifier.__init__">lcc.classifiers.BaseClassifier.__init__</a></code>.</p>
</blockquote>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_name (str):</strong>  Model name as in the <a href="https://huggingface.co/models?pipeline_tag=image-classification">HuggingFace model
hub</a>.
If the model name starts with <code>timm/</code>, use
<code><a href="#TimmClassifier">lcc.classifiers.TimmClassifier</a></code> instead.</li>
<li><strong>n_classes (int):</strong>  See <code><a href="#WrappedClassifier.__init__">lcc.classifiers.WrappedClassifier.__init__</a></code>.</li>
<li><strong>head_name (str | None, optional):</strong>  See
<code><a href="#WrappedClassifier.__init__">lcc.classifiers.WrappedClassifier.__init__</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="HuggingFaceClassifier.get_image_processor" class="classattr">
                                        <input id="HuggingFaceClassifier.get_image_processor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_image_processor</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="HuggingFaceClassifier.get_image_processor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HuggingFaceClassifier.get_image_processor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HuggingFaceClassifier.get_image_processor-47"><a href="#HuggingFaceClassifier.get_image_processor-47"><span class="linenos">47</span></a>    <span class="nd">@staticmethod</span>
</span><span id="HuggingFaceClassifier.get_image_processor-48"><a href="#HuggingFaceClassifier.get_image_processor-48"><span class="linenos">48</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_processor</span><span class="p">(</span>
</span><span id="HuggingFaceClassifier.get_image_processor-49"><a href="#HuggingFaceClassifier.get_image_processor-49"><span class="linenos">49</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="HuggingFaceClassifier.get_image_processor-50"><a href="#HuggingFaceClassifier.get_image_processor-50"><span class="linenos">50</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="HuggingFaceClassifier.get_image_processor-51"><a href="#HuggingFaceClassifier.get_image_processor-51"><span class="linenos">51</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HuggingFaceClassifier.get_image_processor-52"><a href="#HuggingFaceClassifier.get_image_processor-52"><span class="linenos">52</span></a><span class="sd">        Wraps the HuggingFace `AutoImageProcessor` associated to a given model.</span>
</span><span id="HuggingFaceClassifier.get_image_processor-53"><a href="#HuggingFaceClassifier.get_image_processor-53"><span class="linenos">53</span></a>
</span><span id="HuggingFaceClassifier.get_image_processor-54"><a href="#HuggingFaceClassifier.get_image_processor-54"><span class="linenos">54</span></a><span class="sd">        Args:</span>
</span><span id="HuggingFaceClassifier.get_image_processor-55"><a href="#HuggingFaceClassifier.get_image_processor-55"><span class="linenos">55</span></a><span class="sd">            model_name (str): Model name as in the [HuggingFace model</span>
</span><span id="HuggingFaceClassifier.get_image_processor-56"><a href="#HuggingFaceClassifier.get_image_processor-56"><span class="linenos">56</span></a><span class="sd">                hub](https://huggingface.co/models?pipeline_tag=image-classification).</span>
</span><span id="HuggingFaceClassifier.get_image_processor-57"><a href="#HuggingFaceClassifier.get_image_processor-57"><span class="linenos">57</span></a><span class="sd">                Must not start with `timm/`.</span>
</span><span id="HuggingFaceClassifier.get_image_processor-58"><a href="#HuggingFaceClassifier.get_image_processor-58"><span class="linenos">58</span></a>
</span><span id="HuggingFaceClassifier.get_image_processor-59"><a href="#HuggingFaceClassifier.get_image_processor-59"><span class="linenos">59</span></a><span class="sd">        Returns:</span>
</span><span id="HuggingFaceClassifier.get_image_processor-60"><a href="#HuggingFaceClassifier.get_image_processor-60"><span class="linenos">60</span></a><span class="sd">            A callable that uses a</span>
</span><span id="HuggingFaceClassifier.get_image_processor-61"><a href="#HuggingFaceClassifier.get_image_processor-61"><span class="linenos">61</span></a><span class="sd">            [`transformers.AutoImageProcessor`](https://huggingface.co/docs/transformers/v4.44.2/en/model_doc/auto#transformers.AutoImageProcessor)</span>
</span><span id="HuggingFaceClassifier.get_image_processor-62"><a href="#HuggingFaceClassifier.get_image_processor-62"><span class="linenos">62</span></a><span class="sd">            under the hood.</span>
</span><span id="HuggingFaceClassifier.get_image_processor-63"><a href="#HuggingFaceClassifier.get_image_processor-63"><span class="linenos">63</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HuggingFaceClassifier.get_image_processor-64"><a href="#HuggingFaceClassifier.get_image_processor-64"><span class="linenos">64</span></a>        <span class="n">hf_transorm</span> <span class="o">=</span> <span class="n">AutoImageProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
</span><span id="HuggingFaceClassifier.get_image_processor-65"><a href="#HuggingFaceClassifier.get_image_processor-65"><span class="linenos">65</span></a>
</span><span id="HuggingFaceClassifier.get_image_processor-66"><a href="#HuggingFaceClassifier.get_image_processor-66"><span class="linenos">66</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_transform</span><span class="p">(</span><span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="HuggingFaceClassifier.get_image_processor-67"><a href="#HuggingFaceClassifier.get_image_processor-67"><span class="linenos">67</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="HuggingFaceClassifier.get_image_processor-68"><a href="#HuggingFaceClassifier.get_image_processor-68"><span class="linenos">68</span></a>                <span class="n">k</span><span class="p">:</span> <span class="p">(</span>
</span><span id="HuggingFaceClassifier.get_image_processor-69"><a href="#HuggingFaceClassifier.get_image_processor-69"><span class="linenos">69</span></a>                    <span class="n">hf_transorm</span><span class="p">(</span>
</span><span id="HuggingFaceClassifier.get_image_processor-70"><a href="#HuggingFaceClassifier.get_image_processor-70"><span class="linenos">70</span></a>                        <span class="p">[</span><span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">v</span><span class="p">],</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span>
</span><span id="HuggingFaceClassifier.get_image_processor-71"><a href="#HuggingFaceClassifier.get_image_processor-71"><span class="linenos">71</span></a>                    <span class="p">)[</span><span class="s2">&quot;pixel_values&quot;</span><span class="p">]</span>
</span><span id="HuggingFaceClassifier.get_image_processor-72"><a href="#HuggingFaceClassifier.get_image_processor-72"><span class="linenos">72</span></a>                    <span class="c1"># TODO: pass image_key from DS </span>
</span><span id="HuggingFaceClassifier.get_image_processor-73"><a href="#HuggingFaceClassifier.get_image_processor-73"><span class="linenos">73</span></a>                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">]</span>
</span><span id="HuggingFaceClassifier.get_image_processor-74"><a href="#HuggingFaceClassifier.get_image_processor-74"><span class="linenos">74</span></a>                    <span class="k">else</span> <span class="n">v</span>
</span><span id="HuggingFaceClassifier.get_image_processor-75"><a href="#HuggingFaceClassifier.get_image_processor-75"><span class="linenos">75</span></a>                <span class="p">)</span>
</span><span id="HuggingFaceClassifier.get_image_processor-76"><a href="#HuggingFaceClassifier.get_image_processor-76"><span class="linenos">76</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="HuggingFaceClassifier.get_image_processor-77"><a href="#HuggingFaceClassifier.get_image_processor-77"><span class="linenos">77</span></a>            <span class="p">}</span>
</span><span id="HuggingFaceClassifier.get_image_processor-78"><a href="#HuggingFaceClassifier.get_image_processor-78"><span class="linenos">78</span></a>
</span><span id="HuggingFaceClassifier.get_image_processor-79"><a href="#HuggingFaceClassifier.get_image_processor-79"><span class="linenos">79</span></a>        <span class="k">return</span> <span class="n">_transform</span>
</span></pre></div>


            <div class="docstring"><p>Wraps the HuggingFace <code>AutoImageProcessor</code> associated to a given model.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_name (str):</strong>  Model name as in the <a href="https://huggingface.co/models?pipeline_tag=image-classification">HuggingFace model
hub</a>.
Must not start with <code>timm/</code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A callable that uses a
  <a href="https://huggingface.co/docs/transformers/v4.44.2/en/model_doc/auto#transformers.AutoImageProcessor"><code>transformers.AutoImageProcessor</code></a>
  under the hood.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="LatentClusteringData">
                            <input id="LatentClusteringData-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator decorator-dataclass">@dataclass</div>

    <span class="def">class</span>
    <span class="name">LatentClusteringData</span>:

                <label class="view-source-button" for="LatentClusteringData-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LatentClusteringData"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LatentClusteringData-30"><a href="#LatentClusteringData-30"><span class="linenos">30</span></a><span class="nd">@dataclass</span>
</span><span id="LatentClusteringData-31"><a href="#LatentClusteringData-31"><span class="linenos">31</span></a><span class="k">class</span><span class="w"> </span><span class="nc">LatentClusteringData</span><span class="p">:</span>
</span><span id="LatentClusteringData-32"><a href="#LatentClusteringData-32"><span class="linenos">32</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LatentClusteringData-33"><a href="#LatentClusteringData-33"><span class="linenos">33</span></a><span class="sd">    Convenience struct that holds some latent clustering correction data for a</span>
</span><span id="LatentClusteringData-34"><a href="#LatentClusteringData-34"><span class="linenos">34</span></a><span class="sd">    given latent space.</span>
</span><span id="LatentClusteringData-35"><a href="#LatentClusteringData-35"><span class="linenos">35</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="LatentClusteringData-36"><a href="#LatentClusteringData-36"><span class="linenos">36</span></a>
</span><span id="LatentClusteringData-37"><a href="#LatentClusteringData-37"><span class="linenos">37</span></a>    <span class="n">loss</span><span class="p">:</span> <span class="n">LCCLoss</span>
</span><span id="LatentClusteringData-38"><a href="#LatentClusteringData-38"><span class="linenos">38</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LatentClusteringData-39"><a href="#LatentClusteringData-39"><span class="linenos">39</span></a><span class="sd">    The actual LCC loss object (which is callable) that compute the LCC loss for</span>
</span><span id="LatentClusteringData-40"><a href="#LatentClusteringData-40"><span class="linenos">40</span></a><span class="sd">    LCC correction.</span>
</span><span id="LatentClusteringData-41"><a href="#LatentClusteringData-41"><span class="linenos">41</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="LatentClusteringData-42"><a href="#LatentClusteringData-42"><span class="linenos">42</span></a>
</span><span id="LatentClusteringData-43"><a href="#LatentClusteringData-43"><span class="linenos">43</span></a>    <span class="c1"># TODO: Write the y_clst to disk and loading alongside the train dataset, so</span>
</span><span id="LatentClusteringData-44"><a href="#LatentClusteringData-44"><span class="linenos">44</span></a>    <span class="c1"># that this whole datastructure becomes unnecessary</span>
</span><span id="LatentClusteringData-45"><a href="#LatentClusteringData-45"><span class="linenos">45</span></a>    <span class="n">y_clst</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</span><span id="LatentClusteringData-46"><a href="#LatentClusteringData-46"><span class="linenos">46</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;`(N,)` vector of cluster labels.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Convenience struct that holds some latent clustering correction data for a
given latent space.</p>
</div>


                            <div id="LatentClusteringData.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">LatentClusteringData</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">loss</span><span class="p">:</span> <span class="n"><a href="correction.html#LCCLoss">lcc.correction.LCCLoss</a></span>, </span><span class="param"><span class="n">y_clst</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#LatentClusteringData.__init__"></a>
    
    

                            </div>
                            <div id="LatentClusteringData.loss" class="classattr">
                                <div class="attr variable">
            <span class="name">loss</span><span class="annotation">: <a href="correction.html#LCCLoss">lcc.correction.LCCLoss</a></span>

        
    </div>
    <a class="headerlink" href="#LatentClusteringData.loss"></a>
    
            <div class="docstring"><p>The actual LCC loss object (which is callable) that compute the LCC loss for
LCC correction.</p>
</div>


                            </div>
                            <div id="LatentClusteringData.y_clst" class="classattr">
                                <div class="attr variable">
            <span class="name">y_clst</span><span class="annotation">: numpy.ndarray</span>

        
    </div>
    <a class="headerlink" href="#LatentClusteringData.y_clst"></a>
    
            <div class="docstring"><p><code>(N,)</code> vector of cluster labels.</p>
</div>


                            </div>
                </section>
                <section id="TimmClassifier">
                            <input id="TimmClassifier-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TimmClassifier</span><wbr>(<span class="base"><a href="#WrappedClassifier">lcc.classifiers.WrappedClassifier</a></span>):

                <label class="view-source-button" for="TimmClassifier-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimmClassifier"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimmClassifier-12"><a href="#TimmClassifier-12"><span class="linenos">12</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TimmClassifier</span><span class="p">(</span><span class="n">WrappedClassifier</span><span class="p">):</span>
</span><span id="TimmClassifier-13"><a href="#TimmClassifier-13"><span class="linenos">13</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimmClassifier-14"><a href="#TimmClassifier-14"><span class="linenos">14</span></a><span class="sd">    Pretrained classifier model loaded from the [HuggingFace model</span>
</span><span id="TimmClassifier-15"><a href="#TimmClassifier-15"><span class="linenos">15</span></a><span class="sd">    hub](https://huggingface.co/models?pipeline_tag=image-classification)</span>
</span><span id="TimmClassifier-16"><a href="#TimmClassifier-16"><span class="linenos">16</span></a><span class="sd">    uploaded by the `timm` team.</span>
</span><span id="TimmClassifier-17"><a href="#TimmClassifier-17"><span class="linenos">17</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TimmClassifier-18"><a href="#TimmClassifier-18"><span class="linenos">18</span></a>
</span><span id="TimmClassifier-19"><a href="#TimmClassifier-19"><span class="linenos">19</span></a>    <span class="n">image_transform</span><span class="p">:</span> <span class="n">Callable</span>
</span><span id="TimmClassifier-20"><a href="#TimmClassifier-20"><span class="linenos">20</span></a>
</span><span id="TimmClassifier-21"><a href="#TimmClassifier-21"><span class="linenos">21</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TimmClassifier-22"><a href="#TimmClassifier-22"><span class="linenos">22</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TimmClassifier-23"><a href="#TimmClassifier-23"><span class="linenos">23</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="TimmClassifier-24"><a href="#TimmClassifier-24"><span class="linenos">24</span></a>        <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="TimmClassifier-25"><a href="#TimmClassifier-25"><span class="linenos">25</span></a>        <span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimmClassifier-26"><a href="#TimmClassifier-26"><span class="linenos">26</span></a>        <span class="n">pretrained</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TimmClassifier-27"><a href="#TimmClassifier-27"><span class="linenos">27</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="TimmClassifier-28"><a href="#TimmClassifier-28"><span class="linenos">28</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimmClassifier-29"><a href="#TimmClassifier-29"><span class="linenos">29</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimmClassifier-30"><a href="#TimmClassifier-30"><span class="linenos">30</span></a><span class="sd">        See also:</span>
</span><span id="TimmClassifier-31"><a href="#TimmClassifier-31"><span class="linenos">31</span></a><span class="sd">            `lcc.classifiers.WrappedClassifier.__init__` and</span>
</span><span id="TimmClassifier-32"><a href="#TimmClassifier-32"><span class="linenos">32</span></a><span class="sd">            `lcc.classifiers.BaseClassifier.__init__`.</span>
</span><span id="TimmClassifier-33"><a href="#TimmClassifier-33"><span class="linenos">33</span></a>
</span><span id="TimmClassifier-34"><a href="#TimmClassifier-34"><span class="linenos">34</span></a><span class="sd">        Args:</span>
</span><span id="TimmClassifier-35"><a href="#TimmClassifier-35"><span class="linenos">35</span></a><span class="sd">            model_name (str): Model name as in the [HuggingFace model</span>
</span><span id="TimmClassifier-36"><a href="#TimmClassifier-36"><span class="linenos">36</span></a><span class="sd">                hub](https://huggingface.co/models?pipeline_tag=image-classification).</span>
</span><span id="TimmClassifier-37"><a href="#TimmClassifier-37"><span class="linenos">37</span></a><span class="sd">                Must start with `timm/`.</span>
</span><span id="TimmClassifier-38"><a href="#TimmClassifier-38"><span class="linenos">38</span></a><span class="sd">            n_classes (int): See `lcc.classifiers.WrappedClassifier.__init__`.</span>
</span><span id="TimmClassifier-39"><a href="#TimmClassifier-39"><span class="linenos">39</span></a><span class="sd">            head_name (str | None, optional): See</span>
</span><span id="TimmClassifier-40"><a href="#TimmClassifier-40"><span class="linenos">40</span></a><span class="sd">                `lcc.classifiers.WrappedClassifier.__init__`.</span>
</span><span id="TimmClassifier-41"><a href="#TimmClassifier-41"><span class="linenos">41</span></a><span class="sd">            pretrained (bool, optional): Defaults to `True`.</span>
</span><span id="TimmClassifier-42"><a href="#TimmClassifier-42"><span class="linenos">42</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimmClassifier-43"><a href="#TimmClassifier-43"><span class="linenos">43</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">model_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;timm/&quot;</span><span class="p">):</span>
</span><span id="TimmClassifier-44"><a href="#TimmClassifier-44"><span class="linenos">44</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimmClassifier-45"><a href="#TimmClassifier-45"><span class="linenos">45</span></a>                <span class="s2">&quot;The model isn&#39;t a timm model (its name does not start with &quot;</span>
</span><span id="TimmClassifier-46"><a href="#TimmClassifier-46"><span class="linenos">46</span></a>                <span class="s2">&quot;`timm/`). Use `lcc.classifiers.HuggingFaceClassifier` &quot;</span>
</span><span id="TimmClassifier-47"><a href="#TimmClassifier-47"><span class="linenos">47</span></a>                <span class="s2">&quot;instead.&quot;</span>
</span><span id="TimmClassifier-48"><a href="#TimmClassifier-48"><span class="linenos">48</span></a>            <span class="p">)</span>
</span><span id="TimmClassifier-49"><a href="#TimmClassifier-49"><span class="linenos">49</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">timm</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="n">pretrained</span><span class="p">)</span>
</span><span id="TimmClassifier-50"><a href="#TimmClassifier-50"><span class="linenos">50</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">head_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TimmClassifier-51"><a href="#TimmClassifier-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>
</span><span id="TimmClassifier-52"><a href="#TimmClassifier-52"><span class="linenos">52</span></a>
</span><span id="TimmClassifier-53"><a href="#TimmClassifier-53"><span class="linenos">53</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimmClassifier-54"><a href="#TimmClassifier-54"><span class="linenos">54</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_processor</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="TimmClassifier-55"><a href="#TimmClassifier-55"><span class="linenos">55</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimmClassifier-56"><a href="#TimmClassifier-56"><span class="linenos">56</span></a><span class="sd">        Wraps the HuggingFace `AutoImageProcessor` associated to a given model.</span>
</span><span id="TimmClassifier-57"><a href="#TimmClassifier-57"><span class="linenos">57</span></a>
</span><span id="TimmClassifier-58"><a href="#TimmClassifier-58"><span class="linenos">58</span></a><span class="sd">        See also:</span>
</span><span id="TimmClassifier-59"><a href="#TimmClassifier-59"><span class="linenos">59</span></a><span class="sd">            [`timm.create_transform`](https://huggingface.co/docs/timm/reference/data#timm.data.create_transform).</span>
</span><span id="TimmClassifier-60"><a href="#TimmClassifier-60"><span class="linenos">60</span></a>
</span><span id="TimmClassifier-61"><a href="#TimmClassifier-61"><span class="linenos">61</span></a><span class="sd">        Args:</span>
</span><span id="TimmClassifier-62"><a href="#TimmClassifier-62"><span class="linenos">62</span></a><span class="sd">            model_name (str): Model name as in the [HuggingFace model</span>
</span><span id="TimmClassifier-63"><a href="#TimmClassifier-63"><span class="linenos">63</span></a><span class="sd">                hub](https://huggingface.co/models?pipeline_tag=image-classification).</span>
</span><span id="TimmClassifier-64"><a href="#TimmClassifier-64"><span class="linenos">64</span></a><span class="sd">                Must start with `timm/`.</span>
</span><span id="TimmClassifier-65"><a href="#TimmClassifier-65"><span class="linenos">65</span></a>
</span><span id="TimmClassifier-66"><a href="#TimmClassifier-66"><span class="linenos">66</span></a><span class="sd">        Returns:</span>
</span><span id="TimmClassifier-67"><a href="#TimmClassifier-67"><span class="linenos">67</span></a><span class="sd">            A callable that uses a [Torchvision</span>
</span><span id="TimmClassifier-68"><a href="#TimmClassifier-68"><span class="linenos">68</span></a><span class="sd">            transform](https://pytorch.org/vision/0.19/transforms.html) under</span>
</span><span id="TimmClassifier-69"><a href="#TimmClassifier-69"><span class="linenos">69</span></a><span class="sd">            the hood.</span>
</span><span id="TimmClassifier-70"><a href="#TimmClassifier-70"><span class="linenos">70</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimmClassifier-71"><a href="#TimmClassifier-71"><span class="linenos">71</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">timm</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="TimmClassifier-72"><a href="#TimmClassifier-72"><span class="linenos">72</span></a>        <span class="n">conf</span> <span class="o">=</span> <span class="n">timm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">resolve_model_data_config</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="TimmClassifier-73"><a href="#TimmClassifier-73"><span class="linenos">73</span></a>        <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;is_training&quot;</span><span class="p">],</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;no_aug&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
</span><span id="TimmClassifier-74"><a href="#TimmClassifier-74"><span class="linenos">74</span></a>        <span class="n">timm_transform</span> <span class="o">=</span> <span class="n">timm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">create_transform</span><span class="p">(</span><span class="o">**</span><span class="n">conf</span><span class="p">)</span>
</span><span id="TimmClassifier-75"><a href="#TimmClassifier-75"><span class="linenos">75</span></a>
</span><span id="TimmClassifier-76"><a href="#TimmClassifier-76"><span class="linenos">76</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_transform</span><span class="p">(</span><span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="TimmClassifier-77"><a href="#TimmClassifier-77"><span class="linenos">77</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="TimmClassifier-78"><a href="#TimmClassifier-78"><span class="linenos">78</span></a>                <span class="n">k</span><span class="p">:</span> <span class="p">(</span>
</span><span id="TimmClassifier-79"><a href="#TimmClassifier-79"><span class="linenos">79</span></a>                    <span class="p">(</span>
</span><span id="TimmClassifier-80"><a href="#TimmClassifier-80"><span class="linenos">80</span></a>                        <span class="p">[</span><span class="n">timm_transform</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
</span><span id="TimmClassifier-81"><a href="#TimmClassifier-81"><span class="linenos">81</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="TimmClassifier-82"><a href="#TimmClassifier-82"><span class="linenos">82</span></a>                        <span class="k">else</span> <span class="n">timm_transform</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="TimmClassifier-83"><a href="#TimmClassifier-83"><span class="linenos">83</span></a>                    <span class="p">)</span>
</span><span id="TimmClassifier-84"><a href="#TimmClassifier-84"><span class="linenos">84</span></a>                    <span class="c1"># TODO: pass image_key from DS </span>
</span><span id="TimmClassifier-85"><a href="#TimmClassifier-85"><span class="linenos">85</span></a>                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">]</span>
</span><span id="TimmClassifier-86"><a href="#TimmClassifier-86"><span class="linenos">86</span></a>                    <span class="k">else</span> <span class="n">v</span>
</span><span id="TimmClassifier-87"><a href="#TimmClassifier-87"><span class="linenos">87</span></a>                <span class="p">)</span>
</span><span id="TimmClassifier-88"><a href="#TimmClassifier-88"><span class="linenos">88</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="TimmClassifier-89"><a href="#TimmClassifier-89"><span class="linenos">89</span></a>            <span class="p">}</span>
</span><span id="TimmClassifier-90"><a href="#TimmClassifier-90"><span class="linenos">90</span></a>
</span><span id="TimmClassifier-91"><a href="#TimmClassifier-91"><span class="linenos">91</span></a>        <span class="k">return</span> <span class="n">_transform</span>
</span><span id="TimmClassifier-92"><a href="#TimmClassifier-92"><span class="linenos">92</span></a>
</span><span id="TimmClassifier-93"><a href="#TimmClassifier-93"><span class="linenos">93</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">|</span> <span class="n">Batch</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="TimmClassifier-94"><a href="#TimmClassifier-94"><span class="linenos">94</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TimmClassifier-95"><a href="#TimmClassifier-95"><span class="linenos">95</span></a>            <span class="n">inputs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">)</span> <span class="k">else</span> <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">image_key</span><span class="p">]</span>
</span><span id="TimmClassifier-96"><a href="#TimmClassifier-96"><span class="linenos">96</span></a>        <span class="p">)</span>
</span><span id="TimmClassifier-97"><a href="#TimmClassifier-97"><span class="linenos">97</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Pretrained classifier model loaded from the <a href="https://huggingface.co/models?pipeline_tag=image-classification">HuggingFace model
hub</a>
uploaded by the <code>timm</code> team.</p>
</div>


                            <div id="TimmClassifier.__init__" class="classattr">
                                        <input id="TimmClassifier.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TimmClassifier</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">pretrained</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="TimmClassifier.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimmClassifier.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimmClassifier.__init__-21"><a href="#TimmClassifier.__init__-21"><span class="linenos">21</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TimmClassifier.__init__-22"><a href="#TimmClassifier.__init__-22"><span class="linenos">22</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TimmClassifier.__init__-23"><a href="#TimmClassifier.__init__-23"><span class="linenos">23</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="TimmClassifier.__init__-24"><a href="#TimmClassifier.__init__-24"><span class="linenos">24</span></a>        <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="TimmClassifier.__init__-25"><a href="#TimmClassifier.__init__-25"><span class="linenos">25</span></a>        <span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TimmClassifier.__init__-26"><a href="#TimmClassifier.__init__-26"><span class="linenos">26</span></a>        <span class="n">pretrained</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TimmClassifier.__init__-27"><a href="#TimmClassifier.__init__-27"><span class="linenos">27</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="TimmClassifier.__init__-28"><a href="#TimmClassifier.__init__-28"><span class="linenos">28</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TimmClassifier.__init__-29"><a href="#TimmClassifier.__init__-29"><span class="linenos">29</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimmClassifier.__init__-30"><a href="#TimmClassifier.__init__-30"><span class="linenos">30</span></a><span class="sd">        See also:</span>
</span><span id="TimmClassifier.__init__-31"><a href="#TimmClassifier.__init__-31"><span class="linenos">31</span></a><span class="sd">            `lcc.classifiers.WrappedClassifier.__init__` and</span>
</span><span id="TimmClassifier.__init__-32"><a href="#TimmClassifier.__init__-32"><span class="linenos">32</span></a><span class="sd">            `lcc.classifiers.BaseClassifier.__init__`.</span>
</span><span id="TimmClassifier.__init__-33"><a href="#TimmClassifier.__init__-33"><span class="linenos">33</span></a>
</span><span id="TimmClassifier.__init__-34"><a href="#TimmClassifier.__init__-34"><span class="linenos">34</span></a><span class="sd">        Args:</span>
</span><span id="TimmClassifier.__init__-35"><a href="#TimmClassifier.__init__-35"><span class="linenos">35</span></a><span class="sd">            model_name (str): Model name as in the [HuggingFace model</span>
</span><span id="TimmClassifier.__init__-36"><a href="#TimmClassifier.__init__-36"><span class="linenos">36</span></a><span class="sd">                hub](https://huggingface.co/models?pipeline_tag=image-classification).</span>
</span><span id="TimmClassifier.__init__-37"><a href="#TimmClassifier.__init__-37"><span class="linenos">37</span></a><span class="sd">                Must start with `timm/`.</span>
</span><span id="TimmClassifier.__init__-38"><a href="#TimmClassifier.__init__-38"><span class="linenos">38</span></a><span class="sd">            n_classes (int): See `lcc.classifiers.WrappedClassifier.__init__`.</span>
</span><span id="TimmClassifier.__init__-39"><a href="#TimmClassifier.__init__-39"><span class="linenos">39</span></a><span class="sd">            head_name (str | None, optional): See</span>
</span><span id="TimmClassifier.__init__-40"><a href="#TimmClassifier.__init__-40"><span class="linenos">40</span></a><span class="sd">                `lcc.classifiers.WrappedClassifier.__init__`.</span>
</span><span id="TimmClassifier.__init__-41"><a href="#TimmClassifier.__init__-41"><span class="linenos">41</span></a><span class="sd">            pretrained (bool, optional): Defaults to `True`.</span>
</span><span id="TimmClassifier.__init__-42"><a href="#TimmClassifier.__init__-42"><span class="linenos">42</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimmClassifier.__init__-43"><a href="#TimmClassifier.__init__-43"><span class="linenos">43</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">model_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;timm/&quot;</span><span class="p">):</span>
</span><span id="TimmClassifier.__init__-44"><a href="#TimmClassifier.__init__-44"><span class="linenos">44</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="TimmClassifier.__init__-45"><a href="#TimmClassifier.__init__-45"><span class="linenos">45</span></a>                <span class="s2">&quot;The model isn&#39;t a timm model (its name does not start with &quot;</span>
</span><span id="TimmClassifier.__init__-46"><a href="#TimmClassifier.__init__-46"><span class="linenos">46</span></a>                <span class="s2">&quot;`timm/`). Use `lcc.classifiers.HuggingFaceClassifier` &quot;</span>
</span><span id="TimmClassifier.__init__-47"><a href="#TimmClassifier.__init__-47"><span class="linenos">47</span></a>                <span class="s2">&quot;instead.&quot;</span>
</span><span id="TimmClassifier.__init__-48"><a href="#TimmClassifier.__init__-48"><span class="linenos">48</span></a>            <span class="p">)</span>
</span><span id="TimmClassifier.__init__-49"><a href="#TimmClassifier.__init__-49"><span class="linenos">49</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">timm</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="n">pretrained</span><span class="p">)</span>
</span><span id="TimmClassifier.__init__-50"><a href="#TimmClassifier.__init__-50"><span class="linenos">50</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">head_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TimmClassifier.__init__-51"><a href="#TimmClassifier.__init__-51"><span class="linenos">51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h6 id="see-also">See also:</h6>

<blockquote>
  <p><code><a href="#WrappedClassifier.__init__">lcc.classifiers.WrappedClassifier.__init__</a></code> and
  <code><a href="#BaseClassifier.__init__">lcc.classifiers.BaseClassifier.__init__</a></code>.</p>
</blockquote>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_name (str):</strong>  Model name as in the <a href="https://huggingface.co/models?pipeline_tag=image-classification">HuggingFace model
hub</a>.
Must start with <code>timm/</code>.</li>
<li><strong>n_classes (int):</strong>  See <code><a href="#WrappedClassifier.__init__">lcc.classifiers.WrappedClassifier.__init__</a></code>.</li>
<li><strong>head_name (str | None, optional):</strong>  See
<code><a href="#WrappedClassifier.__init__">lcc.classifiers.WrappedClassifier.__init__</a></code>.</li>
<li><strong>pretrained (bool, optional):</strong>  Defaults to <code>True</code>.</li>
</ul>
</div>


                            </div>
                            <div id="TimmClassifier.image_transform" class="classattr">
                                <div class="attr variable">
            <span class="name">image_transform</span><span class="annotation">: Callable</span>

        
    </div>
    <a class="headerlink" href="#TimmClassifier.image_transform"></a>
    
    

                            </div>
                            <div id="TimmClassifier.get_image_processor" class="classattr">
                                        <input id="TimmClassifier.get_image_processor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_image_processor</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="TimmClassifier.get_image_processor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimmClassifier.get_image_processor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimmClassifier.get_image_processor-53"><a href="#TimmClassifier.get_image_processor-53"><span class="linenos">53</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TimmClassifier.get_image_processor-54"><a href="#TimmClassifier.get_image_processor-54"><span class="linenos">54</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_processor</span><span class="p">(</span><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="TimmClassifier.get_image_processor-55"><a href="#TimmClassifier.get_image_processor-55"><span class="linenos">55</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TimmClassifier.get_image_processor-56"><a href="#TimmClassifier.get_image_processor-56"><span class="linenos">56</span></a><span class="sd">        Wraps the HuggingFace `AutoImageProcessor` associated to a given model.</span>
</span><span id="TimmClassifier.get_image_processor-57"><a href="#TimmClassifier.get_image_processor-57"><span class="linenos">57</span></a>
</span><span id="TimmClassifier.get_image_processor-58"><a href="#TimmClassifier.get_image_processor-58"><span class="linenos">58</span></a><span class="sd">        See also:</span>
</span><span id="TimmClassifier.get_image_processor-59"><a href="#TimmClassifier.get_image_processor-59"><span class="linenos">59</span></a><span class="sd">            [`timm.create_transform`](https://huggingface.co/docs/timm/reference/data#timm.data.create_transform).</span>
</span><span id="TimmClassifier.get_image_processor-60"><a href="#TimmClassifier.get_image_processor-60"><span class="linenos">60</span></a>
</span><span id="TimmClassifier.get_image_processor-61"><a href="#TimmClassifier.get_image_processor-61"><span class="linenos">61</span></a><span class="sd">        Args:</span>
</span><span id="TimmClassifier.get_image_processor-62"><a href="#TimmClassifier.get_image_processor-62"><span class="linenos">62</span></a><span class="sd">            model_name (str): Model name as in the [HuggingFace model</span>
</span><span id="TimmClassifier.get_image_processor-63"><a href="#TimmClassifier.get_image_processor-63"><span class="linenos">63</span></a><span class="sd">                hub](https://huggingface.co/models?pipeline_tag=image-classification).</span>
</span><span id="TimmClassifier.get_image_processor-64"><a href="#TimmClassifier.get_image_processor-64"><span class="linenos">64</span></a><span class="sd">                Must start with `timm/`.</span>
</span><span id="TimmClassifier.get_image_processor-65"><a href="#TimmClassifier.get_image_processor-65"><span class="linenos">65</span></a>
</span><span id="TimmClassifier.get_image_processor-66"><a href="#TimmClassifier.get_image_processor-66"><span class="linenos">66</span></a><span class="sd">        Returns:</span>
</span><span id="TimmClassifier.get_image_processor-67"><a href="#TimmClassifier.get_image_processor-67"><span class="linenos">67</span></a><span class="sd">            A callable that uses a [Torchvision</span>
</span><span id="TimmClassifier.get_image_processor-68"><a href="#TimmClassifier.get_image_processor-68"><span class="linenos">68</span></a><span class="sd">            transform](https://pytorch.org/vision/0.19/transforms.html) under</span>
</span><span id="TimmClassifier.get_image_processor-69"><a href="#TimmClassifier.get_image_processor-69"><span class="linenos">69</span></a><span class="sd">            the hood.</span>
</span><span id="TimmClassifier.get_image_processor-70"><a href="#TimmClassifier.get_image_processor-70"><span class="linenos">70</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TimmClassifier.get_image_processor-71"><a href="#TimmClassifier.get_image_processor-71"><span class="linenos">71</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">timm</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="TimmClassifier.get_image_processor-72"><a href="#TimmClassifier.get_image_processor-72"><span class="linenos">72</span></a>        <span class="n">conf</span> <span class="o">=</span> <span class="n">timm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">resolve_model_data_config</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="TimmClassifier.get_image_processor-73"><a href="#TimmClassifier.get_image_processor-73"><span class="linenos">73</span></a>        <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;is_training&quot;</span><span class="p">],</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;no_aug&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span>
</span><span id="TimmClassifier.get_image_processor-74"><a href="#TimmClassifier.get_image_processor-74"><span class="linenos">74</span></a>        <span class="n">timm_transform</span> <span class="o">=</span> <span class="n">timm</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">create_transform</span><span class="p">(</span><span class="o">**</span><span class="n">conf</span><span class="p">)</span>
</span><span id="TimmClassifier.get_image_processor-75"><a href="#TimmClassifier.get_image_processor-75"><span class="linenos">75</span></a>
</span><span id="TimmClassifier.get_image_processor-76"><a href="#TimmClassifier.get_image_processor-76"><span class="linenos">76</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_transform</span><span class="p">(</span><span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="TimmClassifier.get_image_processor-77"><a href="#TimmClassifier.get_image_processor-77"><span class="linenos">77</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="TimmClassifier.get_image_processor-78"><a href="#TimmClassifier.get_image_processor-78"><span class="linenos">78</span></a>                <span class="n">k</span><span class="p">:</span> <span class="p">(</span>
</span><span id="TimmClassifier.get_image_processor-79"><a href="#TimmClassifier.get_image_processor-79"><span class="linenos">79</span></a>                    <span class="p">(</span>
</span><span id="TimmClassifier.get_image_processor-80"><a href="#TimmClassifier.get_image_processor-80"><span class="linenos">80</span></a>                        <span class="p">[</span><span class="n">timm_transform</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
</span><span id="TimmClassifier.get_image_processor-81"><a href="#TimmClassifier.get_image_processor-81"><span class="linenos">81</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="TimmClassifier.get_image_processor-82"><a href="#TimmClassifier.get_image_processor-82"><span class="linenos">82</span></a>                        <span class="k">else</span> <span class="n">timm_transform</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="TimmClassifier.get_image_processor-83"><a href="#TimmClassifier.get_image_processor-83"><span class="linenos">83</span></a>                    <span class="p">)</span>
</span><span id="TimmClassifier.get_image_processor-84"><a href="#TimmClassifier.get_image_processor-84"><span class="linenos">84</span></a>                    <span class="c1"># TODO: pass image_key from DS </span>
</span><span id="TimmClassifier.get_image_processor-85"><a href="#TimmClassifier.get_image_processor-85"><span class="linenos">85</span></a>                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">]</span>
</span><span id="TimmClassifier.get_image_processor-86"><a href="#TimmClassifier.get_image_processor-86"><span class="linenos">86</span></a>                    <span class="k">else</span> <span class="n">v</span>
</span><span id="TimmClassifier.get_image_processor-87"><a href="#TimmClassifier.get_image_processor-87"><span class="linenos">87</span></a>                <span class="p">)</span>
</span><span id="TimmClassifier.get_image_processor-88"><a href="#TimmClassifier.get_image_processor-88"><span class="linenos">88</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="TimmClassifier.get_image_processor-89"><a href="#TimmClassifier.get_image_processor-89"><span class="linenos">89</span></a>            <span class="p">}</span>
</span><span id="TimmClassifier.get_image_processor-90"><a href="#TimmClassifier.get_image_processor-90"><span class="linenos">90</span></a>
</span><span id="TimmClassifier.get_image_processor-91"><a href="#TimmClassifier.get_image_processor-91"><span class="linenos">91</span></a>        <span class="k">return</span> <span class="n">_transform</span>
</span></pre></div>


            <div class="docstring"><p>Wraps the HuggingFace <code>AutoImageProcessor</code> associated to a given model.</p>

<h6 id="see-also">See also:</h6>

<blockquote>
  <p><a href="https://huggingface.co/docs/timm/reference/data#timm.data.create_transform"><code>timm.create_transform</code></a>.</p>
</blockquote>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model_name (str):</strong>  Model name as in the <a href="https://huggingface.co/models?pipeline_tag=image-classification">HuggingFace model
hub</a>.
Must start with <code>timm/</code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A callable that uses a <a href="https://pytorch.org/vision/0.19/transforms.html">Torchvision
  transform</a> under
  the hood.</p>
</blockquote>
</div>


                            </div>
                            <div id="TimmClassifier.forward" class="classattr">
                                        <input id="TimmClassifier.forward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">forward</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">inputs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="TimmClassifier.forward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TimmClassifier.forward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TimmClassifier.forward-93"><a href="#TimmClassifier.forward-93"><span class="linenos">93</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">|</span> <span class="n">Batch</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="TimmClassifier.forward-94"><a href="#TimmClassifier.forward-94"><span class="linenos">94</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TimmClassifier.forward-95"><a href="#TimmClassifier.forward-95"><span class="linenos">95</span></a>            <span class="n">inputs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">)</span> <span class="k">else</span> <span class="n">inputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">image_key</span><span class="p">]</span>
</span><span id="TimmClassifier.forward-96"><a href="#TimmClassifier.forward-96"><span class="linenos">96</span></a>        <span class="p">)</span>
</span><span id="TimmClassifier.forward-97"><a href="#TimmClassifier.forward-97"><span class="linenos">97</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Same as <code>torch.nn.Module.forward()</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*args:</strong>  Whatever you decide to pass into the forward method.</li>
<li><strong>**kwargs:</strong>  Keyword arguments are also possible.</li>
</ul>

<h6 id="return">Return:</h6>

<blockquote>
  <p>Your model's output</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="TorchvisionClassifier">
                            <input id="TorchvisionClassifier-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TorchvisionClassifier</span><wbr>(<span class="base"><a href="#WrappedClassifier">lcc.classifiers.WrappedClassifier</a></span>):

                <label class="view-source-button" for="TorchvisionClassifier-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TorchvisionClassifier"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TorchvisionClassifier-12"><a href="#TorchvisionClassifier-12"><span class="linenos">12</span></a><span class="k">class</span><span class="w"> </span><span class="nc">TorchvisionClassifier</span><span class="p">(</span><span class="n">WrappedClassifier</span><span class="p">):</span>
</span><span id="TorchvisionClassifier-13"><a href="#TorchvisionClassifier-13"><span class="linenos">13</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TorchvisionClassifier-14"><a href="#TorchvisionClassifier-14"><span class="linenos">14</span></a><span class="sd">    A torchvision classifier wrapped as a `WrappedClassifier`. See</span>
</span><span id="TorchvisionClassifier-15"><a href="#TorchvisionClassifier-15"><span class="linenos">15</span></a><span class="sd">    https://pytorch.org/vision/stable/models.html#classification .</span>
</span><span id="TorchvisionClassifier-16"><a href="#TorchvisionClassifier-16"><span class="linenos">16</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TorchvisionClassifier-17"><a href="#TorchvisionClassifier-17"><span class="linenos">17</span></a>
</span><span id="TorchvisionClassifier-18"><a href="#TorchvisionClassifier-18"><span class="linenos">18</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TorchvisionClassifier-19"><a href="#TorchvisionClassifier-19"><span class="linenos">19</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TorchvisionClassifier-20"><a href="#TorchvisionClassifier-20"><span class="linenos">20</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="TorchvisionClassifier-21"><a href="#TorchvisionClassifier-21"><span class="linenos">21</span></a>        <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="TorchvisionClassifier-22"><a href="#TorchvisionClassifier-22"><span class="linenos">22</span></a>        <span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TorchvisionClassifier-23"><a href="#TorchvisionClassifier-23"><span class="linenos">23</span></a>        <span class="n">weights</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="s2">&quot;DEFAULT&quot;</span><span class="p">,</span>
</span><span id="TorchvisionClassifier-24"><a href="#TorchvisionClassifier-24"><span class="linenos">24</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="TorchvisionClassifier-25"><a href="#TorchvisionClassifier-25"><span class="linenos">25</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TorchvisionClassifier-26"><a href="#TorchvisionClassifier-26"><span class="linenos">26</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
</span><span id="TorchvisionClassifier-27"><a href="#TorchvisionClassifier-27"><span class="linenos">27</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">head_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TorchvisionClassifier-28"><a href="#TorchvisionClassifier-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>
</span><span id="TorchvisionClassifier-29"><a href="#TorchvisionClassifier-29"><span class="linenos">29</span></a>
</span><span id="TorchvisionClassifier-30"><a href="#TorchvisionClassifier-30"><span class="linenos">30</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TorchvisionClassifier-31"><a href="#TorchvisionClassifier-31"><span class="linenos">31</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_processor</span><span class="p">(</span>
</span><span id="TorchvisionClassifier-32"><a href="#TorchvisionClassifier-32"><span class="linenos">32</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DEFAULT&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="TorchvisionClassifier-33"><a href="#TorchvisionClassifier-33"><span class="linenos">33</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="TorchvisionClassifier-34"><a href="#TorchvisionClassifier-34"><span class="linenos">34</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TorchvisionClassifier-35"><a href="#TorchvisionClassifier-35"><span class="linenos">35</span></a><span class="sd">        Creates an image processor based on the transform object of the model&#39;s</span>
</span><span id="TorchvisionClassifier-36"><a href="#TorchvisionClassifier-36"><span class="linenos">36</span></a><span class="sd">        chosen weights. For example,</span>
</span><span id="TorchvisionClassifier-37"><a href="#TorchvisionClassifier-37"><span class="linenos">37</span></a>
</span><span id="TorchvisionClassifier-38"><a href="#TorchvisionClassifier-38"><span class="linenos">38</span></a><span class="sd">            TorchvisionClassifier.get_image_processor(&quot;alexnet&quot;)</span>
</span><span id="TorchvisionClassifier-39"><a href="#TorchvisionClassifier-39"><span class="linenos">39</span></a>
</span><span id="TorchvisionClassifier-40"><a href="#TorchvisionClassifier-40"><span class="linenos">40</span></a><span class="sd">        is analogous to</span>
</span><span id="TorchvisionClassifier-41"><a href="#TorchvisionClassifier-41"><span class="linenos">41</span></a>
</span><span id="TorchvisionClassifier-42"><a href="#TorchvisionClassifier-42"><span class="linenos">42</span></a><span class="sd">            get_model_weights(&quot;alexnet&quot;)[&quot;DEFAULT&quot;].transforms()</span>
</span><span id="TorchvisionClassifier-43"><a href="#TorchvisionClassifier-43"><span class="linenos">43</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TorchvisionClassifier-44"><a href="#TorchvisionClassifier-44"><span class="linenos">44</span></a>
</span><span id="TorchvisionClassifier-45"><a href="#TorchvisionClassifier-45"><span class="linenos">45</span></a>        <span class="n">transform</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
</span><span id="TorchvisionClassifier-46"><a href="#TorchvisionClassifier-46"><span class="linenos">46</span></a>            <span class="p">[</span><span class="n">tr</span><span class="o">.</span><span class="n">RGB</span><span class="p">(),</span> <span class="n">get_model_weights</span><span class="p">(</span><span class="n">model_name</span><span class="p">)[</span><span class="n">weights</span><span class="p">]</span><span class="o">.</span><span class="n">transforms</span><span class="p">()]</span>
</span><span id="TorchvisionClassifier-47"><a href="#TorchvisionClassifier-47"><span class="linenos">47</span></a>        <span class="p">)</span>
</span><span id="TorchvisionClassifier-48"><a href="#TorchvisionClassifier-48"><span class="linenos">48</span></a>
</span><span id="TorchvisionClassifier-49"><a href="#TorchvisionClassifier-49"><span class="linenos">49</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_processor</span><span class="p">(</span><span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="TorchvisionClassifier-50"><a href="#TorchvisionClassifier-50"><span class="linenos">50</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="TorchvisionClassifier-51"><a href="#TorchvisionClassifier-51"><span class="linenos">51</span></a>                <span class="n">k</span><span class="p">:</span> <span class="p">(</span>
</span><span id="TorchvisionClassifier-52"><a href="#TorchvisionClassifier-52"><span class="linenos">52</span></a>                    <span class="p">[</span><span class="n">transform</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
</span><span id="TorchvisionClassifier-53"><a href="#TorchvisionClassifier-53"><span class="linenos">53</span></a>                    <span class="c1"># TODO: pass image_key from DS </span>
</span><span id="TorchvisionClassifier-54"><a href="#TorchvisionClassifier-54"><span class="linenos">54</span></a>                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">]</span>
</span><span id="TorchvisionClassifier-55"><a href="#TorchvisionClassifier-55"><span class="linenos">55</span></a>                    <span class="k">else</span> <span class="n">v</span>
</span><span id="TorchvisionClassifier-56"><a href="#TorchvisionClassifier-56"><span class="linenos">56</span></a>                <span class="p">)</span>
</span><span id="TorchvisionClassifier-57"><a href="#TorchvisionClassifier-57"><span class="linenos">57</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="TorchvisionClassifier-58"><a href="#TorchvisionClassifier-58"><span class="linenos">58</span></a>            <span class="p">}</span>
</span><span id="TorchvisionClassifier-59"><a href="#TorchvisionClassifier-59"><span class="linenos">59</span></a>
</span><span id="TorchvisionClassifier-60"><a href="#TorchvisionClassifier-60"><span class="linenos">60</span></a>        <span class="k">return</span> <span class="n">_processor</span>
</span></pre></div>


            <div class="docstring"><p>A torchvision classifier wrapped as a <code><a href="#WrappedClassifier">WrappedClassifier</a></code>. See
<a href="https://pytorch.org/vision/stable/models.html#classification">https://pytorch.org/vision/stable/models.html#classification</a> .</p>
</div>


                            <div id="TorchvisionClassifier.__init__" class="classattr">
                                        <input id="TorchvisionClassifier.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TorchvisionClassifier</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">weights</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="s1">&#39;DEFAULT&#39;</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="TorchvisionClassifier.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TorchvisionClassifier.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TorchvisionClassifier.__init__-18"><a href="#TorchvisionClassifier.__init__-18"><span class="linenos">18</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="TorchvisionClassifier.__init__-19"><a href="#TorchvisionClassifier.__init__-19"><span class="linenos">19</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TorchvisionClassifier.__init__-20"><a href="#TorchvisionClassifier.__init__-20"><span class="linenos">20</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="TorchvisionClassifier.__init__-21"><a href="#TorchvisionClassifier.__init__-21"><span class="linenos">21</span></a>        <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="TorchvisionClassifier.__init__-22"><a href="#TorchvisionClassifier.__init__-22"><span class="linenos">22</span></a>        <span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TorchvisionClassifier.__init__-23"><a href="#TorchvisionClassifier.__init__-23"><span class="linenos">23</span></a>        <span class="n">weights</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="s2">&quot;DEFAULT&quot;</span><span class="p">,</span>
</span><span id="TorchvisionClassifier.__init__-24"><a href="#TorchvisionClassifier.__init__-24"><span class="linenos">24</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="TorchvisionClassifier.__init__-25"><a href="#TorchvisionClassifier.__init__-25"><span class="linenos">25</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TorchvisionClassifier.__init__-26"><a href="#TorchvisionClassifier.__init__-26"><span class="linenos">26</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
</span><span id="TorchvisionClassifier.__init__-27"><a href="#TorchvisionClassifier.__init__-27"><span class="linenos">27</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">head_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TorchvisionClassifier.__init__-28"><a href="#TorchvisionClassifier.__init__-28"><span class="linenos">28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h6 id="see-also">See also:</h6>

<blockquote>
  <p><code><a href="#BaseClassifier.__init__">lcc.classifiers.BaseClassifier.__init__</a></code>.</p>
</blockquote>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model (nn.Module):</strong> </li>
<li><strong>n_classes (int):</strong>  Number of classes in the dataset on which the model
will be trained.</li>
<li><strong>head_name (str | None, optional):</strong>  Name of the head submodule in
<code><a href="#TorchvisionClassifier.model">model</a></code>, which is the fully connected (aka
<a href="https://pytorch.org/docs/stable/generated/torch.nn.Linear.html"><code>nn.Linear</code></a>)
layer that outputs the logits. If not <code>None</code>, the head is
replaced by a new fully connected layer with <code>n_classes</code> output
neurons classes. Specify this to fine-tune a pretrained model
on a new dataset with the same or a different number of
classes. The name of a submodule can be retried by inspecting
the output of <code>nn.Module.named_modules</code> or
<code><a href="utils.html#pretty_print_submodules">lcc.utils.pretty_print_submodules</a></code>.</li>
<li><strong>logit_key (str | None, optional):</strong>  If the wrapped model outputs a
dict-like object instead of a tensor, this key is used to access
the actual logits.</li>
</ul>
</div>


                            </div>
                            <div id="TorchvisionClassifier.get_image_processor" class="classattr">
                                        <input id="TorchvisionClassifier.get_image_processor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-staticmethod">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_image_processor</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">weights</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;DEFAULT&#39;</span>,</span><span class="param">	<span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="TorchvisionClassifier.get_image_processor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TorchvisionClassifier.get_image_processor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TorchvisionClassifier.get_image_processor-30"><a href="#TorchvisionClassifier.get_image_processor-30"><span class="linenos">30</span></a>    <span class="nd">@staticmethod</span>
</span><span id="TorchvisionClassifier.get_image_processor-31"><a href="#TorchvisionClassifier.get_image_processor-31"><span class="linenos">31</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_processor</span><span class="p">(</span>
</span><span id="TorchvisionClassifier.get_image_processor-32"><a href="#TorchvisionClassifier.get_image_processor-32"><span class="linenos">32</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DEFAULT&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="TorchvisionClassifier.get_image_processor-33"><a href="#TorchvisionClassifier.get_image_processor-33"><span class="linenos">33</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="TorchvisionClassifier.get_image_processor-34"><a href="#TorchvisionClassifier.get_image_processor-34"><span class="linenos">34</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TorchvisionClassifier.get_image_processor-35"><a href="#TorchvisionClassifier.get_image_processor-35"><span class="linenos">35</span></a><span class="sd">        Creates an image processor based on the transform object of the model&#39;s</span>
</span><span id="TorchvisionClassifier.get_image_processor-36"><a href="#TorchvisionClassifier.get_image_processor-36"><span class="linenos">36</span></a><span class="sd">        chosen weights. For example,</span>
</span><span id="TorchvisionClassifier.get_image_processor-37"><a href="#TorchvisionClassifier.get_image_processor-37"><span class="linenos">37</span></a>
</span><span id="TorchvisionClassifier.get_image_processor-38"><a href="#TorchvisionClassifier.get_image_processor-38"><span class="linenos">38</span></a><span class="sd">            TorchvisionClassifier.get_image_processor(&quot;alexnet&quot;)</span>
</span><span id="TorchvisionClassifier.get_image_processor-39"><a href="#TorchvisionClassifier.get_image_processor-39"><span class="linenos">39</span></a>
</span><span id="TorchvisionClassifier.get_image_processor-40"><a href="#TorchvisionClassifier.get_image_processor-40"><span class="linenos">40</span></a><span class="sd">        is analogous to</span>
</span><span id="TorchvisionClassifier.get_image_processor-41"><a href="#TorchvisionClassifier.get_image_processor-41"><span class="linenos">41</span></a>
</span><span id="TorchvisionClassifier.get_image_processor-42"><a href="#TorchvisionClassifier.get_image_processor-42"><span class="linenos">42</span></a><span class="sd">            get_model_weights(&quot;alexnet&quot;)[&quot;DEFAULT&quot;].transforms()</span>
</span><span id="TorchvisionClassifier.get_image_processor-43"><a href="#TorchvisionClassifier.get_image_processor-43"><span class="linenos">43</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TorchvisionClassifier.get_image_processor-44"><a href="#TorchvisionClassifier.get_image_processor-44"><span class="linenos">44</span></a>
</span><span id="TorchvisionClassifier.get_image_processor-45"><a href="#TorchvisionClassifier.get_image_processor-45"><span class="linenos">45</span></a>        <span class="n">transform</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
</span><span id="TorchvisionClassifier.get_image_processor-46"><a href="#TorchvisionClassifier.get_image_processor-46"><span class="linenos">46</span></a>            <span class="p">[</span><span class="n">tr</span><span class="o">.</span><span class="n">RGB</span><span class="p">(),</span> <span class="n">get_model_weights</span><span class="p">(</span><span class="n">model_name</span><span class="p">)[</span><span class="n">weights</span><span class="p">]</span><span class="o">.</span><span class="n">transforms</span><span class="p">()]</span>
</span><span id="TorchvisionClassifier.get_image_processor-47"><a href="#TorchvisionClassifier.get_image_processor-47"><span class="linenos">47</span></a>        <span class="p">)</span>
</span><span id="TorchvisionClassifier.get_image_processor-48"><a href="#TorchvisionClassifier.get_image_processor-48"><span class="linenos">48</span></a>
</span><span id="TorchvisionClassifier.get_image_processor-49"><a href="#TorchvisionClassifier.get_image_processor-49"><span class="linenos">49</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">_processor</span><span class="p">(</span><span class="n">batch</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="TorchvisionClassifier.get_image_processor-50"><a href="#TorchvisionClassifier.get_image_processor-50"><span class="linenos">50</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="TorchvisionClassifier.get_image_processor-51"><a href="#TorchvisionClassifier.get_image_processor-51"><span class="linenos">51</span></a>                <span class="n">k</span><span class="p">:</span> <span class="p">(</span>
</span><span id="TorchvisionClassifier.get_image_processor-52"><a href="#TorchvisionClassifier.get_image_processor-52"><span class="linenos">52</span></a>                    <span class="p">[</span><span class="n">transform</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
</span><span id="TorchvisionClassifier.get_image_processor-53"><a href="#TorchvisionClassifier.get_image_processor-53"><span class="linenos">53</span></a>                    <span class="c1"># TODO: pass image_key from DS </span>
</span><span id="TorchvisionClassifier.get_image_processor-54"><a href="#TorchvisionClassifier.get_image_processor-54"><span class="linenos">54</span></a>                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;img&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;png&quot;</span><span class="p">]</span>
</span><span id="TorchvisionClassifier.get_image_processor-55"><a href="#TorchvisionClassifier.get_image_processor-55"><span class="linenos">55</span></a>                    <span class="k">else</span> <span class="n">v</span>
</span><span id="TorchvisionClassifier.get_image_processor-56"><a href="#TorchvisionClassifier.get_image_processor-56"><span class="linenos">56</span></a>                <span class="p">)</span>
</span><span id="TorchvisionClassifier.get_image_processor-57"><a href="#TorchvisionClassifier.get_image_processor-57"><span class="linenos">57</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="TorchvisionClassifier.get_image_processor-58"><a href="#TorchvisionClassifier.get_image_processor-58"><span class="linenos">58</span></a>            <span class="p">}</span>
</span><span id="TorchvisionClassifier.get_image_processor-59"><a href="#TorchvisionClassifier.get_image_processor-59"><span class="linenos">59</span></a>
</span><span id="TorchvisionClassifier.get_image_processor-60"><a href="#TorchvisionClassifier.get_image_processor-60"><span class="linenos">60</span></a>        <span class="k">return</span> <span class="n">_processor</span>
</span></pre></div>


            <div class="docstring"><p>Creates an image processor based on the transform object of the model's
chosen weights. For example,</p>

<pre><code><a href="#TorchvisionClassifier.get_image_processor">TorchvisionClassifier.get_image_processor</a>("alexnet")
</code></pre>

<p>is analogous to</p>

<pre><code>get_model_weights("alexnet")["DEFAULT"].transforms()
</code></pre>
</div>


                            </div>
                </section>
                <section id="validate_lcc_kwargs">
                            <input id="validate_lcc_kwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_lcc_kwargs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">lcc_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="validate_lcc_kwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_lcc_kwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_lcc_kwargs-79"><a href="#validate_lcc_kwargs-79"><span class="linenos"> 79</span></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_lcc_kwargs</span><span class="p">(</span><span class="n">lcc_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="validate_lcc_kwargs-80"><a href="#validate_lcc_kwargs-80"><span class="linenos"> 80</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_lcc_kwargs-81"><a href="#validate_lcc_kwargs-81"><span class="linenos"> 81</span></a><span class="sd">    Makes sure that an LCC hyperparameter dict is valid. Used in constructors of</span>
</span><span id="validate_lcc_kwargs-82"><a href="#validate_lcc_kwargs-82"><span class="linenos"> 82</span></a><span class="sd">    LCC enabled classifiers.</span>
</span><span id="validate_lcc_kwargs-83"><a href="#validate_lcc_kwargs-83"><span class="linenos"> 83</span></a>
</span><span id="validate_lcc_kwargs-84"><a href="#validate_lcc_kwargs-84"><span class="linenos"> 84</span></a><span class="sd">    Args:</span>
</span><span id="validate_lcc_kwargs-85"><a href="#validate_lcc_kwargs-85"><span class="linenos"> 85</span></a><span class="sd">        lcc_kwargs (dict[str, Any] | None):</span>
</span><span id="validate_lcc_kwargs-86"><a href="#validate_lcc_kwargs-86"><span class="linenos"> 86</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_lcc_kwargs-87"><a href="#validate_lcc_kwargs-87"><span class="linenos"> 87</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">lcc_kwargs</span><span class="p">:</span>
</span><span id="validate_lcc_kwargs-88"><a href="#validate_lcc_kwargs-88"><span class="linenos"> 88</span></a>        <span class="k">return</span>
</span><span id="validate_lcc_kwargs-89"><a href="#validate_lcc_kwargs-89"><span class="linenos"> 89</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">:=</span> <span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="validate_lcc_kwargs-90"><a href="#validate_lcc_kwargs-90"><span class="linenos"> 90</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LCC weight must be positive, got </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="validate_lcc_kwargs-91"><a href="#validate_lcc_kwargs-91"><span class="linenos"> 91</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">:=</span> <span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interval&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="validate_lcc_kwargs-92"><a href="#validate_lcc_kwargs-92"><span class="linenos"> 92</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LCC interval must be at least 1, got </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="validate_lcc_kwargs-93"><a href="#validate_lcc_kwargs-93"><span class="linenos"> 93</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">:=</span> <span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;warmup&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="validate_lcc_kwargs-94"><a href="#validate_lcc_kwargs-94"><span class="linenos"> 94</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LCC warmup must be at least 0, got </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="validate_lcc_kwargs-95"><a href="#validate_lcc_kwargs-95"><span class="linenos"> 95</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">:=</span> <span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;class_selection&quot;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">LCC_CLASS_SELECTIONS</span> <span class="o">+</span> <span class="p">[</span>
</span><span id="validate_lcc_kwargs-96"><a href="#validate_lcc_kwargs-96"><span class="linenos"> 96</span></a>        <span class="kc">None</span>
</span><span id="validate_lcc_kwargs-97"><a href="#validate_lcc_kwargs-97"><span class="linenos"> 97</span></a>    <span class="p">]:</span>
</span><span id="validate_lcc_kwargs-98"><a href="#validate_lcc_kwargs-98"><span class="linenos"> 98</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_lcc_kwargs-99"><a href="#validate_lcc_kwargs-99"><span class="linenos"> 99</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid class selection policy &#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#39;. Available policies are: &quot;</span>
</span><span id="validate_lcc_kwargs-100"><a href="#validate_lcc_kwargs-100"><span class="linenos">100</span></a>            <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">LCC_CLASS_SELECTIONS</span><span class="p">))</span>
</span><span id="validate_lcc_kwargs-101"><a href="#validate_lcc_kwargs-101"><span class="linenos">101</span></a>            <span class="o">+</span> <span class="s2">&quot;, or `None`&quot;</span>
</span><span id="validate_lcc_kwargs-102"><a href="#validate_lcc_kwargs-102"><span class="linenos">102</span></a>        <span class="p">)</span>
</span><span id="validate_lcc_kwargs-103"><a href="#validate_lcc_kwargs-103"><span class="linenos">103</span></a>    <span class="n">LCC_LOSS_TYPES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;exact&quot;</span><span class="p">,</span> <span class="s2">&quot;randomized&quot;</span><span class="p">]</span>
</span><span id="validate_lcc_kwargs-104"><a href="#validate_lcc_kwargs-104"><span class="linenos">104</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">:=</span> <span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="s2">&quot;exact&quot;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">LCC_LOSS_TYPES</span><span class="p">:</span>
</span><span id="validate_lcc_kwargs-105"><a href="#validate_lcc_kwargs-105"><span class="linenos">105</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_lcc_kwargs-106"><a href="#validate_lcc_kwargs-106"><span class="linenos">106</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid LCC loss type &#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#39;. Available types are: &quot;</span>
</span><span id="validate_lcc_kwargs-107"><a href="#validate_lcc_kwargs-107"><span class="linenos">107</span></a>            <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">LCC_LOSS_TYPES</span><span class="p">))</span>
</span><span id="validate_lcc_kwargs-108"><a href="#validate_lcc_kwargs-108"><span class="linenos">108</span></a>        <span class="p">)</span>
</span><span id="validate_lcc_kwargs-109"><a href="#validate_lcc_kwargs-109"><span class="linenos">109</span></a>    <span class="n">LCC_CLUSTERING_METHODS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;louvain&quot;</span><span class="p">,</span> <span class="s2">&quot;peer_pressure&quot;</span><span class="p">]</span>
</span><span id="validate_lcc_kwargs-110"><a href="#validate_lcc_kwargs-110"><span class="linenos">110</span></a>    <span class="k">if</span> <span class="p">(</span>
</span><span id="validate_lcc_kwargs-111"><a href="#validate_lcc_kwargs-111"><span class="linenos">111</span></a>        <span class="n">x</span> <span class="o">:=</span> <span class="n">lcc_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;clustering_method&quot;</span><span class="p">,</span> <span class="s2">&quot;louvain&quot;</span><span class="p">)</span>
</span><span id="validate_lcc_kwargs-112"><a href="#validate_lcc_kwargs-112"><span class="linenos">112</span></a>    <span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">LCC_CLUSTERING_METHODS</span><span class="p">:</span>
</span><span id="validate_lcc_kwargs-113"><a href="#validate_lcc_kwargs-113"><span class="linenos">113</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="validate_lcc_kwargs-114"><a href="#validate_lcc_kwargs-114"><span class="linenos">114</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid latent clustering method &#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#39;. Available methods are: &quot;</span>
</span><span id="validate_lcc_kwargs-115"><a href="#validate_lcc_kwargs-115"><span class="linenos">115</span></a>            <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">LCC_CLUSTERING_METHODS</span><span class="p">))</span>
</span><span id="validate_lcc_kwargs-116"><a href="#validate_lcc_kwargs-116"><span class="linenos">116</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Makes sure that an LCC hyperparameter dict is valid. Used in constructors of
LCC enabled classifiers.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>lcc_kwargs (dict[str, Any] | None):</strong> </li>
</ul>
</div>


                </section>
                <section id="WrappedClassifier">
                            <input id="WrappedClassifier-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">WrappedClassifier</span><wbr>(<span class="base"><a href="#BaseClassifier">lcc.classifiers.BaseClassifier</a></span>):

                <label class="view-source-button" for="WrappedClassifier-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WrappedClassifier"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WrappedClassifier-13"><a href="#WrappedClassifier-13"><span class="linenos">13</span></a><span class="k">class</span><span class="w"> </span><span class="nc">WrappedClassifier</span><span class="p">(</span><span class="n">BaseClassifier</span><span class="p">):</span>
</span><span id="WrappedClassifier-14"><a href="#WrappedClassifier-14"><span class="linenos">14</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WrappedClassifier-15"><a href="#WrappedClassifier-15"><span class="linenos">15</span></a><span class="sd">    An image classifier model</span>
</span><span id="WrappedClassifier-16"><a href="#WrappedClassifier-16"><span class="linenos">16</span></a><span class="sd">    ([`torch.nn.Module`](https://pytorch.org/docs/stable/generated/torch.nn.Module.html))</span>
</span><span id="WrappedClassifier-17"><a href="#WrappedClassifier-17"><span class="linenos">17</span></a><span class="sd">    wrapped inside a `lcc.classifiers.BaseClassifier`.</span>
</span><span id="WrappedClassifier-18"><a href="#WrappedClassifier-18"><span class="linenos">18</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="WrappedClassifier-19"><a href="#WrappedClassifier-19"><span class="linenos">19</span></a>
</span><span id="WrappedClassifier-20"><a href="#WrappedClassifier-20"><span class="linenos">20</span></a>    <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span>
</span><span id="WrappedClassifier-21"><a href="#WrappedClassifier-21"><span class="linenos">21</span></a>
</span><span id="WrappedClassifier-22"><a href="#WrappedClassifier-22"><span class="linenos">22</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="WrappedClassifier-23"><a href="#WrappedClassifier-23"><span class="linenos">23</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="WrappedClassifier-24"><a href="#WrappedClassifier-24"><span class="linenos">24</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
</span><span id="WrappedClassifier-25"><a href="#WrappedClassifier-25"><span class="linenos">25</span></a>        <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="WrappedClassifier-26"><a href="#WrappedClassifier-26"><span class="linenos">26</span></a>        <span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="WrappedClassifier-27"><a href="#WrappedClassifier-27"><span class="linenos">27</span></a>        <span class="n">logit_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="WrappedClassifier-28"><a href="#WrappedClassifier-28"><span class="linenos">28</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="WrappedClassifier-29"><a href="#WrappedClassifier-29"><span class="linenos">29</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WrappedClassifier-30"><a href="#WrappedClassifier-30"><span class="linenos">30</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WrappedClassifier-31"><a href="#WrappedClassifier-31"><span class="linenos">31</span></a><span class="sd">        See also:</span>
</span><span id="WrappedClassifier-32"><a href="#WrappedClassifier-32"><span class="linenos">32</span></a><span class="sd">            `lcc.classifiers.BaseClassifier.__init__`.</span>
</span><span id="WrappedClassifier-33"><a href="#WrappedClassifier-33"><span class="linenos">33</span></a>
</span><span id="WrappedClassifier-34"><a href="#WrappedClassifier-34"><span class="linenos">34</span></a><span class="sd">        Args:</span>
</span><span id="WrappedClassifier-35"><a href="#WrappedClassifier-35"><span class="linenos">35</span></a><span class="sd">            model (nn.Module):</span>
</span><span id="WrappedClassifier-36"><a href="#WrappedClassifier-36"><span class="linenos">36</span></a><span class="sd">            n_classes (int): Number of classes in the dataset on which the model</span>
</span><span id="WrappedClassifier-37"><a href="#WrappedClassifier-37"><span class="linenos">37</span></a><span class="sd">                will be trained.</span>
</span><span id="WrappedClassifier-38"><a href="#WrappedClassifier-38"><span class="linenos">38</span></a><span class="sd">            head_name (str | None, optional): Name of the head submodule in</span>
</span><span id="WrappedClassifier-39"><a href="#WrappedClassifier-39"><span class="linenos">39</span></a><span class="sd">                `model`, which is the fully connected (aka</span>
</span><span id="WrappedClassifier-40"><a href="#WrappedClassifier-40"><span class="linenos">40</span></a><span class="sd">                [`nn.Linear`](https://pytorch.org/docs/stable/generated/torch.nn.Linear.html))</span>
</span><span id="WrappedClassifier-41"><a href="#WrappedClassifier-41"><span class="linenos">41</span></a><span class="sd">                layer that outputs the logits. If not `None`, the head is</span>
</span><span id="WrappedClassifier-42"><a href="#WrappedClassifier-42"><span class="linenos">42</span></a><span class="sd">                replaced by a new fully connected layer with `n_classes` output</span>
</span><span id="WrappedClassifier-43"><a href="#WrappedClassifier-43"><span class="linenos">43</span></a><span class="sd">                neurons classes. Specify this to fine-tune a pretrained model</span>
</span><span id="WrappedClassifier-44"><a href="#WrappedClassifier-44"><span class="linenos">44</span></a><span class="sd">                on a new dataset with the same or a different number of</span>
</span><span id="WrappedClassifier-45"><a href="#WrappedClassifier-45"><span class="linenos">45</span></a><span class="sd">                classes. The name of a submodule can be retried by inspecting</span>
</span><span id="WrappedClassifier-46"><a href="#WrappedClassifier-46"><span class="linenos">46</span></a><span class="sd">                the output of `nn.Module.named_modules` or</span>
</span><span id="WrappedClassifier-47"><a href="#WrappedClassifier-47"><span class="linenos">47</span></a><span class="sd">                `lcc.utils.pretty_print_submodules`.</span>
</span><span id="WrappedClassifier-48"><a href="#WrappedClassifier-48"><span class="linenos">48</span></a><span class="sd">            logit_key (str | None, optional): If the wrapped model outputs a</span>
</span><span id="WrappedClassifier-49"><a href="#WrappedClassifier-49"><span class="linenos">49</span></a><span class="sd">                dict-like object instead of a tensor, this key is used to access</span>
</span><span id="WrappedClassifier-50"><a href="#WrappedClassifier-50"><span class="linenos">50</span></a><span class="sd">                the actual logits.</span>
</span><span id="WrappedClassifier-51"><a href="#WrappedClassifier-51"><span class="linenos">51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WrappedClassifier-52"><a href="#WrappedClassifier-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">(</span><span class="n">ignore</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">])</span>
</span><span id="WrappedClassifier-53"><a href="#WrappedClassifier-53"><span class="linenos">53</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_classes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WrappedClassifier-54"><a href="#WrappedClassifier-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="WrappedClassifier-55"><a href="#WrappedClassifier-55"><span class="linenos">55</span></a>        <span class="k">if</span> <span class="n">head_name</span><span class="p">:</span>
</span><span id="WrappedClassifier-56"><a href="#WrappedClassifier-56"><span class="linenos">56</span></a>            <span class="n">replace_head</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">head_name</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">)</span>
</span><span id="WrappedClassifier-57"><a href="#WrappedClassifier-57"><span class="linenos">57</span></a>
</span><span id="WrappedClassifier-58"><a href="#WrappedClassifier-58"><span class="linenos">58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">|</span> <span class="n">Batch</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="WrappedClassifier-59"><a href="#WrappedClassifier-59"><span class="linenos">59</span></a>        <span class="n">image_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;image_key&quot;</span><span class="p">]</span>
</span><span id="WrappedClassifier-60"><a href="#WrappedClassifier-60"><span class="linenos">60</span></a>        <span class="n">logit_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logit_key&quot;</span><span class="p">)</span>
</span><span id="WrappedClassifier-61"><a href="#WrappedClassifier-61"><span class="linenos">61</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">inputs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">)</span> <span class="k">else</span> <span class="n">inputs</span><span class="p">[</span><span class="n">image_key</span><span class="p">]</span>
</span><span id="WrappedClassifier-62"><a href="#WrappedClassifier-62"><span class="linenos">62</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</span><span id="WrappedClassifier-63"><a href="#WrappedClassifier-63"><span class="linenos">63</span></a>        <span class="k">return</span> <span class="n">output</span> <span class="k">if</span> <span class="n">logit_key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">output</span><span class="p">[</span><span class="n">logit_key</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="WrappedClassifier-64"><a href="#WrappedClassifier-64"><span class="linenos">64</span></a>
</span><span id="WrappedClassifier-65"><a href="#WrappedClassifier-65"><span class="linenos">65</span></a>    <span class="nd">@property</span>
</span><span id="WrappedClassifier-66"><a href="#WrappedClassifier-66"><span class="linenos">66</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lcc_submodules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="WrappedClassifier-67"><a href="#WrappedClassifier-67"><span class="linenos">67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WrappedClassifier-68"><a href="#WrappedClassifier-68"><span class="linenos">68</span></a><span class="sd">        Returns the list of submodules considered for LCC, whith correct prefix</span>
</span><span id="WrappedClassifier-69"><a href="#WrappedClassifier-69"><span class="linenos">69</span></a><span class="sd">        if needed.</span>
</span><span id="WrappedClassifier-70"><a href="#WrappedClassifier-70"><span class="linenos">70</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WrappedClassifier-71"><a href="#WrappedClassifier-71"><span class="linenos">71</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="WrappedClassifier-72"><a href="#WrappedClassifier-72"><span class="linenos">72</span></a>            <span class="p">[]</span>
</span><span id="WrappedClassifier-73"><a href="#WrappedClassifier-73"><span class="linenos">73</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;lcc_submodules&quot;</span><span class="p">]</span>
</span><span id="WrappedClassifier-74"><a href="#WrappedClassifier-74"><span class="linenos">74</span></a>            <span class="k">else</span> <span class="p">[</span>
</span><span id="WrappedClassifier-75"><a href="#WrappedClassifier-75"><span class="linenos">75</span></a>                <span class="p">(</span><span class="n">sm</span> <span class="k">if</span> <span class="n">sm</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;model.&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;model.&quot;</span> <span class="o">+</span> <span class="n">sm</span><span class="p">)</span>
</span><span id="WrappedClassifier-76"><a href="#WrappedClassifier-76"><span class="linenos">76</span></a>                <span class="k">for</span> <span class="n">sm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;lcc_submodules&quot;</span><span class="p">]</span>
</span><span id="WrappedClassifier-77"><a href="#WrappedClassifier-77"><span class="linenos">77</span></a>            <span class="p">]</span>
</span><span id="WrappedClassifier-78"><a href="#WrappedClassifier-78"><span class="linenos">78</span></a>        <span class="p">)</span>
</span><span id="WrappedClassifier-79"><a href="#WrappedClassifier-79"><span class="linenos">79</span></a>
</span><span id="WrappedClassifier-80"><a href="#WrappedClassifier-80"><span class="linenos">80</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_train_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WrappedClassifier-81"><a href="#WrappedClassifier-81"><span class="linenos">81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="WrappedClassifier-82"><a href="#WrappedClassifier-82"><span class="linenos">82</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_start</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>An image classifier model
(<a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html"><code>torch.nn.Module</code></a>)
wrapped inside a <code><a href="#BaseClassifier">lcc.classifiers.BaseClassifier</a></code>.</p>
</div>


                            <div id="WrappedClassifier.__init__" class="classattr">
                                        <input id="WrappedClassifier.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">WrappedClassifier</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span>,</span><span class="param">	<span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">logit_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="WrappedClassifier.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WrappedClassifier.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WrappedClassifier.__init__-22"><a href="#WrappedClassifier.__init__-22"><span class="linenos">22</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="WrappedClassifier.__init__-23"><a href="#WrappedClassifier.__init__-23"><span class="linenos">23</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="WrappedClassifier.__init__-24"><a href="#WrappedClassifier.__init__-24"><span class="linenos">24</span></a>        <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
</span><span id="WrappedClassifier.__init__-25"><a href="#WrappedClassifier.__init__-25"><span class="linenos">25</span></a>        <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="WrappedClassifier.__init__-26"><a href="#WrappedClassifier.__init__-26"><span class="linenos">26</span></a>        <span class="n">head_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="WrappedClassifier.__init__-27"><a href="#WrappedClassifier.__init__-27"><span class="linenos">27</span></a>        <span class="n">logit_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="WrappedClassifier.__init__-28"><a href="#WrappedClassifier.__init__-28"><span class="linenos">28</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="WrappedClassifier.__init__-29"><a href="#WrappedClassifier.__init__-29"><span class="linenos">29</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WrappedClassifier.__init__-30"><a href="#WrappedClassifier.__init__-30"><span class="linenos">30</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WrappedClassifier.__init__-31"><a href="#WrappedClassifier.__init__-31"><span class="linenos">31</span></a><span class="sd">        See also:</span>
</span><span id="WrappedClassifier.__init__-32"><a href="#WrappedClassifier.__init__-32"><span class="linenos">32</span></a><span class="sd">            `lcc.classifiers.BaseClassifier.__init__`.</span>
</span><span id="WrappedClassifier.__init__-33"><a href="#WrappedClassifier.__init__-33"><span class="linenos">33</span></a>
</span><span id="WrappedClassifier.__init__-34"><a href="#WrappedClassifier.__init__-34"><span class="linenos">34</span></a><span class="sd">        Args:</span>
</span><span id="WrappedClassifier.__init__-35"><a href="#WrappedClassifier.__init__-35"><span class="linenos">35</span></a><span class="sd">            model (nn.Module):</span>
</span><span id="WrappedClassifier.__init__-36"><a href="#WrappedClassifier.__init__-36"><span class="linenos">36</span></a><span class="sd">            n_classes (int): Number of classes in the dataset on which the model</span>
</span><span id="WrappedClassifier.__init__-37"><a href="#WrappedClassifier.__init__-37"><span class="linenos">37</span></a><span class="sd">                will be trained.</span>
</span><span id="WrappedClassifier.__init__-38"><a href="#WrappedClassifier.__init__-38"><span class="linenos">38</span></a><span class="sd">            head_name (str | None, optional): Name of the head submodule in</span>
</span><span id="WrappedClassifier.__init__-39"><a href="#WrappedClassifier.__init__-39"><span class="linenos">39</span></a><span class="sd">                `model`, which is the fully connected (aka</span>
</span><span id="WrappedClassifier.__init__-40"><a href="#WrappedClassifier.__init__-40"><span class="linenos">40</span></a><span class="sd">                [`nn.Linear`](https://pytorch.org/docs/stable/generated/torch.nn.Linear.html))</span>
</span><span id="WrappedClassifier.__init__-41"><a href="#WrappedClassifier.__init__-41"><span class="linenos">41</span></a><span class="sd">                layer that outputs the logits. If not `None`, the head is</span>
</span><span id="WrappedClassifier.__init__-42"><a href="#WrappedClassifier.__init__-42"><span class="linenos">42</span></a><span class="sd">                replaced by a new fully connected layer with `n_classes` output</span>
</span><span id="WrappedClassifier.__init__-43"><a href="#WrappedClassifier.__init__-43"><span class="linenos">43</span></a><span class="sd">                neurons classes. Specify this to fine-tune a pretrained model</span>
</span><span id="WrappedClassifier.__init__-44"><a href="#WrappedClassifier.__init__-44"><span class="linenos">44</span></a><span class="sd">                on a new dataset with the same or a different number of</span>
</span><span id="WrappedClassifier.__init__-45"><a href="#WrappedClassifier.__init__-45"><span class="linenos">45</span></a><span class="sd">                classes. The name of a submodule can be retried by inspecting</span>
</span><span id="WrappedClassifier.__init__-46"><a href="#WrappedClassifier.__init__-46"><span class="linenos">46</span></a><span class="sd">                the output of `nn.Module.named_modules` or</span>
</span><span id="WrappedClassifier.__init__-47"><a href="#WrappedClassifier.__init__-47"><span class="linenos">47</span></a><span class="sd">                `lcc.utils.pretty_print_submodules`.</span>
</span><span id="WrappedClassifier.__init__-48"><a href="#WrappedClassifier.__init__-48"><span class="linenos">48</span></a><span class="sd">            logit_key (str | None, optional): If the wrapped model outputs a</span>
</span><span id="WrappedClassifier.__init__-49"><a href="#WrappedClassifier.__init__-49"><span class="linenos">49</span></a><span class="sd">                dict-like object instead of a tensor, this key is used to access</span>
</span><span id="WrappedClassifier.__init__-50"><a href="#WrappedClassifier.__init__-50"><span class="linenos">50</span></a><span class="sd">                the actual logits.</span>
</span><span id="WrappedClassifier.__init__-51"><a href="#WrappedClassifier.__init__-51"><span class="linenos">51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WrappedClassifier.__init__-52"><a href="#WrappedClassifier.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">(</span><span class="n">ignore</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">])</span>
</span><span id="WrappedClassifier.__init__-53"><a href="#WrappedClassifier.__init__-53"><span class="linenos">53</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_classes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="WrappedClassifier.__init__-54"><a href="#WrappedClassifier.__init__-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="WrappedClassifier.__init__-55"><a href="#WrappedClassifier.__init__-55"><span class="linenos">55</span></a>        <span class="k">if</span> <span class="n">head_name</span><span class="p">:</span>
</span><span id="WrappedClassifier.__init__-56"><a href="#WrappedClassifier.__init__-56"><span class="linenos">56</span></a>            <span class="n">replace_head</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">head_name</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="see-also">See also:</h6>

<blockquote>
  <p><code><a href="#BaseClassifier.__init__">lcc.classifiers.BaseClassifier.__init__</a></code>.</p>
</blockquote>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>model (nn.Module):</strong> </li>
<li><strong>n_classes (int):</strong>  Number of classes in the dataset on which the model
will be trained.</li>
<li><strong>head_name (str | None, optional):</strong>  Name of the head submodule in
<code><a href="#WrappedClassifier.model">model</a></code>, which is the fully connected (aka
<a href="https://pytorch.org/docs/stable/generated/torch.nn.Linear.html"><code>nn.Linear</code></a>)
layer that outputs the logits. If not <code>None</code>, the head is
replaced by a new fully connected layer with <code>n_classes</code> output
neurons classes. Specify this to fine-tune a pretrained model
on a new dataset with the same or a different number of
classes. The name of a submodule can be retried by inspecting
the output of <code>nn.Module.named_modules</code> or
<code><a href="utils.html#pretty_print_submodules">lcc.utils.pretty_print_submodules</a></code>.</li>
<li><strong>logit_key (str | None, optional):</strong>  If the wrapped model outputs a
dict-like object instead of a tensor, this key is used to access
the actual logits.</li>
</ul>
</div>


                            </div>
                            <div id="WrappedClassifier.model" class="classattr">
                                <div class="attr variable">
            <span class="name">model</span><span class="annotation">: torch.nn.modules.module.Module</span>

        
    </div>
    <a class="headerlink" href="#WrappedClassifier.model"></a>
    
    

                            </div>
                            <div id="WrappedClassifier.forward" class="classattr">
                                        <input id="WrappedClassifier.forward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">forward</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">inputs</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="WrappedClassifier.forward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WrappedClassifier.forward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WrappedClassifier.forward-58"><a href="#WrappedClassifier.forward-58"><span class="linenos">58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">|</span> <span class="n">Batch</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">__</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="WrappedClassifier.forward-59"><a href="#WrappedClassifier.forward-59"><span class="linenos">59</span></a>        <span class="n">image_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;image_key&quot;</span><span class="p">]</span>
</span><span id="WrappedClassifier.forward-60"><a href="#WrappedClassifier.forward-60"><span class="linenos">60</span></a>        <span class="n">logit_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logit_key&quot;</span><span class="p">)</span>
</span><span id="WrappedClassifier.forward-61"><a href="#WrappedClassifier.forward-61"><span class="linenos">61</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span> <span class="o">=</span> <span class="n">inputs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">)</span> <span class="k">else</span> <span class="n">inputs</span><span class="p">[</span><span class="n">image_key</span><span class="p">]</span>
</span><span id="WrappedClassifier.forward-62"><a href="#WrappedClassifier.forward-62"><span class="linenos">62</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</span><span id="WrappedClassifier.forward-63"><a href="#WrappedClassifier.forward-63"><span class="linenos">63</span></a>        <span class="k">return</span> <span class="n">output</span> <span class="k">if</span> <span class="n">logit_key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">output</span><span class="p">[</span><span class="n">logit_key</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Same as <code>torch.nn.Module.forward()</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*args:</strong>  Whatever you decide to pass into the forward method.</li>
<li><strong>**kwargs:</strong>  Keyword arguments are also possible.</li>
</ul>

<h6 id="return">Return:</h6>

<blockquote>
  <p>Your model's output</p>
</blockquote>
</div>


                            </div>
                            <div id="WrappedClassifier.lcc_submodules" class="classattr">
                                        <input id="WrappedClassifier.lcc_submodules-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">lcc_submodules</span><span class="annotation">: list[str]</span>

                <label class="view-source-button" for="WrappedClassifier.lcc_submodules-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WrappedClassifier.lcc_submodules"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WrappedClassifier.lcc_submodules-65"><a href="#WrappedClassifier.lcc_submodules-65"><span class="linenos">65</span></a>    <span class="nd">@property</span>
</span><span id="WrappedClassifier.lcc_submodules-66"><a href="#WrappedClassifier.lcc_submodules-66"><span class="linenos">66</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lcc_submodules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="WrappedClassifier.lcc_submodules-67"><a href="#WrappedClassifier.lcc_submodules-67"><span class="linenos">67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="WrappedClassifier.lcc_submodules-68"><a href="#WrappedClassifier.lcc_submodules-68"><span class="linenos">68</span></a><span class="sd">        Returns the list of submodules considered for LCC, whith correct prefix</span>
</span><span id="WrappedClassifier.lcc_submodules-69"><a href="#WrappedClassifier.lcc_submodules-69"><span class="linenos">69</span></a><span class="sd">        if needed.</span>
</span><span id="WrappedClassifier.lcc_submodules-70"><a href="#WrappedClassifier.lcc_submodules-70"><span class="linenos">70</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="WrappedClassifier.lcc_submodules-71"><a href="#WrappedClassifier.lcc_submodules-71"><span class="linenos">71</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="WrappedClassifier.lcc_submodules-72"><a href="#WrappedClassifier.lcc_submodules-72"><span class="linenos">72</span></a>            <span class="p">[]</span>
</span><span id="WrappedClassifier.lcc_submodules-73"><a href="#WrappedClassifier.lcc_submodules-73"><span class="linenos">73</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;lcc_submodules&quot;</span><span class="p">]</span>
</span><span id="WrappedClassifier.lcc_submodules-74"><a href="#WrappedClassifier.lcc_submodules-74"><span class="linenos">74</span></a>            <span class="k">else</span> <span class="p">[</span>
</span><span id="WrappedClassifier.lcc_submodules-75"><a href="#WrappedClassifier.lcc_submodules-75"><span class="linenos">75</span></a>                <span class="p">(</span><span class="n">sm</span> <span class="k">if</span> <span class="n">sm</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;model.&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;model.&quot;</span> <span class="o">+</span> <span class="n">sm</span><span class="p">)</span>
</span><span id="WrappedClassifier.lcc_submodules-76"><a href="#WrappedClassifier.lcc_submodules-76"><span class="linenos">76</span></a>                <span class="k">for</span> <span class="n">sm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;lcc_submodules&quot;</span><span class="p">]</span>
</span><span id="WrappedClassifier.lcc_submodules-77"><a href="#WrappedClassifier.lcc_submodules-77"><span class="linenos">77</span></a>            <span class="p">]</span>
</span><span id="WrappedClassifier.lcc_submodules-78"><a href="#WrappedClassifier.lcc_submodules-78"><span class="linenos">78</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns the list of submodules considered for LCC, whith correct prefix
if needed.</p>
</div>


                            </div>
                            <div id="WrappedClassifier.on_train_start" class="classattr">
                                        <input id="WrappedClassifier.on_train_start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">on_train_start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="WrappedClassifier.on_train_start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#WrappedClassifier.on_train_start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="WrappedClassifier.on_train_start-80"><a href="#WrappedClassifier.on_train_start-80"><span class="linenos">80</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_train_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="WrappedClassifier.on_train_start-81"><a href="#WrappedClassifier.on_train_start-81"><span class="linenos">81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="WrappedClassifier.on_train_start-82"><a href="#WrappedClassifier.on_train_start-82"><span class="linenos">82</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_start</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Explicitly registers hyperparameters and metrics. You'd think Lightning
would do this automatically, but nope.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>